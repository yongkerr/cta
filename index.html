<!DOCTYPE html>
<html lang="ko">
<head>
<!-- Parse SDK ì¶”ê°€ -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì„¸ë¬´ì‚¬ ì‹œí—˜ ë¬¸ì œí’€ì´ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- ========================================
         01. CSS ìŠ¤íƒ€ì¼ ì •ì˜ ì„¹ì…˜ ì‹œì‘
         ======================================== -->
    <style>
        /* ===== 01-1. í°íŠ¸ ì •ì˜ (DSEG7, digital-7-mono-italic) ì‹œì‘ ===== */

@font-face {
    font-family: 'digital-7-mono-italic'; 
    /* 01-1-1. ì €ì¥ì†Œ ë£¨íŠ¸ì— ìˆëŠ” í°íŠ¸ íŒŒì¼ì„ ì§ì ‘ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ */
    src: url('digital-7-mono-italic.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}
        
        @font-face {
            font-family: 'DSEG7';
            src: url('https://cdn.jsdelivr.net/gh/keshikan/DSEG@master/fonts/DSEG7-Classic/DSEG7Classic-Bold.woff2') format('woff2'),
                 url('https://cdn.jsdelivr.net/gh/keshikan/DSEG@master/fonts/DSEG7-Classic/DSEG7Classic-Bold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
        }


        /* ===== 01-1. í°íŠ¸ ì •ì˜ (DSEG7, digital-7-mono-italic) ë ===== */

        /* ===== 01-2. ì „ì—­ ë¦¬ì…‹ ë° ê¸°ë³¸ ì„¤ì • ì‹œì‘ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            height: 100vh;
            overflow: hidden;
            color: #2c3e50;
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        html, body {
    touch-action: manipulation; /* 01-2-10. ë”ë¸”íƒ­/í•€ì¹˜ í™•ëŒ€ ë°©ì§€ */
    overscroll-behavior-y: contain; /* 01-2-11. ìœ„ì•„ë˜ ìŠ¤í¬ë¡¤ íŠ ë°©ì§€ */
}
* {
    -webkit-tap-highlight-color: transparent; /* 01-2-12. íƒ­ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
}

        /* ===== 01-2. ì „ì—­ ë¦¬ì…‹ ë° ê¸°ë³¸ ì„¤ì • ë ===== */
        
        /* ========================================
             (ìˆ˜ì •) 01-3. í†µí•© í—¤ë” ìŠ¤íƒ€ì¼ ì‹œì‘
             ======================================== */
        .unified-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            height: 35px;
            background: #ffffff;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            flex-shrink: 0; /* í—¤ë” ë†’ì´ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ê³ ì • */
            z-index: 200;
        }

        .header-left, .header-center, .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-left { flex: 1; justify-content: flex-start; }
        .header-center { flex: 1.5; justify-content: center; }
        .header-right { flex: 1; justify-content: flex-end; }

        .header-btn {
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .header-btn:hover { background-color: #f1f3f4; }
        
        .breadcrumb {
            font-size: 14px;
            color: #6c757d;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .breadcrumb .current { font-weight: 500; color: #343a40; }

        .tab-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #868e96;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .tab-btn.active {
            color: #212529;
            background-color: #e9ecef;
        }
        .tab-btn:hover:not(.active) {
            background-color: #f8f9fa;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timer-display {
            font-family: 'digital-7-mono-italic', 'Orbitron', monospace;
            font-size: 16px;
            background: #f1f3f4;
            padding: 6px 10px;
            border-radius: 4px;
            min-width: 80px;
            text-align: center;
        }
        .timer-controls { display: flex; gap: 2px; }
        .timer-btn {
            background: none;
            border: 1px solid #ced4da;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-btn:hover { background-color: #e9ecef; }
        /* ========================================
             (ìˆ˜ì •) 01-3. í†µí•© í—¤ë” ìŠ¤íƒ€ì¼ ë
             ======================================== */

        
/* ===== 01-5. ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.main-content {
    flex: 1;
    position: relative;
    overflow: auto; /* ìŠ¤í¬ë¡¤ ì¶”ê°€ */
    height: calc(100vh - 120px); /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ë†’ì´ ì œì™¸ */
}

.question-container {
    flex: 1; /* (ìˆ˜ì •) ì´ ì˜ì—­ì´ ë¶€ëª¨ì˜ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
    margin-bottom: 20px;
}

#options-container {
    overflow-y: auto; /* ì„ íƒì§€ ì˜ì—­ì—ë„ ìŠ¤í¬ë¡¤ ì¶”ê°€ */
    padding-right: 10px; /* ìŠ¤í¬ë¡¤ë°” ì—¬ë°± */
    flex: 1; /* (ì¶”ê°€) ë¶€ëª¨(.question-container)ì˜ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì±„ì›€ */
    display: flex; /* (ì¶”ê°€) ë‚´ë¶€ì˜ ì´ì „/ë‹¤ìŒ ë²„íŠ¼ì„ ë°”ë‹¥ì— ë¶™ì´ê¸° ìœ„í•´ í”Œë ‰ìŠ¤ ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
    flex-direction: column; /* (ì¶”ê°€) ë‚´ë¶€ ìš”ì†Œë“¤ì„ ì„¸ë¡œë¡œ ë°°ì¹˜ */
}

/* ===== 01-5. ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ìŠ¤íƒ€ì¼ ë ===== */

        
        /* ===== 01-6. ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
        .sidebar {
            position: fixed;
            left: -350px;
            top: 0;
            width: 350px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e9ecef;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .menu-section {
            padding: 15px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .menu-section-title {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: #f8f9fa;
            border-left-color: #007bff;
        }
        
        .menu-item.active {
            background: #e3f2fd;
            border-left-color: #007bff;
            color: #1976d2;
        }
        
        .menu-item-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .menu-item-desc {
            font-size: 12px;
            color: #6c757d;
        }
        
        .submenu {
            padding-left: 20px;
            background: #fafafa;
            display: none;
        }
        
        .submenu.show {
            display: block;
        }
        
        .submenu-item {
            padding: 8px 20px;
            cursor: pointer;
            font-size: 13px;
            color: #495057;
            transition: all 0.2s;
        }
        
        .submenu-item:hover {
            background: #e9ecef;
            color: #007bff;
        }
        /* ===== 01-6. ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ë ===== */
        
        /* ===== 01-7. ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
        /* ===== 01-7. ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ ë ===== */
        
        /* ===== 01-8. ë¬¸ì œí’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.quiz-layout {
    display: flex;
    height: 100%;
    gap: 4px;
    padding: 8px;
}

.calculator-section {
    flex: none;
    width: 450px;
    min-width: 340px;
    max-width: 540px;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
    
    /* â–¼â–¼â–¼ (ì¶”ê°€) ê³„ì‚°ê¸° ìœ„ì¹˜ ê³ ì •ì„ ìœ„í•œ ì½”ë“œ â–¼â–¼â–¼ */
    position: sticky; /* ìŠ¤í¬ë¡¤ ì‹œ ë‹¬ë¼ë¶™ëŠ” íš¨ê³¼ */
    top: 8px;         /* ìƒë‹¨ì—ì„œ 8px ë–¨ì–´ì§„ ìœ„ì¹˜ì— ê³ ì • */
        /* â–²â–²â–² (ì¶”ê°€) ê³„ì‚°ê¸° ìœ„ì¹˜ ê³ ì •ì„ ìœ„í•œ ì½”ë“œ â–²â–²â–² */
}
/* ===== 01-8. ë¬¸ì œí’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ ë ===== */

/* (ìµœì¢…) 01-8-1. ë¬¸ì œ ì˜ì—­ ìŠ¤íƒ€ì¼ (í†µí•© ìµœì¢…ë³¸) */
.quiz-section {
    flex: 1; 
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
    position: relative;
    
    /* â–¼ ìŠ¤í¬ë¡¤ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ í•µì‹¬ ì†ì„± â–¼ */
    overflow-y: auto; 
    min-height: 0; 
    -webkit-overflow-scrolling: touch; 
    
    /* â–¼ ìŠ¤í¬ë¡¤ë°” ë””ìì¸ì„ ìœ„í•œ ì†ì„± â–¼ */
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: #ced4da #f1f3f4; /* Firefox */
}

/* ìŠ¤í¬ë¡¤ë°” ì›¹í‚· ë¸Œë¼ìš°ì €(í¬ë¡¬, ì‚¬íŒŒë¦¬, ì•„ì´íŒ¨ë“œ)ìš© ìŠ¤íƒ€ì¼ */
.quiz-section::-webkit-scrollbar,
.workspace-section-new::-webkit-scrollbar {
    width: 12px; /* ìŠ¤í¬ë¡¤ë°” ë„ˆë¹„ */
}
.quiz-section::-webkit-scrollbar-track,
.workspace-section-new::-webkit-scrollbar-track {
    background: #f1f3f4; /* íŠ¸ë™ ë°°ê²½ìƒ‰ */
    border-radius: 6px;
}
.quiz-section::-webkit-scrollbar-thumb,
.workspace-section-new::-webkit-scrollbar-thumb {
    background: #ced4da; /* ìŠ¤í¬ë¡¤ë°” ë§‰ëŒ€ ìƒ‰ìƒ */
    border-radius: 6px;
    border: 3px solid #f1f3f4; /* íŠ¸ë™ê³¼ ì—¬ë°±ì„ ì¤˜ì„œ ë– ìˆëŠ” íš¨ê³¼ */
}
.quiz-section::-webkit-scrollbar-thumb:hover,
.workspace-section-new::-webkit-scrollbar-thumb:hover {
    background: #adb5bd;
}
        
        /* ===== 01-9. ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ (CASIO JS-40B ë””ìì¸) ì‹œì‘ ===== */
        .calculator-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #b0aeaf;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #1a1a1a;
        }
        
        .calc-brand {
            color: white;
            font-size: 14px;
            font-weight: bold;
            text-align: left;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        /* ===== 01-9. ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ (CASIO JS-40B ë””ìì¸) ë ===== */
        
        /* ===== 01-10. ê³„ì‚°ê¸° ë””ìŠ¤í”Œë ˆì´ (14ìë¦¬ ì§€ì›, DSEG í°íŠ¸) ì‹œì‘ ===== */
        .calculator-display {
            background: #7b8a77;
            color: #1f1d1d;
            padding: 10px 5px 5px 5px;
            text-align: right;
            font-size: 32px;
            font-family: 'digital-7-mono-italic', monospace;
            font-weight: bold;
            border-radius: 4px;
            margin-bottom: 5px;
            min-height: 60px;
            display: flex;
            align-items: flex-end;
            justify-content: flex-end;
            border: 2px solid #0a0a0a;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
            position: relative;
            letter-spacing: 1px;
            overflow: visible;
        }
        
        .memory-indicator {
            position: absolute;
            left: 20px;
            top: 8px;
            font-size: 20px;
            font-weight: bold;
            color: #1f1d1d;
            font-family: 'digital-7-mono-italic', 'Orbitron', monospace;
            pointer-events: none;
        }
        
        .display-value {
            text-align: right;
            font-family: 'digital-7-mono-italic', 'Orbitron', monospace;
            font-weight: bold;
            font-size: 36.5px;
            width: 100%;
            overflow: visible;
            direction: ltr;
            unicode-bidi: plaintext;
            white-space: nowrap;
            line-height: 1;
            padding-bottom: 0px;
        }
        /* ===== 01-10. ê³„ì‚°ê¸° ë””ìŠ¤í”Œë ˆì´ (14ìë¦¬ ì§€ì›, DSEG í°íŠ¸) ë ===== */
        
        /* ===== 01-11. ê³„ì‚°ê¸° ë²„íŠ¼ ê·¸ë¦¬ë“œ (5x6 ë ˆì´ì•„ì›ƒ) ì‹œì‘ ===== */
        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 4px;
            flex: 1;
            max-width: 100%;
        }
        
        .calc-btn {
            border: 1px solid #444;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s;
            min-height: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .calc-btn:active {
            transform: scale(0.95);
            box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        /* 01-11-1. ìˆ«ì ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê²€ì€ìƒ‰) ì‹œì‘ */
        .calc-btn.number, .calc-btn.number:hover {
            background: #000000 !important;
            color: #ffffff !important;
            border-color: #444444 !important;
        }
        
        .calc-btn.number:hover {
            background: #222222 !important;
        }
        /* 01-11-1. ìˆ«ì ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê²€ì€ìƒ‰) ë */
        
        /* 01-11-2. ì—°ì‚°ì, ê¸°ëŠ¥, ë©”ëª¨ë¦¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (íšŒìƒ‰) ì‹œì‘ */
        .calc-btn:not(.number),
        .calc-btn.operator, .calc-btn.operator:hover, 
        .calc-btn.function, .calc-btn.function:hover, 
        .calc-btn.equals, .calc-btn.equals:hover,
        .calc-btn.memory, .calc-btn.memory:hover {
            background: #4a4a4a !important;
            color: #ffffff !important;
            border-color: #333333 !important;
        }
        
        .calc-btn.memory {
            color: #000000 !important;
        }
        /* 01-11-2. ì—°ì‚°ì, ê¸°ëŠ¥, ë©”ëª¨ë¦¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (íšŒìƒ‰) ë */
        
        /* 01-11-3. C, AC ë²„íŠ¼ íŠ¹ë³„ ìƒ‰ìƒ (ì£¼í™©ìƒ‰) ì‹œì‘ */
        .calc-btn.function[onclick*='clearEntry'], 
        .calc-btn.function[onclick*='clearAll'] {
            color: #ff6600 !important;
        }
        /* 01-11-3. C, AC ë²„íŠ¼ íŠ¹ë³„ ìƒ‰ìƒ (ì£¼í™©ìƒ‰) ë */
        
        /* 01-11-4. + ë²„íŠ¼ ì„¸ë¡œ 2ì¹¸ ì°¨ì§€ ì‹œì‘ */
        .calc-btn.plus-tall {
            grid-row: span 2;
            background: #4a4a4a !important;
            color: #ffffff !important;
            border-color: #333333 !important;
        }
        
        .calc-btn.plus-tall:hover {
            background: #3a3a3a !important;
        }
        /* 01-11-4. + ë²„íŠ¼ ì„¸ë¡œ 2ì¹¸ ì°¨ì§€ ë */
        /* ===== 01-11. ê³„ì‚°ê¸° ë²„íŠ¼ ê·¸ë¦¬ë“œ (5x6 ë ˆì´ì•„ì›ƒ) ë ===== */

        /* ===== 01-12. ê³„ì‚°ê¸°ë¡ ì˜ì—­ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
        .calculation-history {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            max-height: 100px;
        }

        .history-title {
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 6px;
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-values {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            max-height: 50px;
            overflow-y: auto;
            margin-bottom: 6px;
        }

        .history-value {
            font-family: 'digital-7-mono-italic', monospace;
            font-size: 12px;
            color: #495057;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid #dee2e6;
        }

        .history-value:hover {
            background: #007bff;
            color: white;
        }

        .clear-history-btn {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .clear-history-btn:hover {
            background: #5a6268;
        }
        /* ===== 01-12. ê³„ì‚°ê¸°ë¡ ì˜ì—­ ìŠ¤íƒ€ì¼ ë ===== */
                
        /* ===== 01-15. í€´ì¦ˆ ì˜ì—­ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }
        
        .question-container {
            flex: 1;
            margin-bottom: 20px;
        }
        
        #question-text {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        /* ===== 01-15. í€´ì¦ˆ ì˜ì—­ ìŠ¤íƒ€ì¼ ë ===== */
        
        /* ===== 01-16. ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ ì‹œì‘ ===== */
        @media (max-width: 768px) {
            .quiz-layout {
                flex-direction: column;
            }
        }
        /* ===== 01-16. ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ ë ===== */

/* ===== 01-17. ë¬¸ì œ í•´ì„¤ ê´€ë ¨ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.question-header {
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e9ecef;
}

.question-meta {
    font-size: 12px;
    color: #6c757d;
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
}

.question-content {
    font-size: 16px;
    line-height: 1.6;
    color: #2c3e50;
}

.option-item {
    margin-bottom: 10px;
    padding: 12px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.option-item:hover {
    background: #f8f9fa;
    border-color: #007bff;
}

.option-number {
    display: inline-block;
    width: 24px;
    height: 24px;
    background: #6c757d;
    color: white;
    border-radius: 50%;
    text-align: center;
    line-height: 24px;
    font-size: 12px;
    font-weight: bold;
    margin-right: 10px;
}

.explanation-item {
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #6c757d;
}

.explanation-item.correct {
    background: #d4edda;
    border-left-color: #28a745;
}

.explanation-item.incorrect {
    background: #f8d7da;
    border-left-color: #dc3545;
}

.explanation-item.user-choice {
    box-shadow: 0 0 0 2px #007bff;
}

.option-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.option-status {
    margin-left: auto;
    font-weight: bold;
    font-size: 14px;
}

.explanation-text {
    font-size: 14px;
    line-height: 1.5;
    color: #495057;
}

.submit-answer-btn, .next-question-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 20px;
    width: 100%;
}

.submit-answer-btn:hover, .next-question-btn:hover {
    background: #0056b3;
}

.result-summary {
    background: #e9ecef;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    text-align: center;
}

.result-summary h4 {
    margin: 0 0 10px 0;
    font-size: 18px;
}

.result-summary p {
    margin: 5px 0;
    font-size: 14px;
}

/* ===== 01-17. ë¬¸ì œ í•´ì„¤ ê´€ë ¨ ìŠ¤íƒ€ì¼ì— ì¶”ê°€ ===== */
.explanation-item {
    margin-bottom: 15px;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #6c757d;
    max-height: none; /* ë†’ì´ ì œí•œ ì œê±° */
    overflow: visible; /* ë‚´ìš© ëª¨ë‘ í‘œì‹œ */
}

.explanation-text {
    font-size: 14px;
    line-height: 1.5;
    color: #495057;
    white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
    word-wrap: break-word; /* ê¸´ ë‹¨ì–´ ì¤„ë°”ê¿ˆ */
}

.detail-navigation {
    position: sticky; /* ë„¤ë¹„ê²Œì´ì…˜ ê³ ì • */
    bottom: 0;
    background: white;
    padding: 15px 0;
    border-top: 1px solid #e9ecef;
    margin-top: 20px;
}
/* ===== 01-17-1. ì°¸ê³  ì‚¬í•­ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.reference-note {
    margin-top: 12px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
    border-left: 3px solid #6c757d;
    font-size: 13px;
    color: #495057;
    white-space: pre-wrap;
    line-height: 1.6;
}

.reference-note strong {
    font-weight: 600;
    color: #2c3e50;
    display: block;
    margin-bottom: 5px;
}
/* ===== 01-17-1. ì°¸ê³  ì‚¬í•­ ìŠ¤íƒ€ì¼ ë ===== */


/* ===== 01-17. ë¬¸ì œ í•´ì„¤ ê´€ë ¨ ìŠ¤íƒ€ì¼ ë ===== */
/* ===== 01-19. í•´ì„¤ ëª¨ë“œ ì „ìš© ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.explanation-mode {
    display: flex;
    height: 100%;
    gap: 20px;
    padding: 20px;
}

.explanation-content {
    flex: 1;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    overflow-y: auto;
    max-height: calc(100vh - 140px);
}


/* ë™ì  í•´ì„¤ ì¹¸ í¬ê¸° ì¡°ì • */
.explanation-item.short {
    padding: 10px 15px;
    min-height: auto;
}

.explanation-item.medium {
    padding: 15px;
    min-height: auto;
}

.explanation-item.long {
    padding: 20px;
    min-height: auto;
}

/* ë¬¸ì œë³„ êµ¬ë¶„ì„  */
.question-divider {
    border-top: 2px solid #007bff;
    margin: 30px 0 20px 0;
    padding-top: 20px;
}

.question-summary {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #007bff;
}

.question-result {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    margin-left: 10px;
}

.question-result.correct {
    background: #d4edda;
    color: #155724;
}

.question-result.incorrect {
    background: #f8d7da;
    color: #721c24;
}

.explanation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e9ecef;
}

.explanation-controls {
    display: flex;
    gap: 10px;
}
/* ===== 01-19. í•´ì„¤ ëª¨ë“œ ì „ìš© ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ ë ===== */

/* ===== 01-18. ë¬¸ì œí’€ì´ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.option-item.selected {
    background: #e3f2fd;
    border-color: #2196f3;
    box-shadow: 0 0 0 2px #2196f3;
}

.question-navigation, .detail-navigation {
    display: flex;
    gap: 10px;
    margin-top: auto; /* (í•µì‹¬ ìˆ˜ì •) ì»¨í…Œì´ë„ˆì˜ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ì—¬ ë²„íŠ¼ë“¤ì„ ë§¨ ì•„ë˜ë¡œ ë°€ì–´ëƒ„ */
    padding-top: 20px; /* (ì¶”ê°€) ë²„íŠ¼ê³¼ ë¬¸ì œ ë‚´ìš© ì‚¬ì´ì˜ ì—¬ë°± í™•ë³´ */
    justify-content: space-between;
}

.nav-btn {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
}

.nav-btn:hover:not(:disabled) {
    background: #5a6268;
}

.nav-btn:disabled {
    background: #dee2e6;
    color: #6c757d;
    cursor: not-allowed;
}

.finish-btn {
    background: #28a745 !important;
}

.finish-btn:hover {
    background: #218838 !important;
}

.quiz-results {
    text-align: center;
    padding: 20px;
}

.score-summary {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
}

.score-circle {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: #e3f2fd;
    border: 3px solid #2196f3;
}

.score-number {
    font-size: 24px;
    font-weight: bold;
    color: #2196f3;
}

.score-total {
    font-size: 14px;
    color: #6c757d;
}

.score-percentage {
    font-size: 36px;
    font-weight: bold;
    color: #2196f3;
}

.score-details {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
}

.correct {
    color: #28a745;
    font-weight: bold;
}

.incorrect {
    color: #dc3545;
    font-weight: bold;
}

.result-item {
    margin-bottom: 10px;
    padding: 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    border-left: 4px solid #6c757d;
}

.result-item.correct {
    background: #d4edda;
    border-left-color: #28a745;
}

.result-item.incorrect {
    background: #f8d7da;
    border-left-color: #dc3545;
}

.result-item:hover {
    transform: translateX(5px);
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
}

.question-num {
    font-weight: bold;
}

.result-status {
    font-size: 14px;
    font-weight: bold;
}

.result-info {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #6c757d;
}

.retry-section {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    justify-content: center;
}

.retry-btn, .review-btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.retry-btn:hover, .review-btn:hover {
    background: #0056b3;
}

.review-btn {
    background: #ffc107;
    color: #212529;
}

.review-btn:hover {
    background: #e0a800;
}
/* ===== 01-18. ë¬¸ì œí’€ì´ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ ë ===== */

/* ===== 01-20. ì°¸ê³ ì‚¬í•­ ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */
.general-reference-note {
    margin-top: 20px;
    padding: 15px;
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    border-left: 4px solid #f39c12;
}

.reference-header {
    font-weight: bold;
    color: #856404;
    margin-bottom: 10px;
    font-size: 14px;
}

.reference-content {
    color: #856404;
    line-height: 1.5;
    font-size: 13px;
}
/* ===== 01-20. ì°¸ê³ ì‚¬í•­ ìŠ¤íƒ€ì¼ ë ===== */

/* ===== 01-21. í€´ì¦ˆ ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ (ê·¸ë¦¬ë“œ ë·°) ì‹œì‘ ===== */
.results-mode {
    padding: 20px;
    background-color: #f8f9fa;
    height: 100%;
    overflow-y: auto;
    text-align: center;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    gap: 10px;
    margin-top: 30px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.result-grid-item {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 50px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid transparent;
}

.result-grid-item:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.result-grid-item.correct {
    background: #d4edda;
    color: #155724;
    border-color: #c3e6cb;
}

.result-grid-item.incorrect {
    background: #f8d7da;
    color: #721c24;
    border-color: #f5c6cb;
}
/* ===== 01-21. í€´ì¦ˆ ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ (ê·¸ë¦¬ë“œ ë·°) ë ===== */

/* ===== 01-23. ì£¼ì„(Annotation) ë° ì—°ìŠµì¥(Workspace) ìŠ¤íƒ€ì¼ ì‹œì‘ ===== */

/* 01-23-1. ë¬¸ì œ ìœ„ì— ê²¹ì³ì§€ëŠ” íˆ¬ëª… í•„ê¸° ìº”ë²„ìŠ¤ */
.annotation-canvas {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    /* (í•µì‹¬ ìˆ˜ì •) ì˜¤ë¥¸ìª½ì—ì„œ 17pxì˜ ê³µê°„ì„ ë‚¨ê²¨ ìŠ¤í¬ë¡¤ë°” ì˜ì—­ì„ ë¬¼ë¦¬ì ìœ¼ë¡œ í™•ë³´í•©ë‹ˆë‹¤. */
    right: 17px; 
    /* widthì™€ heightëŠ” autoë¡œ ì„¤ì •í•˜ì—¬ ìœ„/ì•„ë˜/ì™¼ìª½/ì˜¤ë¥¸ìª½ ì†ì„±ì— ë°˜ì‘í•˜ë„ë¡ í•©ë‹ˆë‹¤. */
    width: auto; 
    height: auto;
    z-index: 10;
    cursor: crosshair;
    pointer-events: auto;
    touch-action: none; 
}


/* 01-23-3. í€´ì¦ˆ ì˜ì—­ê³¼ ì—°ìŠµì¥ì„ ê°ì‹¸ëŠ” ì„¸ë¡œ ì»¨í…Œì´ë„ˆ */
.main-column {
    display: flex;
    flex-direction: column;
    flex: 2.2; /* ê¸°ì¡´ quiz-sectionê³¼ ë™ì¼í•œ ë„ˆë¹„ ë¹„ìœ¨ */
    gap: 0; /* ë¶„í•  ë°”ë¡œ ê°„ê²© ì œì–´ */
    min-width: 0; /* flex itemì˜ í¬ê¸°ê°€ ì¤„ì–´ë“¤ ìˆ˜ ìˆë„ë¡ ì„¤ì • */
}

/* 01-23-4. í•˜ë‹¨ ì—°ìŠµì¥ ì„¹ì…˜ */
.workspace-section-new {
    flex-basis: 200px;
    min-height: 50px;
    background: white;
    border-radius: 8px;
    padding: 15px;
    padding-right: 25px; /* (ìˆ˜ì •) ì˜¤ë¥¸ìª½ ì—¬ë°±ì„ ëŠ˜ë ¤ íŒíŠ¸ ê³µê°„ í™•ë³´ */
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    position: relative; /* (ì¶”ê°€) ::after ìœ ì‚¬ ìš”ì†Œë¥¼ ìœ„í•œ ê¸°ì¤€ì  */
}

.workspace-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e9ecef;
    flex-shrink: 0;
}

.workspace-header h3 {
    font-size: 16px;
    margin: 0;
}

.draw-btn {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
}

/* 01-23-5. ì—°ìŠµì¥ ìº”ë²„ìŠ¤ */
.workspace-canvas {
    width: 100%;
    height: 1000px; /* (í•µì‹¬ ìˆ˜ì •) ìº”ë²„ìŠ¤ì˜ ì‹¤ì œ ë†’ì´ë¥¼ 1000pxë¡œ ê³ ì • */
    background: #fdfdfd;
    border: 1px dashed #ccc;
    border-radius: 4px;
    touch-action: none;
}

/* 01-23-6. í¬ê¸° ì¡°ì ˆ ë°”(Resizer) ìŠ¤íƒ€ì¼ */
.resizer-vertical {
    background: #e9ecef;
    cursor: row-resize;
    height: 20px;
    border-top: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
    position: relative;
    transition: background 0.2s;
}

.resizer-vertical:hover {
    background: #007bff;
}

.resizer-vertical::before {
    content: 'â€¢â€¢â€¢';
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    color: #6c757d;
    font-size: 16px;
    letter-spacing: 2px;
}

/* 01-23-7. ê°œë³„ í•´ì„¤ í™”ë©´ì˜ ì—°ìŠµì¥ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
.workspace-snapshot {
    margin-top: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 100%;
}

.workspace-snapshot-header {
    font-weight: bold;
    margin-bottom: 10px;
    font-size: 14px;
}
/* ===== 01-23. ì£¼ì„(Annotation) ë° ì—°ìŠµì¥(Workspace) ìŠ¤íƒ€ì¼ ë ===== */

/* (ì‹ ê·œ) 01-24. ìŠ¤í¬ë¡¤ ê°€ëŠ¥ ì˜ì—­ì„ ìœ„í•œ ì‹œê°ì  íŒíŠ¸ ìŠ¤íƒ€ì¼ */
.quiz-section::after,
.workspace-section-new::after {
    content: '';
    position: absolute;
    top: 8px;
    right: 8px;
    bottom: 8px;
    width: 6px;
    background-color: #e0e0e0;
    border-radius: 3px;
    opacity: 0.8;
    pointer-events: none; /* íŒíŠ¸ê°€ í´ë¦­ë˜ì§€ ì•Šë„ë¡ ì„¤ì • */
}

        /* (ì‹ ê·œ) 01-25. ì´ë¡ í•™ìŠµ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ì‹œì‘ */
        .theory-layout {
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            height: 100%;
            flex-direction: column;
        }

        .theory-main-content {
            flex: 1;
            padding: 5px;
            overflow: hidden;
            display: flex;           /* 01-25-1. (ì¶”ê°€) ìì‹ ìš”ì†Œë¥¼ flexë¡œ ì œì–´í•˜ê¸° ìœ„í•´ ì¶”ê°€ */
            justify-content: center; /* 01-25-2. (ì¶”ê°€) ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€ */
            align-items: flex-start;   /* 01-25-3. (ìˆ˜ì •) ì±…ì„ í™”ë©´ ìƒë‹¨ì— ë§ì¶”ê¸° ìœ„í•´ 'ì‹œì‘ì ' ì •ë ¬ë¡œ ë³€ê²½ */
}

        .theory-book {
    display: flex;
    height: 100%; 
    max-width: 1340px;
    max-height: 1000px;
    margin: auto; /* ìë™ ì¤‘ì•™ ì •ë ¬ì€ ìœ ì§€í•©ë‹ˆë‹¤. */

    /* --- (ì‹ ê·œ) ìŠ¤í¬ë¡¤ ìŠ¤ëƒ… ì ìš©ì„ ìœ„í•œ í•µì‹¬ ì½”ë“œ --- */
    overflow-x: auto; /* 01-25-6. (ì¶”ê°€) ë‚´ìš©ì´ ë„˜ì¹  ë•Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • */
    scroll-snap-type: x mandatory; /* 01-25-7. (ì¶”ê°€) ê°€ë¡œ ìŠ¤í¬ë¡¤ì´ ë©ˆì¶œ ë•Œ ìì„ì²˜ëŸ¼ ë‹¬ë¼ë¶™ê²Œ í•¨ */
    gap: 40px; /* 01-25-8. (ì¶”ê°€) margin-right ëŒ€ì‹  í˜ì´ì§€ í¼ì¹¨ë©´ ì‚¬ì´ì˜ ê°„ê²©ì„ ì„¤ì • */

    /* --- (ì‹ ê·œ) ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° --- */
    -ms-overflow-style: none; /* 01-25-9. (ì¶”ê°€) IE, Edge ìš© ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
    scrollbar-width: none; /* 01-25-10. (ì¶”ê°€) Firefox ìš© ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
    /* (í•µì‹¬ ìˆ˜ì •) í”Œë ‰ìŠ¤ ì•„ì´í…œì´ ë¶€ëª¨ ì»¨í…Œì´ë„ˆë¥¼ ë„˜ì–´ê°€ì§€ ì•Šë„ë¡ ê°•ì œí•˜ëŠ” ì½”ë“œ */
    min-width: 0;

}
/* 01-25-11. (ì¶”ê°€) í¬ë¡¬, ì‚¬íŒŒë¦¬ ë“± Webkit ê³„ì—´ìš© ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
.theory-book::-webkit-scrollbar {
    display: none; 
}

        .theory-book:active { cursor: grabbing; }

        .theory-page-spread {
    flex: 0 0 100%; /* 01-25-12. (ìœ ì§€) í¼ì¹¨ë©´ì´ ë¶€ëª¨ ë„ˆë¹„ì˜ 100%ë¥¼ ì°¨ì§€í•˜ê²Œ í•¨ */
    display: flex;
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    border-radius: 6px;
    scroll-snap-align: center; /* 01-25-13. (ì¶”ê°€) ìŠ¤í¬ë¡¤ì´ ë©ˆì¶œ ë•Œ ì´ ìš”ì†Œë¥¼ í™”ë©´ ì¤‘ì•™ì— ë§ì¶¤ */
}

    .theory-page {
    flex: 1 0 50%; /* 01-25-15. (ìˆ˜ì •) ê° í˜ì´ì§€ê°€ í¼ì¹¨ë©´ì˜ 50%ë¥¼ ì •í™•íˆ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
    background-color: #fff;
    padding: 5px 20px;
    overflow-y: auto; /* 01-25-16. (ìˆ˜ì •) ë‚´ìš©ì´ í˜ì´ì§€ë³´ë‹¤ ê¸¸ ê²½ìš°ì—ë§Œ ìŠ¤í¬ë¡¤ì´ ìƒê¸°ë„ë¡ ë³€ê²½ */
    position: relative;
    box-sizing: border-box; /* 01-25-17. (ì¶”ê°€) íŒ¨ë”©ì„ ë„ˆë¹„ ê³„ì‚°ì— í¬í•¨ì‹œì¼œ ë ˆì´ì•„ì›ƒì´ ê¹¨ì§€ì§€ ì•Šê²Œ í•¨ */
}



        .theory-left-page {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        .theory-right-page {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-left: 1px solid #eee;
        }
        
        .theory-page-number {
            position: absolute;
            bottom: 15px;
            font-size: 12px;
            color: #999;
        }
        .theory-left-page .theory-page-number { left: 40px; }
        .theory-right-page .theory-page-number { right: 40px; }

        .theory-content-wrapper h1, .theory-content-wrapper h2, .theory-content-wrapper h3, .theory-content-wrapper h4  {
    display: block; /* 01-25-19. (ìˆ˜ì •) ì œëª©ì´ í•œ ì¤„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ ë¸”ë¡ ìš”ì†Œë¡œ ë³€ê²½ */
    line-height: 1.7; /* 01-25-20. (ìˆ˜ì •) ì¤„ ê°„ê²© ì¡°ì • */
    margin-top: 15px; /* 01-25-21. (ì¶”ê°€) ì œëª© ìœ„ì— ì—¬ë°±ì„ ì£¼ì–´ ê°€ë…ì„± í–¥ìƒ */
    margin-bottom: 10px; /* 01-25-22. (ì¶”ê°€) ì œëª© ì•„ë˜ì—ë„ ì—¬ë°± ì¶”ê°€ */
    padding: 0; /* 01-25-23. (ì‚­ì œ) ë°°ê²½ìƒ‰ì„ ì—†ì• ë¯€ë¡œ íŒ¨ë”©ë„ ì´ˆê¸°í™” */
    border-radius: 0;
}

        .theory-content-wrapper h1 { background-color: #dad4ff; }
        .theory-content-wrapper h2 { background-color: #b7e5ff; }
        .theory-content-wrapper h3 { background-color: #D6E8DB; }
        .theory-content-wrapper p { margin-top: 12px; line-height: 1.7; color: #333; }
        .theory-content-wrapper table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .theory-content-wrapper th, .theory-content-wrapper td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .theory-content-wrapper th { background-color: #f2f2f2; }
        .theory-content-wrapper a { color: #007bff; text-decoration: none; }
        .theory-content-wrapper a:hover { text-decoration: underline; }

/* (ì‹ ê·œ) 01-25-24. ì´ë¡  í•™ìŠµ í˜ì´ì§€ì˜ ëª©ë¡(ë¦¬ìŠ¤íŠ¸) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.theory-content-wrapper ul, 
.theory-content-wrapper ol { /* (í•µì‹¬ ìˆ˜ì • 1) ol íƒœê·¸ë„ ì ìš© ëŒ€ìƒì— ì¶”ê°€ */
    padding-left: 28px; /* (í•µì‹¬ ìˆ˜ì • 2) ì˜ë¦¼ í˜„ìƒ í•´ê²°ì„ ìœ„í•´ ë“¤ì—¬ì“°ê¸° ê°’ì„ ë„‰ë„‰í•˜ê²Œ ëŠ˜ë¦¼ */
}
.theory-content-wrapper li {
    line-height: 1.65; 
    margin-bottom: 2px; /* (ìˆ˜ì •) í•­ëª© ê°„ ì—¬ë°±ì„ ì¡°ê¸ˆ ë” í™•ë³´ */
}

/* (ì‹ ê·œ) 01-25-25. ì´ë¡  í˜ì´ì§€ ë‚´ ì´ë¯¸ì§€ ë° ì½”ë“œ ë¸”ë¡ ìŠ¤íƒ€ì¼ */
.theory-content-wrapper img {
    max-width: 100%; /* ì´ë¯¸ì§€ê°€ í˜ì´ì§€ ë„ˆë¹„ë¥¼ ë„˜ì–´ê°€ì§€ ì•Šë„ë¡ í•¨ */
    height: auto;
    display: block;
    margin: 15px auto;
}
.theory-content-wrapper pre {
    white-space: pre-wrap;   /* (í•µì‹¬ ìˆ˜ì • 1) ìë™ ì¤„ë°”ê¿ˆì„ í—ˆìš©í•˜ë˜, ì½”ë“œ í˜•ì‹ì€ ìœ ì§€ */
    word-break: break-all;   /* (í•µì‹¬ ìˆ˜ì • 2) URLì²˜ëŸ¼ ì•„ì£¼ ê¸´ ë‹¨ì–´ë„ ê°•ì œë¡œ ì¤„ë°”ê¿ˆ */
    background-color: #f5f5f5;
    padding: 15px;
    border-radius: 4px;
    font-size: 13px;
    line-height: 1.6;
    margin-top: 15px;
    overflow-x: auto; /* ë§Œì•½ì„ ëŒ€ë¹„í•œ ìµœì†Œí•œì˜ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
}

/* (ì‹ ê·œ) 01-25-26. ì¸ìš©ë¬¸(blockquote) ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.theory-content-wrapper blockquote {
    margin-top: 10px; /* 01-25-26-1. (ì¶”ê°€) ë‚´ìš© êµ¬ë¶„ì„ ìœ„í•´ ìƒë‹¨ì— ì—¬ë°± ì¶”ê°€ */
    margin-bottom: 5px;
    padding: 5px;
    background-color: #f8f9fa;
    border-left: 5px solid #6c757d;
    line-height: 1.7; /* 01-25-26-2. (ì¶”ê°€) ì¤„ê°„ê²© ì¡°ì • */
}

        /* ===== 01-25. ì´ë¡ í•™ìŠµ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ë ===== */


        /* ========================================
             (ì‹ ê·œ) 01-26. í”Œë¡œíŒ… ëª©ì°¨(TOC) ìŠ¤íƒ€ì¼ ì‹œì‘
             ======================================== */
        .floating-toc {
            position: fixed;
            top: 0;
            right: -320px; /* ê¸°ë³¸ì ìœ¼ë¡œ í™”ë©´ ë°–ì— ìˆ¨ê²¨ ë‘  */
            width: 300px;
            height: 100%;
            background: #fff;
            border-left: 1px solid #e9ecef;
            box-shadow: -2px 0 10px rgba(0,0,0,0.08);
            z-index: 900;
            display: flex;
            flex-direction: column;
            transition: right 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .floating-toc.open {
            right: 0; /* open í´ë˜ìŠ¤ê°€ ë¶™ìœ¼ë©´ í™”ë©´ ì•ˆìœ¼ë¡œ ë‚˜íƒ€ë‚¨ */
        }

        .floating-toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0;
        }
        .floating-toc-header h3 {
            font-size: 16px;
            margin: 0;
        }
        .floating-toc-header .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .floating-toc-list {
            list-style: none;
            padding: 10px 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .floating-toc-list li a {
            display: block;
            padding: 8px 20px;
            font-size: 14px;
            color: #495057;
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        .floating-toc-list li a:hover {
            background-color: #f8f9fa;
        }
        .floating-toc-list li a.active {
            color: #007bff;
            font-weight: 600;
            background-color: #e3f2fd;
            border-left-color: #007bff;
        }
        .floating-toc-list li a[data-level="h2"] { padding-left: 35px; }
        .floating-toc-list li a[data-level="h3"] { padding-left: 50px; }
        /* ========================================
             (ì‹ ê·œ) 01-26. í”Œë¡œíŒ… ëª©ì°¨(TOC) ìŠ¤íƒ€ì¼ ë
             ======================================== */


    </style>

    <!-- =====  iOS ì „ì²´í™”ë©´(PWA) ë©”íƒ€íƒœê·¸ ì¶”ê°€ ===== -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ì„¸ë¬´ì‚¬ í•™ìŠµ ì›¹ì•±">
<!-- =====  iOS ì „ì²´í™”ë©´(PWA) ë©”íƒ€íƒœê·¸ ë ===== -->



    <!-- ========================================
         01. CSS ìŠ¤íƒ€ì¼ ì •ì˜ ì„¹ì…˜ ë
         ======================================== -->
</head>
<body>
    <div class="app-container">
        <!-- ========================================
             02. ì˜¤ë²„ë ˆì´ ë° ì‚¬ì´ë“œë°” ì„¹ì…˜ ì‹œì‘
             ======================================== -->
        
        <!-- 02-1. ì‚¬ì´ë“œë°” ë°°ê²½ ì˜¤ë²„ë ˆì´ ì‹œì‘ -->
        <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
        <!-- 02-1. ì‚¬ì´ë“œë°” ë°°ê²½ ì˜¤ë²„ë ˆì´ ë -->
        
                <!-- ========================================
             02-2. ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ (ëª©ì°¨ êµ¬ì¡°) ì‹œì‘ (ìˆ˜ì •ë¨)
             ======================================== -->
        <div class="sidebar" id="sidebar">
            <!-- 02-2-0. ì‚¬ì´ë“œë°” í—¤ë” ì‹œì‘ -->
            <div class="sidebar-header">
                <!-- ì´ ì œëª©ì€ JavaScriptì— ì˜í•´ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤ -->
                <div class="sidebar-title" id="sidebar-title">ğŸ“š ë¬¸ì œí’€ì´ ëª©ì°¨</div>
            </div>
            <!-- 02-2-0. ì‚¬ì´ë“œë°” í—¤ë” ë -->
            
            <!-- ========================================
                 (ì‹ ê·œ) ë¬¸ì œí’€ì´ ëª©ì°¨ ì»¨í…Œì´ë„ˆ ì‹œì‘
                 ======================================== -->
            <div id="quiz-menu-content">
                <!-- 02-2-1. 1ì°¨ ì‹œí—˜ ë©”ë‰´ ì„¹ì…˜ ì‹œì‘ -->
                <div class="menu-section">
                    <div class="menu-section-title">ğŸ“ 1ì°¨ ì‹œí—˜ ë¬¸ì œí’€ì´</div>
                    
                    <!-- 02-2-1-1. íšŒê³„í•™ê°œë¡  ë©”ë‰´ ì‹œì‘ -->
                    <div class="menu-item" onclick="toggleSubmenu('accounting')">
                        <div class="menu-item-title"> íšŒê³„í•™ê°œë¡ </div>
                        <div class="menu-item-desc">ì—°ë„ë³„ ë° ê³¼ëª©ë³„ ë¬¸ì œí’€ì´</div>
                    </div>
                    <div class="submenu" id="accounting-submenu">
                        <div class="submenu-item" onclick="toggleSubmenu('accounting-years')">ğŸ“… ì—°ë„ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="accounting-years-submenu" style="padding-left: 20px; display: none;">
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2025ë…„ê¸°ì¶œ')">2025ë…„ ì œ62íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2024ë…„ê¸°ì¶œ')">2024ë…„ ì œ61íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2023ë…„ê¸°ì¶œ')">2023ë…„ ì œ60íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2022ë…„ê¸°ì¶œ')">2022ë…„ ì œ59íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2021ë…„ê¸°ì¶œ')">2021ë…„ ì œ58íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2020ë…„ê¸°ì¶œ')">2020ë…„ ì œ57íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2019ë…„ê¸°ì¶œ')">2019ë…„ ì œ56íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2018ë…„ê¸°ì¶œ')">2018ë…„ ì œ55íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2017ë…„ê¸°ì¶œ')">2017ë…„ ì œ54íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2016ë…„ê¸°ì¶œ')">2016ë…„ ì œ53íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2015ë…„ê¸°ì¶œ')">2015ë…„ ì œ52íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2014ë…„ê¸°ì¶œ')">2014ë…„ ì œ51íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2013ë…„ê¸°ì¶œ')">2013ë…„ ì œ50íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2012ë…„ê¸°ì¶œ')">2012ë…„ ì œ49íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2011ë…„ê¸°ì¶œ')">2011ë…„ ì œ48íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', '2010ë…„ê¸°ì¶œ')">2010ë…„ ì œ47íšŒ ê¸°ì¶œ</div>
                        </div>
                        <div class="submenu-item" onclick="toggleSubmenu('accounting-subjects')">ğŸ“– ê³¼ëª©ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="accounting-subjects-submenu" style="padding-left: 20px; display: none;">
                            
                            <div class="submenu-item" onclick="toggleSubmenu('financial-chapters')">ğŸ“– ì¬ë¬´íšŒê³„ â–¼</div>
                            <div class="submenu" id="financial-chapters-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ1ì¥')">ì œ1ì¥ ì¬ë¬´ì œí‘œ í‘œì‹œ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ2ì¥')">ì œ2ì¥ ê³µì •ê°€ì¹˜ ì¸¡ì •ê³¼ í˜„ì¬ê°€ì¹˜ í‰ê°€</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ3ì¥')">ì œ3ì¥ ìˆ˜ìµ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ4ì¥')">ì œ4ì¥ ê±´ì„¤ê³„ì•½</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ5ì¥')">ì œ5ì¥ ì¬ê³ ìì‚°ê³¼ ë†ë¦¼ì–´ì—…</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ6ì¥')">ì œ6ì¥ ìœ í˜•ìì‚°(â… ): ìµœì´ˆì¸ì‹ê³¼ í›„ì†ì¸¡ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ7ì¥')">ì œ7ì¥ ìœ í˜•ìì‚°(â…¡): ì·¨ë“í˜•íƒœë³„ ì›ê°€</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ8ì¥')">ì œ8ì¥ ì°¨ì…ì›ê°€</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ9ì¥')">ì œ9ì¥ ë¬´í˜•ìì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ10ì¥')">ì œ10ì¥ ê¸ˆìœµë¶€ì±„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ11ì¥')">ì œ11ì¥ ì¶©ë‹¹ë¶€ì±„ì™€ ë³´ê³ ê¸°ê°„í›„ì‚¬ê±´</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ12ì¥')">ì œ12ì¥ ìë³¸</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ13ì¥')">ì œ13ì¥ ì¬ë¬´ë³´ê³ ë¥¼ ìœ„í•œ ê°œë…ì²´ê³„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ14ì¥')">ì œ14ì¥ ê¸ˆìœµìì‚°(â… ): ì±„ë¬´ìƒí’ˆê³¼ ì§€ë¶„ìƒí’ˆ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ15ì¥')">ì œ15ì¥ ê¸ˆìœµìì‚°(â…¡): í˜„ê¸ˆê³¼ ë§¤ì¶œì±„ê¶Œ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ16ì¥')">ì œ16ì¥ ë³µí•©ê¸ˆìœµìƒí’ˆ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ17ì¥')">ì œ17ì¥ ì¢…ì—…ì›ê¸‰ì—¬</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ18ì¥')">ì œ18ì¥ ì£¼ì‹ê¸°ì¤€ë³´ìƒ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ19ì¥')">ì œ19ì¥ ë¦¬ìŠ¤íšŒê³„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ20ì¥')">ì œ20ì¥ íˆ¬ìë¶€ë™ì‚°ê³¼ ë§¤ê°ì˜ˆì •ë¹„ìœ ë™ìì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ21ì¥')">ì œ21ì¥ ë²•ì¸ì„¸íšŒê³„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ22ì¥')">ì œ22ì¥ íšŒê³„ë³€ê²½ê³¼ ì˜¤ë¥˜ìˆ˜ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ23ì¥')">ì œ23ì¥ ì£¼ë‹¹ì´ìµ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ24ì¥')">ì œ24ì¥ í˜„ê¸ˆíë¦„í‘œì™€ ì¤‘ê°„ì¬ë¬´ë³´ê³ </div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì œ25ì¥')">ì œ25ì¥ ê³ ê¸‰íšŒê³„</div>
                            </div>
                            <div class="submenu-item" onclick="toggleSubmenu('cost-chapters')">ğŸ“– ì›ê°€ê´€ë¦¬íšŒê³„ â–¼</div>
                            <div class="submenu" id="cost-chapters-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ1ì¥')">ì œ1ì¥ ì›ê°€ì˜ ë¶„ë¥˜ì™€ ì œì¡°ê¸°ì—…ì˜ ì›ê°€ì˜ íë¦„</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ2ì¥')">ì œ2ì¥ ì›ê°€ë°°ë¶„ê³¼ ë³´ì¡°ë¶€ë¬¸ì›ê°€ì˜ ë°°ë¶„/ê°œë³„ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ3ì¥')">ì œ3ì¥ ì¢…í•©ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ4ì¥')">ì œ4ì¥ ì—°ì‚°í’ˆê³¼ ë¶€ì‚°ë¬¼ì˜ ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ5ì¥')">ì œ5ì¥ ë³€ë™ì›ê°€ê³„ì‚°ê³¼ ì´ˆë³€ë™ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ6ì¥')">ì œ6ì¥ í™œë™ê¸°ì¤€ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ7ì¥')">ì œ7ì¥ ì›ê°€ì¶”ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ8ì¥')">ì œ8ì¥ ì›ê°€-ì¡°ì—…ë„-ì´ìµë¶„ì„</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ9ì¥')">ì œ9ì¥ ê´€ë ¨ì›ê°€ë¶„ì„</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ11ì¥')">ì œ11ì¥ ë¶ˆí™•ì‹¤ì„±í•˜ì˜ ì˜ì‚¬ê²°ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ12ì¥')">ì œ12ì¥ ì¢…í•©ì˜ˆì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ13ì¥')">ì œ13ì¥ í‘œì¤€ì›ê°€ê³„ì‚°</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ14ì¥')">ì œ14ì¥ íŒë§¤ë¶€ë¬¸ê³¼ íˆ¬ìì¤‘ì‹¬ì ì˜ ì„±ê³¼í‰ê°€</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ15ì¥')">ì œ15ì¥ ëŒ€ì²´ê°€ê²©ê²°ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì œ16ì¥')">ì œ16ì¥ ì „ëµì  ì›ê°€ê´€ë¦¬</div>
                            </div>
                        </div>
                        <div class="submenu-item" onclick="selectChapter('íšŒê³„í•™ê°œë¡ ', 'AIì¶”ì²œ')">ğŸ¤– AI ì¶”ì²œë¬¸ì œ</div>
                    </div>
                    <!-- 02-2-1-1. íšŒê³„í•™ê°œë¡  ë©”ë‰´ ë -->
                    
                    <!-- 02-2-1-2. ì„¸ë²•í•™ê°œë¡  ë©”ë‰´ ì‹œì‘ -->
                    <div class="menu-item" onclick="toggleSubmenu('tax')">
                        <div class="menu-item-title">ì„¸ë²•í•™ê°œë¡ </div>
                        <div class="menu-item-desc">ë²•ì¸ì„¸ë²•, ì†Œë“ì„¸ë²•, ë¶€ê°€ê°€ì¹˜ì„¸ë²• ë“±</div>
                    </div>
                    <div class="submenu" id="tax-submenu">
                        <div class="submenu-item" onclick="toggleSubmenu('tax-yearly')">ğŸ“… ì—°ë„ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="tax-yearly-submenu" style="padding-left: 40px; display: none;">
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2025ë…„ê¸°ì¶œ')">2025ë…„ ì œ62íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2024ë…„ê¸°ì¶œ')">2024ë…„ ì œ61íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2023ë…„ê¸°ì¶œ')">2023ë…„ ì œ60íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2022ë…„ê¸°ì¶œ')">2022ë…„ ì œ59íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2021ë…„ê¸°ì¶œ')">2021ë…„ ì œ58íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2020ë…„ê¸°ì¶œ')">2020ë…„ ì œ57íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2019ë…„ê¸°ì¶œ')">2019ë…„ ì œ56íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2018ë…„ê¸°ì¶œ')">2018ë…„ ì œ55íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2017ë…„ê¸°ì¶œ')">2017ë…„ ì œ54íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2016ë…„ê¸°ì¶œ')">2016ë…„ ì œ53íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2015ë…„ê¸°ì¶œ')">2015ë…„ ì œ52íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2014ë…„ê¸°ì¶œ')">2014ë…„ ì œ51íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2013ë…„ê¸°ì¶œ')">2013ë…„ ì œ50íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2012ë…„ê¸°ì¶œ')">2012ë…„ ì œ49íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2011ë…„ê¸°ì¶œ')">2011ë…„ ì œ48íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', '2010ë…„ê¸°ì¶œ')">2010ë…„ ì œ47íšŒ ê¸°ì¶œ</div>
                        </div>
                        
                        <div class="submenu-item" onclick="toggleSubmenu('tax-subject')">ğŸ“– ì„¸ëª©ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="tax-subject-submenu" style="padding-left: 40px; display: none;">
                            <div class="submenu-item" onclick="toggleSubmenu('corporate-tax')">ë²•ì¸ì„¸ë²• â–¼</div>
                            <div class="submenu" id="corporate-tax-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ê¸°ì¶œë¬¸ì œ')">ë²•ì¸ì„¸ë²• ê¸°ì¶œë¬¸ì œ</div>
                                <div class="submenu-item" onclick="toggleSubmenu('corporate-sections')">ğŸ“– ë‹¨ì›ë³„ ê¸°ì¶œ â–¼</div>
                                <div class="submenu" id="corporate-sections-submenu" style="padding-left: 20px; display: none;">
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ1ì ˆ')">ì œ1ì ˆ ì´ì„¤</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ2ì ˆ')">ì œ2ì ˆ ë²•ì¸ì„¸ì˜ ê³„ì‚°êµ¬ì¡°</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ3ì ˆ')">ì œ3ì ˆ ìµê¸ˆ</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ4ì ˆ')">ì œ4ì ˆ ì†ê¸ˆ</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ5ì ˆ')">ì œ5ì ˆ ì†ìµì˜ ê·€ì†ì‚¬ì—…ì—°ë„ì™€ ìì‚°Â·ë¶€ì±„ì˜ í‰ê°€</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ6ì ˆ')">ì œ6ì ˆ ê°ê°€ìƒê°</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ7ì ˆ')">ì œ7ì ˆ ì¶©ë‹¹ê¸ˆê³¼ ì¤€ë¹„ê¸ˆ</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ8ì ˆ')">ì œ8ì ˆ í•©ë³‘ ë° ë¶„í•  ë“±ì— ëŒ€í•œ íŠ¹ë¡€</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ9ì ˆ')">ì œ9ì ˆ ë¶€ë‹¹í–‰ìœ„ê³„ì‚°ì˜ ë¶€ì¸</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ10ì ˆ')">ì œ10ì ˆ ê³¼ì„¸í‘œì¤€ê³¼ ì„¸ì•¡ì˜ ê³„ì‚°</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ11ì ˆ')">ì œ11ì ˆ ë²•ì¸ì„¸ì˜ ë‚©ì„¸ì ˆì°¨</div>
                                    <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì œ12ì ˆ')">ì œ12ì ˆ ê·¸ ë°–ì˜ ë²•ì¸ì„¸</div>
                                </div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('income-tax')">ì†Œë“ì„¸ë²• â–¼</div>
                            <div class="submenu" id="income-tax-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ê¸°ì¶œë¬¸ì œ')">ì†Œë“ì„¸ë²• ê¸°ì¶œë¬¸ì œ</div>
                                <div class="submenu-item" onclick="toggleSubmenu('income-sections')">ğŸ“– ë‹¨ì›ë³„ ê¸°ì¶œ â–¼</div>
                                <div class="submenu" id="income-sections-submenu" style="padding-left: 20px; display: none;">
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ1ì ˆ')">ì œ1ì ˆ ì´ì„¤</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ2ì ˆ')">ì œ2ì ˆ ì´ìì†Œë“ê³¼ ë°°ë‹¹ì†Œë“</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ3ì ˆ')">ì œ3ì ˆ ì‚¬ì—…ì†Œë“</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ4ì ˆ')">ì œ4ì ˆ ê·¼ë¡œì†Œë“Â·ì—°ê¸ˆì†Œë“ ë° ê¸°íƒ€ì†Œë“</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ5ì ˆ')">ì œ5ì ˆ ì†Œë“ê¸ˆì•¡ê³„ì‚°ì˜ íŠ¹ë¡€</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ6ì ˆ')">ì œ6ì ˆ ì¢…í•©ì†Œë“ê³¼ì„¸í‘œì¤€ì˜ ê³„ì‚°</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ7ì ˆ')">ì œ7ì ˆ ì¢…í•©ì†Œë“ì„¸ì•¡ì˜ ê³„ì‚°</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ8ì ˆ')">ì œ8ì ˆ í‡´ì§ì†Œë“ì„¸</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ9ì ˆ')">ì œ9ì ˆ ì¢…í•©Â·í‡´ì§ì†Œë“ì„¸ì˜ ë‚©ì„¸ì ˆì°¨</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ10ì ˆ')">ì œ10ì ˆ ì–‘ë„ì†Œë“ì„¸</div>
                                    <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì œ11ì ˆ')">ì œ11ì ˆ ë¹„ê±°ì£¼ìì™€ ì™¸êµ­ë²•ì¸ì˜ ë‚©ì„¸ì˜ë¬´</div>
                                </div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('vat')">ë¶€ê°€ê°€ì¹˜ì„¸ë²• â–¼</div>
                            <div class="submenu" id="vat-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ê¸°ì¶œë¬¸ì œ')">ë¶€ê°€ê°€ì¹˜ì„¸ë²• ê¸°ì¶œë¬¸ì œ</div>
                                <div class="submenu-item" onclick="toggleSubmenu('vat-sections')">ğŸ“– ë‹¨ì›ë³„ ê¸°ì¶œ â–¼</div>
                                <div class="submenu" id="vat-sections-submenu" style="padding-left: 20px; display: none;">
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ1ì ˆ')">ì œ1ì ˆ ì´ì„¤</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ2ì ˆ')">ì œ2ì ˆ ë‚©ì„¸ì˜ë¬´ì</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ3ì ˆ')">ì œ3ì ˆ ê³¼ì„¸ê±°ë˜</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ4ì ˆ')">ì œ4ì ˆ ì˜ì„¸ìœ¨ê³¼ ë©´ì„¸</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ5ì ˆ')">ì œ5ì ˆ ê³¼ì„¸í‘œì¤€</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ6ì ˆ')">ì œ6ì ˆ ê±°ë˜ì§•ìˆ˜ì™€ ì„¸ê¸ˆê³„ì‚°ì„œ</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ7ì ˆ')">ì œ7ì ˆ ë‚©ë¶€ì„¸ì•¡ì˜ ê³„ì‚°</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ8ì ˆ')">ì œ8ì ˆ ë¶€ê°€ê°€ì¹˜ì„¸ì˜ ë‚©ì„¸ì ˆì°¨</div>
                                    <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì œ9ì ˆ')">ì œ9ì ˆ ê°„ì´ê³¼ì„¸</div>
                                </div>
                            </div>
                            
                            <div class="submenu-item" onclick="selectChapter('êµ­ì„¸ê¸°ë³¸ë²•', 'ê¸°ì¶œë¬¸ì œ')">êµ­ì„¸ê¸°ë³¸ë²• ê¸°ì¶œë¬¸ì œ</div>
                            <div class="submenu-item" onclick="selectChapter('êµ­ì„¸ì§•ìˆ˜ë²•', 'ê¸°ì¶œë¬¸ì œ')">êµ­ì„¸ì§•ìˆ˜ë²• ê¸°ì¶œë¬¸ì œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¡°ì„¸ë²”ì²˜ë²Œë²•', 'ê¸°ì¶œë¬¸ì œ')">ì¡°ì„¸ë²”ì²˜ë²Œë²• ê¸°ì¶œë¬¸ì œ</div>
                        </div>
                        
                        <div class="submenu-item" onclick="selectChapter('ì„¸ë²•í•™ê°œë¡ ', 'AIì¶”ì²œ')"> ìƒì„±ë¬¸ì œ</div>
                    </div>
                    <!-- 02-2-1-2. ì„¸ë²•í•™ê°œë¡  ë©”ë‰´ ë -->
                    
                    <!-- 02-2-1-3. ì¬ì •í•™ ë©”ë‰´ ì‹œì‘ -->
                    <div class="menu-item" onclick="toggleSubmenu('finance')">
                        <div class="menu-item-title"> ì¬ì •í•™</div>
                        <div class="menu-item-desc">ê³µê³µì¬, ì¡°ì„¸ì´ë¡ , ì¬ì •ì •ì±…</div>
                    </div>
                    <div class="submenu" id="finance-submenu">
                        <div class="submenu-item" onclick="toggleSubmenu('finance-years')">ğŸ“… ì—°ë„ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="finance-years-submenu" style="padding-left: 20px; display: none;">
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2025ë…„ê¸°ì¶œ')">2025ë…„ ì œ62íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2024ë…„ê¸°ì¶œ')">2024ë…„ ì œ61íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2023ë…„ê¸°ì¶œ')">2023ë…„ ì œ60íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2022ë…„ê¸°ì¶œ')">2022ë…„ ì œ59íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2021ë…„ê¸°ì¶œ')">2021ë…„ ì œ58íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2020ë…„ê¸°ì¶œ')">2020ë…„ ì œ57íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2019ë…„ê¸°ì¶œ')">2019ë…„ ì œ56íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2018ë…„ê¸°ì¶œ')">2018ë…„ ì œ55íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2017ë…„ê¸°ì¶œ')">2017ë…„ ì œ54íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2016ë…„ê¸°ì¶œ')">2016ë…„ ì œ53íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2015ë…„ê¸°ì¶œ')">2015ë…„ ì œ52íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2014ë…„ê¸°ì¶œ')">2014ë…„ ì œ51íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2013ë…„ê¸°ì¶œ')">2013ë…„ ì œ50íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2012ë…„ê¸°ì¶œ')">2012ë…„ ì œ49íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2011ë…„ê¸°ì¶œ')">2011ë…„ ì œ48íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', '2010ë…„ê¸°ì¶œ')">2010ë…„ ì œ47íšŒ ê¸°ì¶œ</div>
                        </div>
                        
                        <div class="submenu-item" onclick="toggleSubmenu('finance-chapters')">ğŸ“– ë‹¨ì›ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="finance-chapters-submenu" style="padding-left: 20px; display: none;">
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part1')">ì œ1í¸ ì¬ì •í•™ì˜ ê¸°ì´ˆ â–¼</div>
                            <div class="submenu" id="finance-part1-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ1ì¥')">ì œ1ì¥ ì¬ì •í•™: ì˜ì˜ì™€ ì„±ê²©</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ2ì¥')">ì œ2ì¥ ìš°ë¦¬ë‚˜ë¼ì˜ ì¬ì •</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ3ì¥')">ì œ3ì¥ í›„ìƒê²½ì œí•™</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part2')">ì œ2í¸ ìì›ë°°ë¶„ì˜ ë¬¸ì œ â–¼</div>
                            <div class="submenu" id="finance-part2-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ4ì¥')">ì œ4ì¥ ê³µê³µì¬ì˜ ë¬¸ì œ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ5ì¥')">ì œ5ì¥ ê³µê³µì„ íƒì˜ ì´ë¡ </div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ6ì¥')">ì œ6ì¥ ì™¸ë¶€ì„±ì˜ ë¬¸ì œ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ7ì¥')">ì œ7ì¥ í™˜ê²½ì •ì±…</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part3')">ì œ3í¸ ë¶„ë°°ì™€ ì‚¬íšŒë³µì§€ â–¼</div>
                            <div class="submenu" id="finance-part3-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ8ì¥')">ì œ8ì¥ ì†Œë“ë¶„ë°°ì´ë¡ </div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ9ì¥')">ì œ9ì¥ ì¬ë¶„ë°°ì •ì±…</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ10ì¥')">ì œ10ì¥ ì‚¬íšŒë³´í—˜ì œë„</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part4')">ì œ4í¸ ê³µê³µì§€ì¶œì´ë¡  â–¼</div>
                            <div class="submenu" id="finance-part4-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ11ì¥')">ì œ11ì¥ ì •ë¶€ì§€ì¶œì˜ ë¶„ì„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ12ì¥')">ì œ12ì¥ ë¹„ìš©í¸ìµë¶„ì„</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part5')">ì œ5í¸ ì¡°ì„¸ì˜ ì´ë¡  â–¼</div>
                            <div class="submenu" id="finance-part5-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ13ì¥')">ì œ13ì¥ ì¡°ì„¸ì˜ ê¸°ë³¸ì›ë¦¬</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ14ì¥')">ì œ14ì¥ ì¡°ì„¸ì™€ ì†Œë“ë¶„ë°°</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ15ì¥')">ì œ15ì¥ ì¡°ì„¸ì™€ íš¨ìœ¨ì„±</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ16ì¥')">ì œ16ì¥ ë°”ëŒì§í•œ ì¡°ì„¸ì œë„ì˜ íƒìƒ‰</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part6')">ì œ6í¸ í˜„ì‹¤ì˜ ì¡°ì„¸ì œë„ â–¼</div>
                            <div class="submenu" id="finance-part6-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ17ì¥')">ì œ17ì¥ ì†Œë“ì„¸ì™€ ë¶€ê°€ê°€ì¹˜ì„¸</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ18ì¥')">ì œ18ì¥ ë²•ì¸ì„¸</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ19ì¥')">ì œ19ì¥ ì¡°ì„¸ì œë„ì˜ ê°œí˜</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part7')">ì œ7í¸ ì¡°ì„¸ì™€ ê²½ì œí–‰ìœ„ â–¼</div>
                            <div class="submenu" id="finance-part7-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ20ì¥')">ì œ20ì¥ ì¡°ì„¸ì™€ ê²½ì œí–‰ìœ„: ê°œì¸ì˜ ì„ íƒ</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ21ì¥')">ì œ21ì¥ ì¡°ì„¸ì™€ ê²½ì œí–‰ìœ„: ê¸°ì—…ì˜ ì„ íƒ</div>
                            </div>
                            
                            <div class="submenu-item" onclick="toggleSubmenu('finance-part8')">ì œ8í¸ ì¬ì •í•™ì˜ ë‹¤ë¥¸ ë¬¸ì œë“¤ â–¼</div>
                            <div class="submenu" id="finance-part8-submenu" style="padding-left: 20px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ22ì¥')">ì œ22ì¥ ì¬ì •ì ìì™€ êµ­ì±„</div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ23ì¥')">ì œ23ì¥ ê³µê³µìš”ê¸ˆì˜ ì´ë¡ </div>
                                <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì œ24ì¥')">ì œ24ì¥ ì§€ë°©ì¬ì •</div>
                            </div>
                        </div>
                        
                        <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'AIì¶”ì²œ')">ğŸ¤– AI ì¶”ì²œë¬¸ì œ</div>
                    </div>
                    <!-- 02-2-1-3. ì¬ì •í•™ ë©”ë‰´ ë -->
                    
                    <!-- 02-2-1-4. í–‰ì •ì†Œì†¡ë²• ë©”ë‰´ ì‹œì‘ -->
                    <div class="menu-item" onclick="toggleSubmenu('admin')">
                        <div class="menu-item-title"> í–‰ì •ì†Œì†¡ë²•</div>
                        <div class="menu-item-desc">ì—°ë„ë³„ & ìœ í˜•ë³„ ë¬¸ì œí’€ì´</div>
                    </div>
                    <div class="submenu" id="admin-submenu">
                        <div class="submenu-item" onclick="toggleSubmenu('admin-years')">ğŸ“… ì—°ë„ë³„ ê¸°ì¶œ â–¼</div>
                        <div class="submenu" id="admin-years-submenu" style="padding-left: 20px; display: none;">
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2025ë…„ê¸°ì¶œ')">2025ë…„ ì œ62íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2024ë…„ê¸°ì¶œ')">2024ë…„ ì œ61íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2023ë…„ê¸°ì¶œ')">2023ë…„ ì œ60íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2022ë…„ê¸°ì¶œ')">2022ë…„ ì œ59íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2021ë…„ê¸°ì¶œ')">2021ë…„ ì œ58íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2020ë…„ê¸°ì¶œ')">2020ë…„ ì œ57íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2019ë…„ê¸°ì¶œ')">2019ë…„ ì œ56íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2018ë…„ê¸°ì¶œ')">2018ë…„ ì œ55íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2017ë…„ê¸°ì¶œ')">2017ë…„ ì œ54íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2016ë…„ê¸°ì¶œ')">2016ë…„ ì œ53íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2015ë…„ê¸°ì¶œ')">2015ë…„ ì œ52íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2014ë…„ê¸°ì¶œ')">2014ë…„ ì œ51íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2013ë…„ê¸°ì¶œ')">2013ë…„ ì œ50íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2012ë…„ê¸°ì¶œ')">2012ë…„ ì œ49íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2011ë…„ê¸°ì¶œ')">2011ë…„ ì œ48íšŒ ê¸°ì¶œ</div>
                            <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', '2010ë…„ê¸°ì¶œ')">2010ë…„ ì œ47íšŒ ê¸°ì¶œ</div>
                        </div>
                        <div class="submenu-item" onclick="toggleSubmenu('admin-chapters-new')">ğŸ“– ë‹¨ì›ë³„ ê¸°ì¶œ (ìœ í˜•ë³„) â–¼</div>
                        <div class="submenu" id="admin-chapters-new-submenu" style="padding-left: 20px; display: none;">
                            <div class="submenu-item menu-part-header" onclick="toggleSubmenu('admin-part1')">PART 1: ì†Œì†¡ì˜ ì œê¸° (ì†Œì†¡ìš”ê±´) â–¼</div>
                            <div class="submenu" id="admin-part1-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ1ì¥: ì†Œì†¡ì˜ ëŒ€ìƒ')">ì œ1ì¥: ì†Œì†¡ì˜ ëŒ€ìƒ (ëŒ€ìƒì ê²©)</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ2ì¥: ì†Œì†¡ì˜ ë‹¹ì‚¬ì')">ì œ2ì¥: ì†Œì†¡ì˜ ë‹¹ì‚¬ì</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ3ì¥: ì†Œì˜ ì´ìµ')">ì œ3ì¥: ì†Œì˜ ì´ìµ</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ4ì¥: ì œì†Œê¸°ê°„ ë° í–‰ì •ì‹¬íŒ')">ì œ4ì¥: ì œì†Œê¸°ê°„ ë° í–‰ì •ì‹¬íŒ</div>
                            </div>

                            <div class="submenu-item menu-part-header" onclick="toggleSubmenu('admin-part2')">PART 2: ì†Œì†¡ì˜ ì§„í–‰ (ì‹¬ë¦¬/ì ˆì°¨) â–¼</div>
                            <div class="submenu" id="admin-part2-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ5ì¥: ê°€êµ¬ì œ')">ì œ5ì¥: ê°€êµ¬ì œ (ì§‘í–‰ì •ì§€)</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ6ì¥: ì†Œì˜ ë³€ê²½, ì´ì†¡, ë³‘í•©')">ì œ6ì¥: ì†Œì˜ ë³€ê²½, ì´ì†¡ ë° ë³‘í•©</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ7ì¥: ì†Œì†¡ì˜ ì‹¬ë¦¬')">ì œ7ì¥: ì†Œì†¡ì˜ ì‹¬ë¦¬</div>
                            </div>

                            <div class="submenu-item menu-part-header" onclick="toggleSubmenu('admin-part3')">PART 3: ì†Œì†¡ì˜ ì¢…ë£Œ (íŒê²°) â–¼</div>
                            <div class="submenu" id="admin-part3-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ8ì¥: íŒê²°ì˜ ì¢…ë¥˜')">ì œ8ì¥: íŒê²°ì˜ ì¢…ë¥˜</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ9ì¥: íŒê²°ì˜ íš¨ë ¥')">ì œ9ì¥: íŒê²°ì˜ íš¨ë ¥</div>
                            </div>

                            <div class="submenu-item menu-part-header" onclick="toggleSubmenu('admin-part4')">PART 4: ê·¸ ë°–ì˜ í–‰ì •ì†Œì†¡ â–¼</div>
                            <div class="submenu" id="admin-part4-submenu" style="padding-left: 40px; display: none;">
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ10ì¥: ë¬´íš¨ë“±í™•ì¸ì†Œì†¡')">ì œ10ì¥: ë¬´íš¨ë“±í™•ì¸ì†Œì†¡</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ11ì¥: ë¶€ì‘ìœ„ìœ„ë²•í™•ì¸ì†Œì†¡')">ì œ11ì¥: ë¶€ì‘ìœ„ìœ„ë²•í™•ì¸ì†Œì†¡</div>
                                <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì œ12ì¥: ë‹¹ì‚¬ìì†Œì†¡')">ì œ12ì¥: ë‹¹ì‚¬ìì†Œì†¡</div>
                            </div>
                        </div>

                        <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'AIì¶”ì²œ')">ğŸ¤– AI ì¶”ì²œë¬¸ì œ</div>
                    </div>
                    <!-- 02-2-1-4. í–‰ì •ì†Œì†¡ë²• ë©”ë‰´ ë -->
                </div>
                <!-- 02-2-1. 1ì°¨ ì‹œí—˜ ë©”ë‰´ ì„¹ì…˜ ë -->
                
                <!-- 02-2-2. 2ì°¨ ì‹œí—˜ ë©”ë‰´ ì„¹ì…˜ ì‹œì‘ -->
                <div class="menu-section">
                    <div class="menu-section-title"> 2ì°¨ ì‹œí—˜ ë¬¸ì œí’€ì´</div>
                    
                    <div class="menu-item" onclick="selectChapter('íšŒê³„í•™1ë¶€', 'ê¸°ì¶œë¬¸ì œ')">
                        <div class="menu-item-title"> íšŒê³„í•™ 1ë¶€ (ì¬ë¬´íšŒê³„)</div>
                        <div class="menu-item-desc">ì—°ê²°íšŒê³„, ê³ ê¸‰íšŒê³„, íŠ¹ìˆ˜íšŒê³„</div>
                    </div>
                    
                    <div class="menu-item" onclick="selectChapter('íšŒê³„í•™2ë¶€', 'ê¸°ì¶œë¬¸ì œ')">
                        <div class="menu-item-title"> íšŒê³„í•™ 2ë¶€ (ì„¸ë¬´íšŒê³„)</div>
                        <div class="menu-item-desc">ì„¸ë¬´ì¡°ì •, ì‹¤ë¬´ì‚¬ë¡€</div>
                    </div>
                    
                    <div class="menu-item" onclick="selectChapter('ì„¸ë²•í•™1ë¶€', 'ê¸°ì¶œë¬¸ì œ')">
                        <div class="menu-item-title"> ì„¸ë²•í•™ 1ë¶€ (ì‚¬ë¡€í˜•)</div>
                        <div class="menu-item-desc">êµ­ì„¸ê¸°ë³¸ë²•, ë²•ì¸ì„¸ë²•, ì†Œë“ì„¸ë²•</div>
                    </div>
                    
                    <div class="menu-item" onclick="selectChapter('ì„¸ë²•í•™2ë¶€', 'ê¸°ì¶œë¬¸ì œ')">
                        <div class="menu-item-title"> ì„¸ë²•í•™ 2ë¶€ (ë²•ë ¹í˜•)</div>
                        <div class="menu-item-desc">ë¶€ê°€ê°€ì¹˜ì„¸ë²•, ì§€ë°©ì„¸ë²•</div>
                    </div>
                </div>
                <!-- 02-2-2. 2ì°¨ ì‹œí—˜ ë©”ë‰´ ì„¹ì…˜ ë -->
            </div>
            <!-- ========================================
                 ë¬¸ì œí’€ì´ ëª©ì°¨ ì»¨í…Œì´ë„ˆ ë
                 ======================================== -->

                        <!-- ========================================
                 (ìµœì¢… í™•ì •) ì´ë¡ í•™ìŠµ ëª©ì°¨ ì»¨í…Œì´ë„ˆ ì‹œì‘
                 ======================================== -->
            <div id="theory-menu-content" style="display: none;">
                <div class="menu-section">
                    <div class="menu-section-title">ğŸ“š í†µí•© ì´ë¡  í•™ìŠµ</div>
                    
                    <!-- íšŒê³„í•™ ë©”ë‰´ -->
                    <div class="menu-item" onclick="toggleSubmenu('theory-accounting-main')">
                        <div class="menu-item-title">íšŒê³„í•™</div>
                    </div>
                    <div class="submenu" id="theory-accounting-main-submenu">
                        <div class="submenu-item" onclick="selectChapter('ì¬ë¬´íšŒê³„', 'ì „ì²´ ì´ë¡ ')">ì¬ë¬´íšŒê³„</div>
                        <div class="submenu-item" onclick="selectChapter('ì›ê°€ê´€ë¦¬íšŒê³„', 'ì „ì²´ ì´ë¡ ')">ì›ê°€ê´€ë¦¬íšŒê³„</div>
                        <div class="submenu-item" onclick="selectChapter('ì„¸ë¬´íšŒê³„', 'ì „ì²´ ì´ë¡ ')">ì„¸ë¬´íšŒê³„</div>
                    </div>

                    <!-- ì„¸ë²•í•™ (2ì°¨ ì‹œí—˜ ì¤‘ì‹¬) ë©”ë‰´ -->
                    <div class="menu-item" onclick="toggleSubmenu('theory-tax-main')">
                        <div class="menu-item-title">ì„¸ë²•í•™ (2ì°¨ ì¤‘ì‹¬)</div>
                    </div>
                    <div class="submenu" id="theory-tax-main-submenu">
                        <div class="submenu-item" onclick="selectChapter('êµ­ì„¸ê¸°ë³¸ë²•', 'ì „ì²´ ì´ë¡ ')">êµ­ì„¸ê¸°ë³¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ì†Œë“ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ì†Œë“ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ë²•ì¸ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ë²•ì¸ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ìƒì†ì„¸ ë° ì¦ì—¬ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ìƒì†ì„¸ ë° ì¦ì—¬ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ë¶€ê°€ê°€ì¹˜ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ê°œë³„ì†Œë¹„ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ê°œë³„ì†Œë¹„ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ì§€ë°©ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">ì§€ë°©ì„¸ë²•</div>
                        <div class="submenu-item" onclick="selectChapter('ì¡°ì„¸íŠ¹ë¡€ì œí•œë²•', 'ì „ì²´ ì´ë¡ ')">ì¡°ì„¸íŠ¹ë¡€ì œí•œë²•</div>
                    </div>
                    
                    <!-- ê¸°íƒ€ ì„¸ë²• (1ì°¨ ì‹œí—˜ ì¤‘ì‹¬) ë©”ë‰´ -->
                    <div class="menu-item" onclick="selectChapter('ê¸°íƒ€ì„¸ë²•', 'ì „ì²´ ì´ë¡ ')">
                        <div class="menu-item-title">ê¸°íƒ€ì„¸ë²• (êµ­ì§•, êµ­ì¡°, ì¡°ì²˜)</div>
                    </div>

                    <!-- ì „ëµê³¼ëª© ë©”ë‰´ -->
                    <div class="menu-item" onclick="toggleSubmenu('theory-strategy-main')">
                        <div class="menu-item-title">ì „ëµê³¼ëª©</div>
                    </div>
                    <div class="submenu" id="theory-strategy-main-submenu">
                        <div class="submenu-item" onclick="selectChapter('ì¬ì •í•™', 'ì „ì²´ ì´ë¡ ')">ì¬ì •í•™</div>
                        <div class="submenu-item" onclick="selectChapter('í–‰ì •ì†Œì†¡ë²•', 'ì „ì²´ ì´ë¡ ')">í–‰ì •ì†Œì†¡ë²•</div>
                    </div>
                </div>
            </div>
            <!-- ========================================
                 ì´ë¡ í•™ìŠµ ëª©ì°¨ ì»¨í…Œì´ë„ˆ ë
                 ======================================== -->

        </div>
        <!-- ========================================
             02-2. ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ (ëª©ì°¨ êµ¬ì¡°) ë
             ======================================== -->


        <!-- ========================================
             02. ì˜¤ë²„ë ˆì´ ë° ì‚¬ì´ë“œë°” ì„¹ì…˜ ë
             ======================================== -->
        
                <!-- ========================================
             (í†µí•©) 03. ì´ˆìŠ¬ë¦¼ í•œ ì¤„ í—¤ë” ì„¹ì…˜ ì‹œì‘
             ======================================== -->
        <header class="unified-header">
            <!-- 03-1. í—¤ë” ì™¼ìª½: ë’¤ë¡œê°€ê¸°, í˜„ì¬ ìœ„ì¹˜ -->
            <div class="header-left">
                <button class="header-btn back-btn" onclick="goBack()">â†</button>
                <div class="breadcrumb" id="breadcrumb-text">ì„¸ë²• í•™ìŠµ ì‹œìŠ¤í…œ</div>
            </div>

            <!-- 03-2. í—¤ë” ì¤‘ì•™: ë©”ì¸ íƒ­ (ëª©ì°¨ ì—´ê¸° ê¸°ëŠ¥ í¬í•¨) -->
            <div class="header-center">
                <button class="tab-btn active" onclick="switchTab('quiz')">ğŸ“ ë¬¸ì œí’€ì´</button>
                <button class="tab-btn" onclick="switchTab('progress')">ğŸ“Š ê°œë°œì¤‘</button>
                <button class="tab-btn" onclick="switchTab('theory')">ğŸ“š ì´ë¡ í•™ìŠµ</button>          
            </div>

            <!-- 03-3. í—¤ë” ì˜¤ë¥¸ìª½: ìƒì„¸ëª©ì°¨, íƒ€ì´ë¨¸ -->
            <div class="header-right">
                <button class="header-btn" id="floating-toc-btn" style="display: none;" onclick="toggleFloatingTOC()">ğŸ“– ìƒì„¸ëª©ì°¨</button>
                <div class="timer-container">
                    <div class="timer-display" id="timer">00:00:00</div>
                    <div class="timer-controls">
                        <button id="start-timer-btn" class="timer-btn start" onclick="startTimer()">â–¶ï¸</button>
                        <button id="pause-timer-btn" class="timer-btn pause" onclick="pauseTimer()">â¸ï¸</button>
                        <button id="reset-timer-btn" class="timer-btn reset" onclick="resetTimer()">ğŸ”„</button>
                    </div>
                </div>
            </div>
        </header>
        <!-- ========================================
             (í†µí•©) 03. ì´ˆìŠ¬ë¦¼ í•œ ì¤„ í—¤ë” ì„¹ì…˜ ë
             ======================================== -->


        <!-- ========================================
             05. ë©”ì¸ ì½˜í…ì¸  ì„¹ì…˜ ì‹œì‘
             ======================================== -->
        <main class="main-content">
            <!-- 05-1. ë¬¸ì œí’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ì‹œì‘ -->
            <div class="quiz-layout" id="quiz-layout">
    <div class="main-column">
        <!-- 05-1-1. ë¬¸ì œí’€ì´(í€´ì¦ˆ) ì˜ì—­ ì‹œì‘ -->
        <section class="quiz-section" id="quiz-section">
            <!-- 05-1-1-0. ë¬¸ì œ ìœ„ ìŠ¤ë§ˆíŠ¸ ì£¼ì„(Annotation) ìº”ë²„ìŠ¤ -->
            <canvas class="annotation-canvas" id="annotation-canvas"></canvas>
            <!-- 05-1-1-1. í€´ì¦ˆ í—¤ë” -->
            <div class="quiz-header">
                <span id="question-counter">ë¬¸ì œ ì¤€ë¹„ì¤‘</span>
                <span id="quiz-status">ëŒ€ê¸°</span>
            </div>
            <!-- 05-1-1-2. ë¬¸ì œ ì»¨í…Œì´ë„ˆ -->
            <div class="question-container" id="question-container">
                <h3 id="question-text">ëª©ì°¨ì—ì„œ ì›í•˜ëŠ” ê³¼ëª©ê³¼ ë‹¨ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
                <div class="options-container" id="options-container"></div>
            </div>
        </section>
        <!-- 05-1-2. ë¬¸ì œí’€ì´/ì—°ìŠµì¥ í¬ê¸°ì¡°ì ˆë°” -->
        <div class="resizer-vertical" id="vertical-resizer"></div>
        <!-- 05-1-3. í•˜ë‹¨ ì—°ìŠµì¥(Workspace) -->
        <section class="workspace-section-new" id="workspace-section">
    <div class="workspace-header">
        <h3>âœï¸ ì—°ìŠµì¥ (ë¬¸ì œë³„ ìë™ì €ì¥)</h3>
        <button class="draw-btn" onclick="clearAllCanvases()">ì „ì²´ í•„ê¸° ì§€ìš°ê¸°</button>
    </div>
    <canvas class="workspace-canvas" id="workspace-canvas"></canvas>
    </section>
            </div>

            <!-- 05-1-3. ì˜¤ë¥¸ìª½: ê³„ì‚°ê¸° ì˜ì—­ ì‹œì‘ -->
                <section class="calculator-section">
                    <!-- 05-1-3-1. ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆ ì‹œì‘ -->
                    <div class="calculator-container">
                    <div class="calc-brand">CASIO JS-40B</div>
                                          
                    <!-- 05-1-3-1-2. ê³„ì‚°ê¸° ë””ìŠ¤í”Œë ˆì´ (14ìë¦¬ ì§€ì›) ì‹œì‘ -->
                    <div class="calculator-display" id="calc-display">
                    <div class="memory-indicator" id="memory-indicator"></div>
                     <div class="display-value" id="display-value">0</div>
                        </div>
                        <!-- 05-1-3-1-2. ê³„ì‚°ê¸° ë””ìŠ¤í”Œë ˆì´ (14ìë¦¬ ì§€ì›) ë -->
                        
                        <!-- 05-1-3-1-3. ê³„ì‚°ê¸° ë²„íŠ¼ ê·¸ë¦¬ë“œ (5x6) ì‹œì‘ -->
                        <div class="calculator-buttons">
                            <!-- 05-1-3-1-3-1. ì²« ë²ˆì§¸ ì¤„: M/EX, %, âˆš, âŒ«, GT ì‹œì‘ -->
                            <button class="calc-btn memory" onclick="memoryExchange()">M/EX</button>
                            <button class="calc-btn function" onclick="percentage()">%</button>
                            <button class="calc-btn function" onclick="squareRoot()">âˆš</button>
                            <button class="calc-btn function" onclick="backspace()">âŒ«</button>
                            <button class="calc-btn memory" onclick="grandTotal()">GT</button>
                            <!-- 05-1-3-1-3-1. ì²« ë²ˆì§¸ ì¤„: M/EX, %, âˆš, âŒ«, GT ë -->
                            
                            <!-- 05-1-3-1-3-2. ë‘ ë²ˆì§¸ ì¤„: MC, MR, M-, M+, Ã· ì‹œì‘ -->
                            <button class="calc-btn memory" onclick="memoryClear()">MC</button>
                            <button class="calc-btn memory" onclick="memoryRecall()">MR</button>
                            <button class="calc-btn memory" onclick="memorySubtract()">M-</button>
                            <button class="calc-btn memory" onclick="memoryAdd()">M+</button>
                            <button class="calc-btn operator" onclick="appendToDisplay('/')">Ã·</button>
                            <!-- 05-1-3-1-3-2. ë‘ ë²ˆì§¸ ì¤„: MC, MR, M-, M+, Ã· ë -->
                            
                            <!-- 05-1-3-1-3-3. ì„¸ ë²ˆì§¸ ì¤„: +/-, 7, 8, 9, Ã— ì‹œì‘ -->
                            <button class="calc-btn function" onclick="changeSign()">+/-</button>
                            <button class="calc-btn number" onclick="appendToDisplay('7')">7</button>
                            <button class="calc-btn number" onclick="appendToDisplay('8')">8</button>
                            <button class="calc-btn number" onclick="appendToDisplay('9')">9</button>
                            <button class="calc-btn operator" onclick="appendToDisplay('*')">Ã—</button>
                            <!-- 05-1-3-1-3-3. ì„¸ ë²ˆì§¸ ì¤„: +/-, 7, 8, 9, Ã— ë -->
                            
                            <!-- 05-1-3-1-3-4. ë„¤ ë²ˆì§¸ ì¤„: C, 4, 5, 6, - ì‹œì‘ -->
                            <button class="calc-btn function" onclick="clearEntry()">C</button>
                            <button class="calc-btn number" onclick="appendToDisplay('4')">4</button>
                            <button class="calc-btn number" onclick="appendToDisplay('5')">5</button>
                            <button class="calc-btn number" onclick="appendToDisplay('6')">6</button>
                            <button class="calc-btn operator" onclick="appendToDisplay('-')">-</button>
                            <!-- 05-1-3-1-3-4. ë„¤ ë²ˆì§¸ ì¤„: C, 4, 5, 6, - ë -->
                            
                            <!-- 05-1-3-1-3-5. ë‹¤ì„¯ ë²ˆì§¸ ì¤„: AC, 1, 2, 3, + (2ì¹¸) ì‹œì‘ -->
                            <button class="calc-btn function" onclick="clearAll()">AC</button>
                            <button class="calc-btn number" onclick="appendToDisplay('1')">1</button>
                            <button class="calc-btn number" onclick="appendToDisplay('2')">2</button>
                            <button class="calc-btn number" onclick="appendToDisplay('3')">3</button>
                            <button class="calc-btn plus-tall" onclick="appendToDisplay('+')">+</button>
                            <!-- 05-1-3-1-3-5. ë‹¤ì„¯ ë²ˆì§¸ ì¤„: AC, 1, 2, 3, + (2ì¹¸) ë -->
                            
                            <!-- 05-1-3-1-3-6. ì—¬ì„¯ ë²ˆì§¸ ì¤„: 0, 00, ., = ì‹œì‘ -->
                            <button class="calc-btn number" onclick="appendToDisplay('0')">0</button>
                            <button class="calc-btn number" onclick="appendToDisplay('00')">00</button>
                            <button class="calc-btn number" onclick="appendToDisplay('.')">.</button>
                            <button class="calc-btn equals" onclick="calculate()">=</button>
                            <!-- 05-1-3-1-3-6. ì—¬ì„¯ ë²ˆì§¸ ì¤„: 0, 00, ., = ë -->
                        </div>
                        <!-- 05-1-3-1-3. ê³„ì‚°ê¸° ë²„íŠ¼ ê·¸ë¦¬ë“œ (5x6) ë -->

                        <!-- 05-1-3-1-4. ê³„ì‚°ê¸°ë¡ ì˜ì—­ ì‹œì‘ -->
                        <div class="calculation-history">
                            <!-- 05-1-3-1-4-1. ê³„ì‚°ê¸°ë¡ ì œëª© ì‹œì‘ -->
                            <div class="history-title">
                                ê³„ì‚°ê¸°ë¡
                                <button class="clear-history-btn" onclick="clearCalculationHistory()">ì§€ìš°ê¸°</button>
                            </div>
                            <!-- 05-1-3-1-4-1. ê³„ì‚°ê¸°ë¡ ì œëª© ë -->
                            
                            <!-- 05-1-3-1-4-2. ê³„ì‚°ê¸°ë¡ ê°’ë“¤ ì‹œì‘ -->
                            <div class="history-values" id="historyValues">
                                <!-- ê³„ì‚° ê²°ê³¼ë“¤ì´ ê°œë³„ ë²„íŠ¼ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                            <!-- 05-1-3-1-4-2. ê³„ì‚°ê¸°ë¡ ê°’ë“¤ ë -->
                        </div>
                        <!-- 05-1-3-1-4. ê³„ì‚°ê¸°ë¡ ì˜ì—­ ë -->
                    </div>
                    <!-- 05-1-3-1. ê³„ì‚°ê¸° ì»¨í…Œì´ë„ˆ ë -->
                </section>
                <!-- 05-1-3. ì˜¤ë¥¸ìª½: ê³„ì‚°ê¸° ì˜ì—­ ë -->
            <!-- 05-1. ë¬¸ì œí’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ë -->
        <!-- (ìˆ˜ì •) 05-2. ì´ë¡ í•™ìŠµ í™”ë©´ ë ˆì´ì•„ì›ƒ ì‹œì‘ -->
        <div class="theory-layout" id="theory-layout">
            <div class="theory-main-content" id="theoryMainContent">
                <div class="loading-spinner" id="theoryLoadingSpinner" style="display: none;">
                    <!-- ì´ ë‚´ìš©ì€ JSì— ì˜í•´ ë™ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤ -->
                </div>
                <div class="theory-book" id="theoryBook">
                    <!-- ì´ë¡  ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
        <!-- 05-2. ì´ë¡ í•™ìŠµ í™”ë©´ ë ˆì´ì•„ì›ƒ ë -->


                <div id="progress-layout" style="display: none; justify-content: center; align-items: center; font-size: 1.2em; color: #6c757d; height: 100%;">
                ğŸ“Š í•™ìŠµê´€ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
            </div>

        </main>
        <!-- ========================================
             05. ë©”ì¸ ì½˜í…ì¸  ì„¹ì…˜ ë
             ======================================== -->
    </div>

    <!-- (ì‹ ê·œ) ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ìƒì„¸ëª©ì°¨(TOC) ì‹œì‘ -->
    <div class="floating-toc" id="floating-toc">
        <div class="floating-toc-header">
            <h3>ìƒì„¸ ëª©ì°¨</h3>
            <button class="close-btn" onclick="toggleFloatingTOC()">&times;</button>
        </div>
        <ul class="floating-toc-list" id="floating-toc-list">
            <!-- JSê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ëª©ì°¨ë¥¼ ì±„ì›ë‹ˆë‹¤. -->
            <li>ëª©ì°¨ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
        </ul>
    </div>
    <!-- (ì‹ ê·œ) ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ìƒì„¸ëª©ì°¨(TOC) ë -->

    <!-- ========================================
         06. JavaScript ê¸°ëŠ¥ êµ¬í˜„ ì„¹ì…˜ ì‹œì‘
         ======================================== -->
    <script>
/* ===== 06-1. ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ìˆ˜ì •) ì‹œì‘ ===== */
let calculatorMemory = 0;
let grandTotalMemory = 0;
let shouldClearOnNextInput = false;
let currentExpression = '';
let calculationHistory = [];
let viewHistory = [];

// ìº”ë²„ìŠ¤ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
let annotationCanvas, annotationCtx;
let workspaceCanvas, workspaceCtx;
let workspaceStates = {};
let annotationStates = {};

// ìŠ¤ë§ˆíŠ¸ ìº”ë²„ìŠ¤ ìƒí˜¸ì‘ìš©ì„ ìœ„í•œ ë³€ìˆ˜
let isPointerDown = false;      // í¬ì¸í„°(ë§ˆìš°ìŠ¤/í„°ì¹˜)ê°€ ëˆŒë ¸ëŠ”ì§€ ì—¬ë¶€
let isDragging = false;         // 'í•„ê¸°(ë“œë˜ê·¸)' ë™ì‘ìœ¼ë¡œ í™•ì •ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€
let pointerDownTime = 0;        // í¬ì¸í„°ê°€ ëˆŒë¦° ì‹œê°
let startCoords = { x: 0, y: 0 }; // í¬ì¸í„°ê°€ ëˆŒë¦° í™”ë©´ ì¢Œí‘œ
let lastCanvasCoords = { x: 0, y: 0 }; // ìº”ë²„ìŠ¤ ë‚´ ë§ˆì§€ë§‰ ì¢Œí‘œ
let isEraserMode = false; // (ì¶”ê°€) ì§€ìš°ê°œ ëª¨ë“œ ìƒíƒœ ë³€ìˆ˜

// ìŠ¤ë§ˆíŠ¸ ìº”ë²„ìŠ¤ íŒì • ê¸°ì¤€ (ì„ê³„ê°’)
const TAP_THRESHOLD_MS = 200;   // 'íƒ­'ìœ¼ë¡œ ê°„ì£¼í•  ìµœëŒ€ ì‹œê°„ (0.2ì´ˆ)
const DRAG_THRESHOLD_PX = 5;    // 'í•„ê¸°'ë¡œ ê°„ì£¼í•  ìµœì†Œ ì´ë™ ê±°ë¦¬ (5í”½ì…€)

// í€´ì¦ˆ ìƒíƒœ ê´€ë ¨ ì „ì—­ ë³€ìˆ˜
let currentView = 'home';
let currentQuestionData = null;
let currentQuestionSet = [];
let currentQuestionIndex = 0;
let userAnswers = {};
let selectedAnswers = {};
let quizCompleted = false;
let activeTab = 'quiz'; // (ì¶”ê°€) í˜„ì¬ í™œì„±í™”ëœ íƒ­('quiz' ë˜ëŠ” 'theory')ì„ ì¶”ì í•©ë‹ˆë‹¤.
/* ===== 06-1. ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ìˆ˜ì •) ë ===== */

        /* ===== 06-2. ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-2-1. ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ ì‹œì‘
        function formatNumberWithCommas(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        // 06-2-1. ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ í•¨ìˆ˜ ë

        // 06-2-2. ì½¤ë§ˆ ì œê±° í•¨ìˆ˜ ì‹œì‘
        function removeCommas(str) {
            return str.replace(/,/g, '');
        }
        // 06-2-2. ì½¤ë§ˆ ì œê±° í•¨ìˆ˜ ë

        // 06-2-3. 14ìë¦¬ ì œí•œ í•¨ìˆ˜ (Fëª¨ë“œ êµ¬í˜„) ì‹œì‘
        function limitTo14Digits(value) {
            const cleanValue = removeCommas(value.toString());
            if (cleanValue.length > 14) {
                return cleanValue.substring(0, 14);
            }
            return cleanValue;
        }
        // 06-2-3. 14ìë¦¬ ì œí•œ í•¨ìˆ˜ (Fëª¨ë“œ êµ¬í˜„) ë
        /* ===== 06-2. ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-3. ë©”ëª¨ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-3-1. ë©”ëª¨ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì™¼ìª½ ìœ„ M í‘œì‹œ) ì‹œì‘
        function updateMemoryIndicator() {
            const memoryIndicator = document.getElementById('memory-indicator');
            if (calculatorMemory !== 0) {
                memoryIndicator.textContent = 'M';
            } else {
                memoryIndicator.textContent = '';
            }
        }
        // 06-3-1. ë©”ëª¨ë¦¬ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì™¼ìª½ ìœ„ M í‘œì‹œ) ë
        /* ===== 06-3. ë©”ëª¨ë¦¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-4. ë””ìŠ¤í”Œë ˆì´ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-4-1. ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ì½¤ë§ˆ í¬í•¨, 14ìë¦¬ ì œí•œ) ì‹œì‘
        function updateDisplay(value) {
            const displayElement = document.getElementById('display-value');
            const limitedValue = limitTo14Digits(value);
            
            if (!isNaN(limitedValue) && limitedValue !== '' && !limitedValue.includes('Error')) {
                const numValue = parseFloat(limitedValue);
                if (Number.isInteger(numValue) && numValue >= 1000) {
                    displayElement.textContent = formatNumberWithCommas(numValue);
                } else {
                    displayElement.textContent = limitedValue;
                }
            } else {
                displayElement.textContent = limitedValue;
            }
        }
        // 06-4-1. ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ (ì½¤ë§ˆ í¬í•¨, 14ìë¦¬ ì œí•œ) ë

        // 06-4-2. ë°±ìŠ¤í˜ì´ìŠ¤ ê¸°ëŠ¥ ì‹œì‘
        function backspace() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const cleanDisplay = removeCommas(currentDisplay);
            
            if (cleanDisplay.length > 1) {
                const newValue = cleanDisplay.slice(0, -1);
                updateDisplay(newValue);
                currentExpression = newValue;
            } else {
                updateDisplay('0');
                currentExpression = '0';
            }
            shouldClearOnNextInput = false;
        }
        // 06-4-2. ë°±ìŠ¤í˜ì´ìŠ¤ ê¸°ëŠ¥ ë
        /* ===== 06-4. ë””ìŠ¤í”Œë ˆì´ ê´€ë ¨ í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-5. ê³„ì‚°ê¸°ë¡ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
// 06-5-1. ê³„ì‚° ê¸°ë¡ì— ê°’ ì¶”ê°€ ì‹œì‘
function addToCalculationHistory(value) {
    if (!isNaN(value) && value !== 0) {
        calculationHistory.push(value);
        if (calculationHistory.length > 20) {
            calculationHistory.shift(); // ìµœëŒ€ 20ê°œê¹Œì§€ë§Œ ìœ ì§€
        }
        updateHistoryDisplay();
    }
}
// 06-5-1. ê³„ì‚° ê¸°ë¡ì— ê°’ ì¶”ê°€ ë

// 06-5-2. ê³„ì‚° ê¸°ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸ (ì¤‘ë³µ ì œê±°ëœ ìµœì¢… ë²„ì „)
function updateHistoryDisplay() {
    const historyElement = document.getElementById('historyValues');
    if (!historyElement) return; // historyElementê°€ ì—†ëŠ” í™”ë©´(ê²°ê³¼ì°½ ë“±)ì—ì„œ ì˜¤ë¥˜ ë°©ì§€

    historyElement.innerHTML = '';
    
    if (calculationHistory.length === 0) {
        historyElement.innerHTML = '<span style="color: #6c757d; font-size: 11px;">ê³„ì‚° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</span>';
    } else {
        calculationHistory.forEach((value, index) => {
            const valueButton = document.createElement('span');
            valueButton.className = 'history-value';
            valueButton.textContent = formatNumberWithCommas(value);
            valueButton.onclick = () => useHistoryValue(value);
            historyElement.appendChild(valueButton);
        });
    }
}
// 06-5-2. ê³„ì‚° ê¸°ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸ ë

// 06-5-3. ê³„ì‚°ê¸°ë¡ ê°’ ì‚¬ìš©
function useHistoryValue(value) {
    const currentDisplay = document.getElementById('display-value').textContent;
    
    if (['+', '-', 'Ã—', 'Ã·', '*', '/'].includes(currentDisplay.trim())) {
        updateDisplay(value.toString());
    } else {
        if (shouldClearOnNextInput) {
            updateDisplay(value.toString());
        } else {
            const cleanDisplay = removeCommas(currentDisplay);
            if (cleanDisplay === '0') {
                updateDisplay(value.toString());
            } else {
                const newValue = cleanDisplay + value.toString();
                updateDisplay(limitTo14Digits(newValue));
            }
        }
    }
    shouldClearOnNextInput = false;
    currentExpression = removeCommas(document.getElementById('display-value').textContent);
}
// 06-5-3. ê³„ì‚°ê¸°ë¡ ê°’ ì‚¬ìš© ë

// 06-5-4. ê³„ì‚° ê¸°ë¡ ì „ì²´ ì‚­ì œ ì‹œì‘
function clearCalculationHistory() {
    calculationHistory = [];
    updateHistoryDisplay();
}
// 06-5-4. ê³„ì‚° ê¸°ë¡ ì „ì²´ ì‚­ì œ ë
/* ===== 06-5. ê³„ì‚°ê¸°ë¡ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ë ===== */

        
        /* ===== 06-7. ê¸°ë³¸ ê³„ì‚°ê¸° í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-7-1. ìˆ«ì/ì—°ì‚°ì ì…ë ¥ ì²˜ë¦¬ ì‹œì‘
        function appendToDisplay(value) {
            if (shouldClearOnNextInput) {
                updateDisplay(value);
                shouldClearOnNextInput = false;
            } else {
                const currentDisplay = document.getElementById('display-value').textContent;
                const cleanDisplay = removeCommas(currentDisplay);
                
                if (cleanDisplay === '0' && value !== '.') {
                    updateDisplay(value);
                } else {
                    const newValue = cleanDisplay + value;
                    updateDisplay(limitTo14Digits(newValue));
                }
            }
            currentExpression = removeCommas(document.getElementById('display-value').textContent);
        }
        // 06-7-1. ìˆ«ì/ì—°ì‚°ì ì…ë ¥ ì²˜ë¦¬ ë

        // 06-7-2. ì „ì²´ ì§€ìš°ê¸° (AC) ì‹œì‘
        function clearAll() {
            updateDisplay('0');
            currentExpression = '';
            shouldClearOnNextInput = false;
        }
        // 06-7-2. ì „ì²´ ì§€ìš°ê¸° (AC) ë

        // 06-7-3. í˜„ì¬ ì…ë ¥ ì§€ìš°ê¸° (C) ì‹œì‘
        function clearEntry() {
            updateDisplay('0');
            shouldClearOnNextInput = false;
        }
        // 06-7-3. í˜„ì¬ ì…ë ¥ ì§€ìš°ê¸° (C) ë

        // 06-7-4. ê³„ì‚° ì‹¤í–‰ (=) ì‹œì‘
        function calculate() {
            try {
                const cleanExpression = removeCommas(document.getElementById('display-value').textContent);
                const expression = cleanExpression.replace(/Ã—/g, '*').replace(/Ã·/g, '/');
                const result = eval(expression);
                grandTotalMemory += result;
                
                addToCalculationHistory(result);
                
                updateDisplay(result.toString());
                currentExpression = result.toString();
                shouldClearOnNextInput = true;
            } catch (error) {
                updateDisplay('Error');
            }
        }
        // 06-7-4. ê³„ì‚° ì‹¤í–‰ (=) ë
        /* ===== 06-7. ê¸°ë³¸ ê³„ì‚°ê¸° í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-8. ë©”ëª¨ë¦¬ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-8-1. ë©”ëª¨ë¦¬ì— ë”í•˜ê¸° (M+) ì‹œì‘
        function memoryAdd() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const cleanDisplay = removeCommas(currentDisplay);
            
            if (/[\+\-\*\/Ã—Ã·]/.test(cleanDisplay)) {
                try {
                    const expression = cleanDisplay.replace(/Ã—/g, '*').replace(/Ã·/g, '/');
                    const result = eval(expression);
                    updateDisplay(result.toString());
                    calculatorMemory += result;
                    addToCalculationHistory(result);
                } catch (error) {
                    const currentValue = parseFloat(cleanDisplay) || 0;
                    calculatorMemory += currentValue;
                    addToCalculationHistory(currentValue);
                }
            } else {
                const currentValue = parseFloat(cleanDisplay) || 0;
                calculatorMemory += currentValue;
                addToCalculationHistory(currentValue);
            }
            updateMemoryIndicator();
            shouldClearOnNextInput = true;
        }
        // 06-8-1. ë©”ëª¨ë¦¬ì— ë”í•˜ê¸° (M+) ë

        // 06-8-2. ë©”ëª¨ë¦¬ì—ì„œ ë¹¼ê¸° (M-) ì‹œì‘
        function memorySubtract() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const cleanDisplay = removeCommas(currentDisplay);
            
            if (/[\+\-\*\/Ã—Ã·]/.test(cleanDisplay)) {
                try {
                    const expression = cleanDisplay.replace(/Ã—/g, '*').replace(/Ã·/g, '/');
                    const result = eval(expression);
                    updateDisplay(result.toString());
                    calculatorMemory -= result;
                } catch (error) {
                    const currentValue = parseFloat(cleanDisplay) || 0;
                    calculatorMemory -= currentValue;
                }
            } else {
                const currentValue = parseFloat(cleanDisplay) || 0;
                calculatorMemory -= currentValue;
            }
            updateMemoryIndicator();
            shouldClearOnNextInput = true;
        }
        // 06-8-2. ë©”ëª¨ë¦¬ì—ì„œ ë¹¼ê¸° (M-) ë

        // 06-8-3. ë©”ëª¨ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° (MR) ì‹œì‘
        function memoryRecall() {
            updateDisplay(calculatorMemory.toString());
            shouldClearOnNextInput = true;
        }
        // 06-8-3. ë©”ëª¨ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° (MR) ë

        // 06-8-4. ë©”ëª¨ë¦¬ ì§€ìš°ê¸° (MC) ì‹œì‘
        function memoryClear() {
            calculatorMemory = 0;
            updateMemoryIndicator();
        }
        // 06-8-4. ë©”ëª¨ë¦¬ ì§€ìš°ê¸° (MC) ë

        // 06-8-5. ë©”ëª¨ë¦¬ êµí™˜ (M/EX) ì‹œì‘
        function memoryExchange() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const currentValue = parseFloat(removeCommas(currentDisplay)) || 0;
            const temp = calculatorMemory;
            calculatorMemory = currentValue;
            updateDisplay(temp.toString());
            updateMemoryIndicator();
            shouldClearOnNextInput = true;
        }
        // 06-8-5. ë©”ëª¨ë¦¬ êµí™˜ (M/EX) ë

        // 06-8-6. ì´í•© í‘œì‹œ (GT) ì‹œì‘
        function grandTotal() {
            updateDisplay(grandTotalMemory.toString());
            shouldClearOnNextInput = true;
        }
        // 06-8-6. ì´í•© í‘œì‹œ (GT) ë
        /* ===== 06-8. ë©”ëª¨ë¦¬ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-9. íŠ¹ìˆ˜ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
        // 06-9-1. í¼ì„¼íŠ¸ ê³„ì‚° (%) ì‹œì‘
        function percentage() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const value = parseFloat(removeCommas(currentDisplay));
            const result = value / 100;
            updateDisplay(result.toString());
            addToCalculationHistory(result);
            shouldClearOnNextInput = true;
        }
        // 06-9-1. í¼ì„¼íŠ¸ ê³„ì‚° (%) ë

        // 06-9-2. ì œê³±ê·¼ ê³„ì‚° (âˆš) ì‹œì‘
        function squareRoot() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const value = parseFloat(removeCommas(currentDisplay));
            const result = Math.sqrt(value);
            updateDisplay(result.toString());
            addToCalculationHistory(result);
            shouldClearOnNextInput = true;
        }
        // 06-9-2. ì œê³±ê·¼ ê³„ì‚° (âˆš) ë

        // 06-9-3. ë¶€í˜¸ ë³€ê²½ (+/-) ì‹œì‘
        function changeSign() {
            const currentDisplay = document.getElementById('display-value').textContent;
            const value = parseFloat(removeCommas(currentDisplay));
            updateDisplay((-value).toString());
        }
        // 06-9-3. ë¶€í˜¸ ë³€ê²½ (+/-) ë
        /* ===== 06-9. íŠ¹ìˆ˜ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ë ===== */

        /* ===== 06-10. ì‚¬ì´ë“œë°” ê´€ë ¨ í•¨ìˆ˜ë“¤ (ë‹¤ì¤‘ ì¤‘ì²© ë©”ë‰´ ì§€ì›) ì‹œì‘ ===== */
        // 06-10-1. ì‚¬ì´ë“œë°” í† ê¸€ ì‹œì‘
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('show');
            }
        }
        // 06-10-1. ì‚¬ì´ë“œë°” í† ê¸€ ë

        // 06-10-2. ì‚¬ì´ë“œë°” ë‹«ê¸° ì‹œì‘
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
        }
        // 06-10-2. ì‚¬ì´ë“œë°” ë‹«ê¸° ë

        // 06-10-3. ì„œë¸Œë©”ë‰´ í† ê¸€ (ë‹¤ì¤‘ ì¤‘ì²© ì§€ì›) ì‹œì‘
        function toggleSubmenu(menuId) {
            const submenu = document.getElementById(menuId + '-submenu');
            if (submenu) {
                if (submenu.classList.contains('show') || submenu.style.display === 'block') {
                    submenu.classList.remove('show');
                    submenu.style.display = 'none';
                } else {
                    submenu.classList.add('show');
                    submenu.style.display = 'block';
                }
            }
        }
        // 06-10-3. ì„œë¸Œë©”ë‰´ í† ê¸€ (ë‹¤ì¤‘ ì¤‘ì²© ì§€ì›) ë

/* ===== (ìˆ˜ì •) 06-10-4. ê³¼ëª©/ë‹¨ì› ì„ íƒ ì²˜ë¦¬ í•¨ìˆ˜ (ì‚¬ì´ë“œë°” ë‹«ê¸° ì¶”ê°€) ===== */
async function selectChapter(subject, chapter, isReturning = false) {
    // ì±•í„° ì„ íƒ ì‹œ, ì¦‰ì‹œ ì‚¬ì´ë“œë°”ë¥¼ ë‹«ì•„ ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•©ë‹ˆë‹¤.
    closeSidebar(); 

    console.log(`ğŸ¯ selectChapter í˜¸ì¶œë¨: ${subject}, ${chapter} (í™œì„±íƒ­: ${activeTab})`);

    if (activeTab === 'quiz') {
        await loadQuizChapter(subject, chapter, isReturning);
    } else if (activeTab === 'theory') {
        await loadTheoryChapter(subject, chapter);
    } else {
        console.log(`${activeTab} íƒ­ì—ì„œëŠ” ì±•í„° ì„ íƒ ê¸°ëŠ¥ì´ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }
}


// (ìˆ˜ì •) 06-10-4-1. í€´ì¦ˆ ì±•í„° ë¡œë”© í•¨ìˆ˜
async function loadQuizChapter(subject, chapter, isReturning) {
    if (!document.getElementById('quiz-layout')) {
        const mainContent = document.querySelector('.main-content');
        if (mainContent) { mainContent.innerHTML = getMainContentHTML(); }
    }
    
    const breadcrumb = document.getElementById('breadcrumb-text');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');

    if (!breadcrumb || !questionText || !optionsContainer) {
        console.error('âŒ í•„ìˆ˜ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }

    // ê²½ë¡œ í‘œì‹œ ë¡œì§ (ìƒëµí•˜ì§€ ì•ŠìŒ)
    let path = ['1ì°¨ ì‹œí—˜ ë¬¸ì œí’€ì´'];
    const subjectToPath = {
        'ì¬ë¬´íšŒê³„': ['íšŒê³„í•™ê°œë¡ ', 'ê³¼ëª©ë³„ ê¸°ì¶œ'], 'ì›ê°€ê´€ë¦¬íšŒê³„': ['íšŒê³„í•™ê°œë¡ ', 'ê³¼ëª©ë³„ ê¸°ì¶œ'], 'íšŒê³„í•™ê°œë¡ ': ['íšŒê³„í•™ê°œë¡ '],
        'ë²•ì¸ì„¸ë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'], 'ì†Œë“ì„¸ë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'], 'ë¶€ê°€ê°€ì¹˜ì„¸ë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'],
        'êµ­ì„¸ê¸°ë³¸ë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'], 'êµ­ì„¸ì§•ìˆ˜ë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'], 'ì¡°ì„¸ë²”ì²˜ë²Œë²•': ['ì„¸ë²•í•™ê°œë¡ ', 'ì„¸ëª©ë³„ ê¸°ì¶œ'],
        'ì„¸ë²•í•™ê°œë¡ ': ['ì„¸ë²•í•™ê°œë¡ '], 'ì¬ì •í•™': ['ì¬ì •í•™'], 'í–‰ì •ì†Œì†¡ë²•': ['í–‰ì •ì†Œì†¡ë²•'],
    };
    if (subjectToPath[subject]) { path.push(...subjectToPath[subject]); }
    path.push(chapter.includes('ê¸°ì¶œë¬¸ì œ') || chapter.includes('AIì¶”ì²œ') ? chapter : `ë‹¨ì›ë³„ ê¸°ì¶œ > ${chapter}`);
    breadcrumb.innerHTML = path.map((p, i) => i === path.length - 1 ? `<span class="current">${p.split(' > ').pop()}</span>` : `<span>${p}</span>`).join(' &gt; ');

    questionText.textContent = `${subject} ${chapter} ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
    optionsContainer.innerHTML = '';
    
    if (!isReturning) { resetQuizState(); }
    
    // closeSidebar(); // ì´ í•¨ìˆ˜ëŠ” ìƒìœ„ í•¨ìˆ˜ì¸ selectChapterì—ì„œ ì´ë¯¸ í˜¸ì¶œë˜ë¯€ë¡œ ì¤‘ë³µ ì œê±°
    // switchTab('quiz'); // (í•µì‹¬ ìˆ˜ì •) ì´ ë¼ì¸ì„ ì œê±°í•˜ì—¬ ì‚¬ì´ë“œë°”ê°€ ë‹¤ì‹œ ì—´ë¦¬ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

    try {
        const questions = await loadQuestionsFromBack4App(subject, chapter, subject);
        
        if (questions.length > 0) {
            currentQuestionSet = questions;
            currentQuestionIndex = 0;
            if (!isReturning) { pushToViewHistory({ view: 'quiz', data: { subject, chapter } }); }
            setupQuizInterface();
            loadQuestion(questions[0]);
            updateQuestionCounter();
        } else {
            questionText.textContent = `${subject} ${chapter}ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.`;
        }
    } catch (error) {
        console.error('âŒ ë¬¸ì œ ë¡œë”© ì‹¤íŒ¨:', error);
        questionText.textContent = 'ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    }
}


/* ===== (ìµœì¢… ìˆ˜ì •) 06-10-4-2. ì´ë¡  ì±•í„° ë¡œë”© í•¨ìˆ˜ (í˜ì´ì§€ ë¶„í•  ì•Œê³ ë¦¬ì¦˜ ì ìš©) ===== */
async function loadTheoryChapter(subject, chapter) {
    const breadcrumb = document.getElementById('breadcrumb-text');
    const loadingSpinner = document.getElementById('theoryLoadingSpinner');
    const theoryBook = document.getElementById('theoryBook');
    const theoryMainContent = document.getElementById('theoryMainContent');
    if (!breadcrumb || !loadingSpinner || !theoryBook || !theoryMainContent) return;

    // 1. ë¡œë”© í™”ë©´ í‘œì‹œ ë° ê²½ë¡œ ì—…ë°ì´íŠ¸
    loadingSpinner.innerHTML = `ğŸ“š <strong>${subject} &gt; ${chapter}</strong> ì´ë¡ ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
    loadingSpinner.style.display = 'block';
    theoryBook.style.display = 'none';
    theoryBook.innerHTML = '';
    let path = ['ì´ë¡ í•™ìŠµ', subject, chapter];
    breadcrumb.innerHTML = path.map((p, i) => i === path.length - 1 ? `<span class="current">${p}</span>` : `<span>${p}</span>`).join(' &gt; ');

    try {
        // 2. Back4Appì—ì„œ í•´ë‹¹ ì±•í„°ì˜ ëª¨ë“  ì½˜í…ì¸  ì¡°ê°ì„ ê°€ì ¸ì˜´
        const theoryContents = await loadTheoryContentFromBack4App(subject, chapter);
        if (theoryContents.length > 0) {
            // 3. ê°€ì ¸ì˜¨ ëª¨ë“  HTML ì¡°ê°ì„ í•˜ë‚˜ì˜ ê¸´ HTML ë¬¸ìì—´ë¡œ í•©ì¹¨
            const fullHtmlContent = theoryContents.map(item => item.content).join('');
            
            // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
            //       ì´ ë¶€ë¶„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤
            // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
            const pages = splitHtmlIntoPagesByActualHeight(fullHtmlContent);

            // 4. ë¶„í• ëœ í˜ì´ì§€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì±… ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
            renderTheoryBookAsPages(pages);
            
            // 5. í”Œë¡œíŒ… ëª©ì°¨ ìƒì„± ë° ìŠ¤í¬ë¡¤ ìŠ¤íŒŒì´ ì´ë²¤íŠ¸ ì—°ê²°
            const firstPage = document.querySelector('.theory-page');
            if (firstPage) {
                renderFloatingTOC(theoryBook);
                document.querySelectorAll('.theory-page').forEach(page => {
                    page.removeEventListener('scroll', updateScrollSpy);
                    page.addEventListener('scroll', updateScrollSpy);
                });
            }
            
            loadingSpinner.style.display = 'none';
            theoryBook.style.display = 'flex';
        } else {
            loadingSpinner.innerHTML = `ğŸ˜¥ í•´ë‹¹ ì±•í„°(<strong>${subject} &gt; ${chapter}</strong>)ì— ëŒ€í•œ ì´ë¡  ì½˜í…ì¸ ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
        }
    } catch (error) {
        console.error('âŒ ì´ë¡  ì½˜í…ì¸  ë¡œë”© ì‹¤íŒ¨:', error);
        loadingSpinner.innerHTML = 'ì´ë¡  ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    }
}

// (ì‹ ê·œ) 06-10-4-3. ë¶„í• ëœ í˜ì´ì§€ ë°°ì—´ì„ ë°›ì•„ ì±…ì„ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
function renderTheoryBookAsPages(pages) {
    const theoryBook = document.getElementById('theoryBook');
    if (!theoryBook) return;
    
    theoryBook.innerHTML = '';
    theoryBook.style.width = '';

    let finalHtml = '';
    for (let i = 0; i < pages.length; i += 2) {
        const leftPageContent = pages[i] || '';
        const rightPageContent = pages[i + 1] || '';

        finalHtml += `
            <div class="theory-page-spread">
                <div class="theory-page theory-left-page">
                    <div class="theory-content-wrapper">${leftPageContent}</div>
                    <div class="theory-page-number">${i + 1}</div>
                </div>
                <div class="theory-page theory-right-page">
                    <div class="theory-content-wrapper">${rightPageContent}</div>
                    <div class="theory-page-number">${i + 2}</div>
                </div>
            </div>
        `;
    }
    
    theoryBook.innerHTML = finalHtml;
}


// (ì‹ ê·œ) 06-10-5. ì´ë¡  ì½˜í…ì¸ ë¥¼ 'ë‘ í˜ì´ì§€ ë³´ê¸°'ë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
function renderTheoryBook(contents) {
    const theoryBook = document.getElementById('theoryBook');
    if (!theoryBook) return;

    // 1. ë°ì´í„°ë¥¼ 'pageGroup' ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í¼ì¹œ í˜ì´ì§€ ë‹¨ìœ„ë¡œ ë¬¶ìŠµë‹ˆë‹¤.
    const pagesByGroup = contents.reduce((acc, item) => {
        const group = item.pageGroup;
        if (!acc[group]) acc[group] = [];
        // (ìˆ˜ì •) ê·¸ë£¹í™” ì‹œ contentë¿ë§Œ ì•„ë‹ˆë¼ order ì •ë³´ë„ í•¨ê»˜ ì €ì¥í•©ë‹ˆë‹¤.
        acc[group].push({ 
            content: item.content, 
            order: item.order 
        });
        return acc;
    }, {});

    let finalHtml = '';
    let pageCounter = 1;
    // 2. ê·¸ë£¹í™”ëœ ë°ì´í„°ë¥¼ pageGroup ë²ˆí˜¸ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    Object.keys(pagesByGroup).sort((a, b) => a - b).forEach(groupKey => {
        const groupContents = pagesByGroup[groupKey].sort((a, b) => a.order - b.order); // ê·¸ë£¹ ë‚´ì—ì„œë„ orderë¡œ ì •ë ¬
        
        const leftPageContent = groupContents[0] ? groupContents[0].content : '';
        const rightPageContent = groupContents[1] ? groupContents[1].content : '';

        finalHtml += `
            <div class="theory-page-spread">
                <div class="theory-page theory-left-page">
                    <div class="theory-content-wrapper">${leftPageContent}</div>
                    <div class="theory-page-number">${pageCounter++}</div>
                </div>
                <div class="theory-page theory-right-page">
                    <div class="theory-content-wrapper">${rightPageContent}</div>
                    <div class="theory-page-number">${pageCounter++}</div>
                </div>
            </div>
        `;
    });
    
    // (í•µì‹¬ ìˆ˜ì •) ë ˆì´ì•„ì›ƒì„ ë§ê°€ëœ¨ë¦¬ëŠ” ì›ì¸ì´ì—ˆë˜ ì•„ë˜ ì½”ë“œ ë¼ì¸ì„ ì™„ì „íˆ ì‚­ì œí•©ë‹ˆë‹¤.
    // theoryBook.style.width = `${Object.keys(pagesByGroup).length * 100}%`; 
    
    theoryBook.innerHTML = finalHtml;
}


// (ê°œì„ ) 06-10-6. ì´ë¡  ì±… ë„˜ê¹€(ìŠ¤ì™€ì´í”„) ê¸°ëŠ¥ ì„¤ì • í•¨ìˆ˜
function setupTheoryBookNavigation() {
    const book = document.getElementById('theoryBook');
    const mainContent = document.getElementById('theoryMainContent');
    if (!book || !mainContent) return;

    const spreads = book.querySelectorAll('.theory-page-spread');
    if (spreads.length === 0) return;

    let currentPage = 0;
    let isDragging = false;
    let startPos = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    
    // (ìˆ˜ì •) spreadWidthë¥¼ letìœ¼ë¡œ ì„ ì–¸í•˜ì—¬ ë‚˜ì¤‘ì— ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    let spreadWidth = mainContent.clientWidth;

    function setPositionByIndex() {
        currentTranslate = currentPage * -spreadWidth;
        prevTranslate = currentTranslate;
        book.style.transform = `translateX(${currentTranslate}px)`;
    }

    setPositionByIndex();

    book.addEventListener('mousedown', dragStart);
    book.addEventListener('touchstart', dragStart, { passive: true });
    book.addEventListener('mouseup', dragEnd);
    book.addEventListener('touchend', dragEnd);
    book.addEventListener('mouseleave', dragEnd);
    book.addEventListener('mousemove', drag);
    book.addEventListener('touchmove', drag, { passive: true });

    // (í•µì‹¬ ìˆ˜ì •) ì°½ í¬ê¸° ë³€ê²½ ì‹œ, spreadWidthë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ê³  ìœ„ì¹˜ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤.
    window.addEventListener('resize', () => {
        spreadWidth = mainContent.clientWidth; // í˜ì´ì§€ ë„ˆë¹„ë¥¼ ë‹¤ì‹œ ê³„ì‚°
        setPositionByIndex();
    });

    function getPositionX(event) {
        return event.type.includes('mouse') ? event.pageX : event.touches[0].clientX;
    }

    function dragStart(event) {
        isDragging = true;
        startPos = getPositionX(event);
        book.style.transition = 'none';
    }

    function drag(event) {
        if (isDragging) {
            const currentPosition = getPositionX(event);
            currentTranslate = prevTranslate + currentPosition - startPos;
            book.style.transform = `translateX(${currentTranslate}px)`;
        }
    }

    function dragEnd(event) {
        if (!isDragging) return;
        isDragging = false;
        const movedBy = currentTranslate - prevTranslate;
        if (movedBy < -spreadWidth / 5 && currentPage < spreads.length - 1) {
            currentPage++;
        }
        if (movedBy > spreadWidth / 5 && currentPage > 0) {
            currentPage--;
        }
        book.style.transition = 'transform 0.3s ease-out';
        setPositionByIndex();
    }
}


/* ===== (ì‹ ê·œ) 06-11. í”Œë¡œíŒ… ëª©ì°¨(TOC) ê´€ë ¨ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */

// 06-11-1. ì˜¤ë¥¸ìª½ í”Œë¡œíŒ… ëª©ì°¨ë¥¼ ì—´ê³  ë‹«ëŠ” í•¨ìˆ˜
function toggleFloatingTOC() {
    const toc = document.getElementById('floating-toc');
    toc.classList.toggle('open');
}

// 06-11-2. ì´ë¡  ë³¸ë¬¸ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ í”Œë¡œíŒ… ëª©ì°¨ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
function renderFloatingTOC(contentContainer) {
    const tocList = document.getElementById('floating-toc-list');
    tocList.innerHTML = '';
    const headings = contentContainer.querySelectorAll('h1, h2, h3');

    if (headings.length === 0) {
        tocList.innerHTML = '<li>ìƒì„¸ ëª©ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
    }

    headings.forEach((heading, index) => {
        const id = `toc-heading-${index}`;
        heading.id = id; // ë³¸ë¬¸ ì œëª©ì— ID ë¶€ì—¬

        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#${id}`;
        a.textContent = heading.textContent;
        a.dataset.level = heading.tagName.toLowerCase(); // h1, h2, h3 êµ¬ë¶„ì„ ìœ„í•´ ë°ì´í„° ì†ì„± ì¶”ê°€
        a.dataset.targetId = id; // ìŠ¤í¬ë¡¤ ìŠ¤íŒŒì´ì—ì„œ ì‚¬ìš©í•  íƒ€ê²Ÿ ID

        a.onclick = (e) => {
            e.preventDefault();
            heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
            toggleFloatingTOC(); // ëª©ì°¨ í•­ëª© í´ë¦­ ì‹œ ìë™ìœ¼ë¡œ ë‹«ê¸°
        };

        li.appendChild(a);
        tocList.appendChild(li);
    });
}

// 06-11-3. ë³¸ë¬¸ ìŠ¤í¬ë¡¤ì— ë”°ë¼ í”Œë¡œíŒ… ëª©ì°¨ë¥¼ í•˜ì´ë¼ì´íŠ¸í•˜ëŠ” 'ìŠ¤í¬ë¡¤ ìŠ¤íŒŒì´' í•¨ìˆ˜
function updateScrollSpy() {
    const headings = document.querySelectorAll('.theory-content-wrapper h1, .theory-content-wrapper h2, .theory-content-wrapper h3');
    const tocLinks = document.querySelectorAll('.floating-toc-list a');
    let activeId = null;

    // í™”ë©´ ìƒë‹¨ì—ì„œ 150px ì•„ë˜ ì§€ì ì„ ê¸°ì¤€ìœ¼ë¡œ í™œì„± ì„¹ì…˜ì„ ì°¾ìŠµë‹ˆë‹¤.
    const scrollThreshold = 150; 

    for (let i = headings.length - 1; i >= 0; i--) {
        const heading = headings[i];
        const rect = heading.getBoundingClientRect();
        if (rect.top <= scrollThreshold) {
            activeId = heading.id;
            break;
        }
    }

    tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.dataset.targetId === activeId) {
            link.classList.add('active');
        }
    });
}
/* ===== (ì‹ ê·œ) 06-11. í”Œë¡œíŒ… ëª©ì°¨(TOC) ê´€ë ¨ í•¨ìˆ˜ë“¤ ë ===== */

/* ===== 06-12. ê¸°íƒ€ UI í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */

// 06-12-0. í™”ë©´ ì´ë™ ê¸°ë¡ì„ ê´€ë¦¬í•˜ëŠ” í•¨ìˆ˜
function pushToViewHistory(state) {
    if (viewHistory.length > 0) {
        const lastView = viewHistory[viewHistory.length - 1];
        if (lastView.view === state.view && JSON.stringify(lastView.data) === JSON.stringify(state.data)) {
            return;
        }
    }
    viewHistory.push(state);
    updateBackButtonState();
}

// 06-12-1. ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateBackButtonState() {
    const backBtn = document.querySelector('.back-btn');
    if(backBtn) {
        backBtn.disabled = (viewHistory.length <= 1);
    }
}

// 06-12-2. í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™” í•¨ìˆ˜
function resetQuizState() {
    console.log('ğŸ”„ í€´ì¦ˆ ìƒíƒœ ì´ˆê¸°í™”');
    currentQuestionSet = [];
    currentQuestionIndex = 0;
    selectedAnswers = {};
    userAnswers = {};
    quizCompleted = false;
    workspaceStates = {}; // ì—°ìŠµì¥ ìƒíƒœ ì´ˆê¸°í™”
    annotationStates = {}; // (ì¶”ê°€) ì£¼ì„ ìƒíƒœ ì´ˆê¸°í™”
    if(typeof resetTimer === 'function') {
        resetTimer();
    }
}

// (ìˆ˜ì •) 06-12-3. ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ëŠ” í•¨ìˆ˜
function goHome() {
    console.log('ğŸ  ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°');
    viewHistory = []; 
    pushToViewHistory({ view: 'home', data: null });
    
    const mainContent = document.querySelector('.main-content');
    mainContent.innerHTML = getMainContentHTML(); 

    document.getElementById('breadcrumb-text').innerHTML = 'ì„¸ë²• í•™ìŠµ ì‹œìŠ¤í…œ';
    
    // í™”ë©´ì„ ê·¸ë¦° ì§í›„, ê´€ë ¨ ê¸°ëŠ¥ë“¤ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    setupQuizInterface();
    updateHistoryDisplay();

    // (í•µì‹¬ ìˆ˜ì •) switchTab ëŒ€ì‹ , ì´ˆê¸° í™”ë©´ ìƒíƒœë¥¼ ì§ì ‘ ì„¤ì •í•©ë‹ˆë‹¤.
    // ì´ë ‡ê²Œ í•˜ë©´ ì‚¬ì´ë“œë°”ê°€ ì—´ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.
    activeTab = 'quiz';
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.tab-btn[onclick="switchTab(\'quiz\')"]').classList.add('active');
    document.getElementById('quiz-layout').style.display = 'flex';
    document.getElementById('theory-layout').style.display = 'none';
    document.getElementById('progress-layout').style.display = 'none';
}


// 06-12-4. ë’¤ë¡œê°€ê¸° ê¸°ëŠ¥ êµ¬í˜„ (ìƒˆë¡œìš´ ë¡œì§)
function goBack() {
    if (viewHistory.length <= 1) {
        goHome();
        return;
    }

    viewHistory.pop(); // í˜„ì¬ ë·°ë¥¼ íˆìŠ¤í† ë¦¬ì—ì„œ ì œê±°
    const previousState = viewHistory[viewHistory.length - 1];
    console.log("ë’¤ë¡œê°€ê¸° ì‹¤í–‰. ë˜ëŒì•„ê°ˆ í™”ë©´:", previousState);

    // ì´ì „ ìƒíƒœì— ë”°ë¼ í™”ë©´ì„ ë³µì› (í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ í™”ë©´ì„ ê·¸ë¦¼)
    switch (previousState.view) {
        case 'quiz':
            selectChapter(previousState.data.subject, previousState.data.chapter, true); // isReturning = true
            break;
        case 'results':
            showResults();
            break;
        case 'detail':
            showQuestionDetail(previousState.data);
            break;
        case 'allExplanations':
            showAllExplanations();
            break;
        default:
            goHome();
            break;
    }
}

/* ===== (ìµœì¢… ìˆ˜ì •) 06-12-5. íƒ­ ì „í™˜ í•¨ìˆ˜ (í™”ë©´ ë³µêµ¬ ê¸°ëŠ¥ ì¶”ê°€) ===== */
function switchTab(tabName) {
    // (í•µì‹¬ ë¡œì§) í˜„ì¬ í™”ë©´ì— í€´ì¦ˆ/ì´ë¡  ë ˆì´ì•„ì›ƒì´ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    // ì—†ë‹¤ë©´(ì˜ˆ: ê²°ê³¼í™”ë©´), ë©”ì¸ í™”ë©´ ë¼ˆëŒ€ë¶€í„° ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
    if (!document.getElementById('quiz-layout')) {
        console.log('ë¼ˆëŒ€ ì—†ìŒ! ë©”ì¸ ë ˆì´ì•„ì›ƒì„ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.');
        const mainContent = document.querySelector('.main-content');
        mainContent.innerHTML = getMainContentHTML();
        // ë¼ˆëŒ€ë¥¼ ë‹¤ì‹œ ê·¸ë ¸ìœ¼ë¯€ë¡œ, í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ë‹¤ì‹œ ì—°ê²°í•´ì¤ë‹ˆë‹¤.
        setupQuizInterface();
        updateHistoryDisplay();
    }

    activeTab = tabName;
    console.log(`ğŸ“˜ íƒ­ ì „í™˜: ${tabName}, ì‚¬ì´ë“œë°”ë¥¼ ì—½ë‹ˆë‹¤.`);

    // 1. ëª¨ë“  íƒ­ ë²„íŠ¼ì˜ í™œì„± ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³ , í´ë¦­ëœ íƒ­ë§Œ í™œì„±í™”í•©ë‹ˆë‹¤.
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    const activeButton = document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`);
    if (activeButton) activeButton.classList.add('active');

    // 2. ëª¨ë“  ë©”ì¸ ë ˆì´ì•„ì›ƒì„ ìˆ¨ê¹ë‹ˆë‹¤.
    document.getElementById('quiz-layout').style.display = 'none';
    document.getElementById('theory-layout').style.display = 'none';
    document.getElementById('progress-layout').style.display = 'none';
    
    // 3. ì˜¤ë¥¸ìª½ ìƒì„¸ ëª©ì°¨ ë²„íŠ¼('ğŸ“– ìƒì„¸ëª©ì°¨')ì˜ í‘œì‹œ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.
    const floatingTocBtn = document.getElementById('floating-toc-btn');
    if (floatingTocBtn) {
        floatingTocBtn.style.display = (tabName === 'theory') ? 'inline-flex' : 'none';
    }

    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const sidebarTitle = document.getElementById('sidebar-title');
    const quizMenu = document.getElementById('quiz-menu-content');
    const theoryMenu = document.getElementById('theory-menu-content');

    // 4. íƒ­ ì¢…ë¥˜ì— ë”°ë¼ ë‹¤ë¥¸ ë™ì‘ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    if (tabName === 'quiz') {
        document.getElementById('quiz-layout').style.display = 'flex';
        sidebarTitle.textContent = 'ğŸ“ ë¬¸ì œí’€ì´ ëª©ì°¨';
        quizMenu.style.display = 'block';
        theoryMenu.style.display = 'none';
        sidebar.classList.add('open');
        overlay.classList.add('show');
    } else if (tabName === 'theory') {
        document.getElementById('theory-layout').style.display = 'flex';
        sidebarTitle.textContent = 'ğŸ“š í†µí•© ì´ë¡  í•™ìŠµ';
        quizMenu.style.display = 'none';
        theoryMenu.style.display = 'block';
        sidebar.classList.add('open');
        overlay.classList.add('show');
    } else if (tabName === 'progress') {
        document.getElementById('progress-layout').style.display = 'flex';
        // í•™ìŠµê´€ë¦¬ íƒ­ì—ì„œëŠ” ì‚¬ì´ë“œë°”ë¥¼ ë‹«ìŠµë‹ˆë‹¤.
        closeSidebar(); 
    }
}


/* ===== (ì‹ ê·œ) 06-12-6. ë©”ì¸ ì½˜í…ì¸  ë§ˆìŠ¤í„° í…œí”Œë¦¿ í•¨ìˆ˜ ===== */
// ì´ í•¨ìˆ˜ëŠ” ì•±ì˜ ê¸°ë³¸ ë ˆì´ì•„ì›ƒ(ë¬¸ì œí’€ì´, ì´ë¡ , í•™ìŠµê´€ë¦¬) HTMLì„ ë°˜í™˜í•©ë‹ˆë‹¤.
// ê²°ê³¼ í™”ë©´ ë“±ì—ì„œ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ì˜¬ ë•Œ ì´ í…œí”Œë¦¿ì„ ì‚¬ìš©í•´ ë¼ˆëŒ€ë¥¼ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
function getMainContentHTML() {
    return `
        <!-- 05-1. ë¬¸ì œí’€ì´ í™”ë©´ ë ˆì´ì•„ì›ƒ ì‹œì‘ -->
        <div class="quiz-layout" id="quiz-layout">
            <div class="main-column">
                <section class="quiz-section" id="quiz-section">
                    <canvas class="annotation-canvas" id="annotation-canvas"></canvas>
                    <div class="quiz-header">
                        <span id="question-counter">ë¬¸ì œ ì¤€ë¹„ì¤‘</span>
                        <span id="quiz-status">ëŒ€ê¸°</span>
                    </div>
                    <div class="question-container" id="question-container">
                        <h3 id="question-text">ëª©ì°¨ì—ì„œ ì›í•˜ëŠ” ê³¼ëª©ê³¼ ë‹¨ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
                        <div class="options-container" id="options-container"></div>
                    </div>
                </section>
                <div class="resizer-vertical" id="vertical-resizer"></div>
                <section class="workspace-section-new" id="workspace-section">
                    <div class="workspace-header">
                        <h3>âœï¸ ì—°ìŠµì¥ (ë¬¸ì œë³„ ìë™ì €ì¥)</h3>
                        <button class="draw-btn" onclick="clearAllCanvases()">ì „ì²´ í•„ê¸° ì§€ìš°ê¸°</button>
                    </div>
                    <canvas class="workspace-canvas" id="workspace-canvas"></canvas>
                </section>
            </div>
            <section class="calculator-section">
                <!-- ê³„ì‚°ê¸° HTML ì½”ë“œëŠ” ê¸¸ì–´ì„œ ìƒëµí•©ë‹ˆë‹¤. ì‹¤ì œ ì½”ë“œì—ì„œëŠ” ì´ ë¶€ë¶„ì´ í¬í•¨ë©ë‹ˆë‹¤. -->
                <div class="calculator-container">
                    <div class="calc-brand">CASIO JS-40B</div>
                    <div class="calculator-display" id="calc-display">
                        <div class="memory-indicator" id="memory-indicator"></div>
                        <div class="display-value" id="display-value">0</div>
                    </div>
                    <div class="calculator-buttons">
                        <button class="calc-btn memory" onclick="memoryExchange()">M/EX</button><button class="calc-btn function" onclick="percentage()">%</button><button class="calc-btn function" onclick="squareRoot()">âˆš</button><button class="calc-btn function" onclick="backspace()">âŒ«</button><button class="calc-btn memory" onclick="grandTotal()">GT</button>
                        <button class="calc-btn memory" onclick="memoryClear()">MC</button><button class="calc-btn memory" onclick="memoryRecall()">MR</button><button class="calc-btn memory" onclick="memorySubtract()">M-</button><button class="calc-btn memory" onclick="memoryAdd()">M+</button><button class="calc-btn operator" onclick="appendToDisplay('/')">Ã·</button>
                        <button class="calc-btn function" onclick="changeSign()">+/-</button><button class="calc-btn number" onclick="appendToDisplay('7')">7</button><button class="calc-btn number" onclick="appendToDisplay('8')">8</button><button class="calc-btn number" onclick="appendToDisplay('9')">9</button><button class="calc-btn operator" onclick="appendToDisplay('*')">Ã—</button>
                        <button class="calc-btn function" onclick="clearEntry()">C</button><button class="calc-btn number" onclick="appendToDisplay('4')">4</button><button class="calc-btn number" onclick="appendToDisplay('5')">5</button><button class="calc-btn number" onclick="appendToDisplay('6')">6</button><button class="calc-btn operator" onclick="appendToDisplay('-')">-</button>
                        <button class="calc-btn function" onclick="clearAll()">AC</button><button class="calc-btn number" onclick="appendToDisplay('1')">1</button><button class="calc-btn number" onclick="appendToDisplay('2')">2</button><button class="calc-btn number" onclick="appendToDisplay('3')">3</button><button class="calc-btn plus-tall" onclick="appendToDisplay('+')">+</button>
                        <button class="calc-btn number" onclick="appendToDisplay('0')">0</button><button class="calc-btn number" onclick="appendToDisplay('00')">00</button><button class="calc-btn number" onclick="appendToDisplay('.')">.</button><button class="calc-btn equals" onclick="calculate()">=</button>
                    </div>
                    <div class="calculation-history">
                        <div class="history-title">ê³„ì‚°ê¸°ë¡ <button class="clear-history-btn" onclick="clearCalculationHistory()">ì§€ìš°ê¸°</button></div>
                        <div class="history-values" id="historyValues"></div>
                    </div>
                </div>
            </section>
        </div>
        <!-- ì´ë¡ í•™ìŠµ í™”ë©´ ë ˆì´ì•„ì›ƒ -->
        <div class="theory-layout" id="theory-layout">
            <div class="theory-main-content" id="theoryMainContent">
                <div class="loading-spinner" id="theoryLoadingSpinner" style="display: none;"></div>
                <div class="theory-book" id="theoryBook"></div>
            </div>
        </div>
        <!-- í•™ìŠµê´€ë¦¬ í™”ë©´ ë ˆì´ì•„ì›ƒ -->
        <div id="progress-layout" style="display: none; justify-content: center; align-items: center; height: 100%;">ğŸ“Š í•™ìŠµê´€ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</div>
    `;
}


/* ===== 06-12. ê¸°íƒ€ UI í•¨ìˆ˜ë“¤ ë ===== */


/* ===== 06-13. íƒ€ì´ë¨¸ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ì‹œì‘ ===== */
let timerInterval = null;
let timerSeconds = 0;
let timerRunning = false;

function startTimer() {
    if (!timerRunning) {
        timerRunning = true;
        timerInterval = setInterval(() => {
            timerSeconds++;
            updateTimerDisplay();
        }, 1000);
        document.getElementById('start-timer-btn').disabled = true;
        document.getElementById('pause-timer-btn').disabled = false;
    }
}

function pauseTimer() {
    if (timerRunning) {
        timerRunning = false;
        clearInterval(timerInterval);
        document.getElementById('start-timer-btn').disabled = false;
        document.getElementById('pause-timer-btn').disabled = true;
    }
}

function resetTimer() {
    timerRunning = false;
    timerSeconds = 0;
    clearInterval(timerInterval);
    updateTimerDisplay();
    document.getElementById('start-timer-btn').disabled = false;
    document.getElementById('pause-timer-btn').disabled = true;
}

function updateTimerDisplay() {
    const hours = Math.floor(timerSeconds / 3600);
    const minutes = Math.floor((timerSeconds % 3600) / 60);
    const seconds = timerSeconds % 60;
    const timeString = 
        String(hours).padStart(2, '0') + ':' +
        String(minutes).padStart(2, '0') + ':' +
        String(seconds).padStart(2, '0');
    const timerElement = document.getElementById('timer');
    if (timerElement) {
        timerElement.textContent = timeString;
    }
}

function autoStartTimer() {
    if (!timerRunning && timerSeconds === 0) {
        startTimer();
    }
}
/* ===== 06-13. íƒ€ì´ë¨¸ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ ë ===== */


/* ===== 06-14. Back4App ì—°ë™ ë° í€´ì¦ˆ ë°ì´í„° ê´€ë¦¬ ì‹œì‘ ===== */

async function loadTheoryContentFromBack4App(subject, chapter) {
    console.log(`ğŸ” Back4App ì´ë¡  ì¿¼ë¦¬: ê³¼ëª©=<span class="math-inline">\{subject\}, ì±•í„°\=</span>{chapter}`);
    const TheoryContent = Parse.Object.extend("TheoryContent");
    const query = new Parse.Query(TheoryContent);

    try {
        query.equalTo("subject", subject); // 06-14-3-1. (ìœ ì§€) ê³¼ëª©ëª…(subject)ì€ í•­ìƒ ì¼ì¹˜í•´ì•¼ í•¨
        query.equalTo("isActive", true);

        // 06-14-3-2. (ìˆ˜ì •) 'ì „ì²´ ì´ë¡ 'ì¼ ê²½ìš° ì±•í„° í•„í„°ë§ì„ ê±´ë„ˆë›°ëŠ” ë¡œì§ ì¶”ê°€
        if (chapter !== 'ì „ì²´ ì´ë¡ ') {
            query.equalTo("chapter", chapter);
        }

        // 06-14-3-3. (ìˆ˜ì •) ìƒˆë¡œ ì¶”ê°€í•œ chapterNumberë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
        query.ascending("chapterNumber", "pageGroup", "order");
        query.limit(1000);

        const results = await query.find();
        console.log(`ğŸ“Š ${results.length}ê°œì˜ ì´ë¡  ì½˜í…ì¸ (í˜ì´ì§€)ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜´`);

        if (results.length === 0) return [];

        return results.map(result => ({
            pageGroup: result.get("pageGroup"),
            content: result.get("content")
        }));
    } catch (error) {
        console.error("âŒ Back4App ì´ë¡  ì¿¼ë¦¬ ì‹¤íŒ¨:", error);
        return [];
    }
}

// 06-14-2. Back4Appì—ì„œ ë¬¸ì œ ë°ì´í„° ë¡œë”© í•¨ìˆ˜ (ì •ë¦¬ëœ ë²„ì „)
async function loadQuestionsFromBack4App(subject, chapter, originalSubject) {
    console.log(`ğŸ” Back4App ì¿¼ë¦¬: ê³¼ëª©=${subject}, ì±•í„°=${chapter}, ì›ë³¸=${originalSubject}`);
    const QuestionBank = Parse.Object.extend("QuestionBank");
    const query = new Parse.Query(QuestionBank);

    try {
        const subjectMapping = {
            'ì¬ë¬´íšŒê³„': 'íšŒê³„í•™ê°œë¡ ', 'ì›ê°€ê´€ë¦¬íšŒê³„': 'íšŒê³„í•™ê°œë¡ ', 'ë²•ì¸ì„¸ë²•': 'ì„¸ë²•í•™ê°œë¡ ',
            'ì†Œë“ì„¸ë²•': 'ì„¸ë²•í•™ê°œë¡ ', 'ë¶€ê°€ê°€ì¹˜ì„¸ë²•': 'ì„¸ë²•í•™ê°œë¡ ', 'êµ­ì„¸ê¸°ë³¸ë²•': 'ì„¸ë²•í•™ê°œë¡ ',
            'êµ­ì„¸ì§•ìˆ˜ë²•': 'ì„¸ë²•í•™ê°œë¡ ', 'ì¡°ì„¸ë²”ì²˜ë²Œë²•': 'ì„¸ë²•í•™ê°œë¡ '
        };
        const mappedSubject = subjectMapping[originalSubject] || subject;
        query.equalTo("subject", mappedSubject);
        query.equalTo("isActive", true);

        const subTopics = ['ì¬ë¬´íšŒê³„', 'ì›ê°€ê´€ë¦¬íšŒê³„', 'ë²•ì¸ì„¸ë²•', 'ì†Œë“ì„¸ë²•', 'ë¶€ê°€ê°€ì¹˜ì„¸ë²•', 'êµ­ì„¸ê¸°ë³¸ë²•', 'êµ­ì„¸ì§•ìˆ˜ë²•', 'ì¡°ì„¸ë²”ì²˜ë²Œë²•'];
        if (subTopics.includes(originalSubject)) {
            query.equalTo("topic", originalSubject);
        }

        if (chapter && chapter.includes('ë…„ê¸°ì¶œ')) {
            const year = parseInt(chapter.replace('ë…„ê¸°ì¶œ', ''));
            if (!isNaN(year)) query.equalTo("year", year);
        } else if (chapter && chapter !== 'AIì¶”ì²œ' && !chapter.includes('ê¸°ì¶œë¬¸ì œ')) {
            query.startsWith("chapter", chapter);
        }

        query.ascending("questionNumber");
        query.limit(100);

        const results = await query.find();
        console.log(`ğŸ“Š ${results.length}ê°œì˜ ë¬¸ì œë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜´`);

        if (results.length === 0) return [];
        return results.map(result => ({
            questionId: result.id,
            subject: result.get("subject"),
            topic: result.get("topic"),
            chapter: result.get("chapter"),
            year: result.get("year"),
            questionNumber: result.get("questionNumber"),
            examType: result.get("examType"),
            questionText: result.get("questionText"),
            options: [result.get('option1'), result.get('option2'), result.get('option3'), result.get('option4'), result.get('option5')].filter(Boolean),
            correctAnswer: result.get("correctAnswer"),
            explanations: {
                'option1': result.get('explanation1'), 'option2': result.get('explanation2'),
                'option3': result.get('explanation3'), 'option4': result.get('explanation4'),
                'option5': result.get('explanation5')
            },
            analystComment: result.get('analystComment')
        }));
    } catch (error) {
        console.error("âŒ Back4App ì¿¼ë¦¬ ì‹¤íŒ¨:", error);
        return [];
    }
}
/* ===== 06-14. Back4App ì—°ë™ ë° í€´ì¦ˆ ë°ì´í„° ê´€ë¦¬ ë ===== */


/* ===== 06-15. í€´ì¦ˆ ì‹¤í–‰ ë° ìƒí˜¸ì‘ìš© (í†µí•©ëœ ë‹¨ì¼ ë²„ì „) ì‹œì‘ ===== */

// 06-15-1. í•œ ë¬¸ì œì˜ ë‚´ìš©ì„ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
function loadQuestion(questionData) {
    if (!questionData) return;
    
    currentQuestionData = questionData; 

    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');

    // ë¬¸ì œ ë‚´ìš© í‘œì‹œ
    questionTextEl.innerHTML = `
        <div class="question-header">
            <span class="question-meta">${questionData.subject} | ${questionData.year}ë…„ | ${questionData.examType} | ë¬¸ì œ ${questionData.questionNumber}ë²ˆ</span>
        </div>
        <div class="question-content">${questionData.questionText}</div>`;
    
    // ì„ íƒì§€ í‘œì‹œ
    optionsContainer.innerHTML = '';
    let options = questionData.options || [questionData.option1, questionData.option2, questionData.option3, questionData.option4, questionData.option5].filter(Boolean);

    options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option-item';
        
        // [ì˜¤ë¥˜ ìˆ˜ì •] 'question' -> 'questionData'ë¡œ ë³€ìˆ˜ëª…ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ì—¬ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë³µêµ¬í•©ë‹ˆë‹¤.
        optionDiv.onclick = () => selectOption(questionData.questionId, index + 1);
        
        // [ì˜¤ë¥˜ ìˆ˜ì •] 'question' -> 'questionData'ë¡œ ë³€ìˆ˜ëª…ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ì—¬ ì´ì „ì— ì„ íƒí•œ ë‹µì„ ì •í™•íˆ í‘œì‹œí•©ë‹ˆë‹¤.
        if (selectedAnswers[questionData.questionId] === (index + 1)) {
            optionDiv.classList.add('selected');
        }

        optionDiv.innerHTML = `<span class="option-number">${index + 1}</span><span class="option-text">${option}</span>`;
        optionsContainer.appendChild(optionDiv);
    });

    // ë¬¸ì œ ì´ë™ ë° í’€ì´ ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ
    const navDiv = document.createElement('div');
    navDiv.className = 'question-navigation';
    navDiv.innerHTML = `
        <button class="nav-btn" onclick="previousQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''}>â† ì´ì „</button>
        <button class="nav-btn" onclick="nextQuestion()" ${currentQuestionIndex === currentQuestionSet.length - 1 ? 'disabled' : ''}>ë‹¤ìŒ â†’</button>
        <button class="nav-btn finish-btn" onclick="finishQuiz()">í’€ì´ì™„ë£Œ</button>`;
    optionsContainer.appendChild(navDiv);

    // ë¬¸ì œì— ë§ëŠ” í•„ê¸° ìƒíƒœë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    loadWorkspaceState(currentQuestionIndex);
    loadAnnotationState(currentQuestionIndex);

    if (currentQuestionIndex === 0 && !quizCompleted) {
        autoStartTimer();
    }
}

// 06-15-2. ì„ íƒì§€ ì„ íƒ ì²˜ë¦¬ í•¨ìˆ˜
function selectOption(questionId, optionNumber) {
    if (quizCompleted) return;
    document.querySelectorAll('.option-item').forEach(item => item.classList.remove('selected'));
    document.querySelectorAll('.option-item')[optionNumber - 1].classList.add('selected');
    selectedAnswers[questionId] = optionNumber;
}

// 06-15-3. ì´ì „/ë‹¤ìŒ ë¬¸ì œ ì´ë™ í•¨ìˆ˜
function previousQuestion() {
    if (currentQuestionIndex > 0) {
        saveWorkspaceState(currentQuestionIndex);
        saveAnnotationState(currentQuestionIndex); // (ì¶”ê°€) ì£¼ì„ ìƒíƒœ ì €ì¥
        currentQuestionIndex--;
        loadQuestion(currentQuestionSet[currentQuestionIndex]);
        updateQuestionCounter();
    }
}

function nextQuestion() {
    if (currentQuestionIndex < currentQuestionSet.length - 1) {
        saveWorkspaceState(currentQuestionIndex);
        saveAnnotationState(currentQuestionIndex); // (ì¶”ê°€) ì£¼ì„ ìƒíƒœ ì €ì¥
        currentQuestionIndex++;
        loadQuestion(currentQuestionSet[currentQuestionIndex]);
        updateQuestionCounter();
    }
}

// 06-15-4. ë¬¸ì œ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
function updateQuestionCounter() {
    const counter = document.getElementById('question-counter');
    if (currentQuestionSet.length > 0) {
        counter.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${currentQuestionSet.length}`;
    }
}
/* ===== 06-15. í€´ì¦ˆ ì‹¤í–‰ ë° ìƒí˜¸ì‘ìš© ë ===== */


/* ===== 06-16. í€´ì¦ˆ ì±„ì  ë° ê²°ê³¼ ê¸°ëŠ¥ ì‹œì‘ ===== */

// 06-16-1. 'í’€ì´ì™„ë£Œ' ë²„íŠ¼ ê¸°ëŠ¥
function finishQuiz() {
    // (í•µì‹¬ ì¶”ê°€) ì±„ì  ì „, í˜„ì¬ ë¬¸ì œì˜ í•„ê¸° ë‚´ìš©ì„ ë¨¼ì € ì €ì¥í•©ë‹ˆë‹¤.
    saveWorkspaceState(currentQuestionIndex);
    saveAnnotationState(currentQuestionIndex);

    const unansweredCount = currentQuestionSet.length - Object.keys(selectedAnswers).length;
    if (unansweredCount > 0) {
        if (!confirm(`${unansweredCount}ê°œì˜ ë¬¸ì œë¥¼ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì •ë§ ì±„ì í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            return;
        }
    }
    pauseTimer();
    userAnswers = { ...selectedAnswers };
    quizCompleted = true;
    showResults();
}

// 06-16-2. ìµœì¢… ê²°ê³¼ í™”ë©´ í‘œì‹œ
function showResults() {
    currentView = 'results';
    pushToViewHistory({ view: 'results', data: null });
    
    const mainContent = document.querySelector('.main-content');
    
    let correctCount = 0;
    currentQuestionSet.forEach(q => {
        if (q.correctAnswer === userAnswers[q.questionId]) {
            correctCount++;
        }
    });
    const totalCount = currentQuestionSet.length;
    const percentage = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;

    mainContent.innerHTML = `
        <div class="results-mode">
            <div class="quiz-results">
                <h2>ğŸ¯ í’€ì´ ì™„ë£Œ!</h2>
                <div class="score-summary">
                    <div class="score-circle">
                        <span class="score-number">${correctCount}</span>
                        <span class="score-total">/ ${totalCount}</span>
                    </div>
                    <div class="score-percentage">${percentage}%</div>
                </div>
                <div class="score-details">
                    <span class="correct">ì •ë‹µ: ${correctCount}ê°œ</span>
                    <span class="incorrect">ì˜¤ë‹µ: ${totalCount - correctCount}ê°œ</span>
                </div>
            </div>
            <div class="retry-section">
                <button class="retry-btn" onclick="startQuiz()">ë‹¤ì‹œ í’€ê¸°</button>
                <button class="review-btn" onclick="reviewIncorrect()">í‹€ë¦° ë¬¸ì œë§Œ</button>
                <button class="review-btn" onclick="showAllExplanations()">ì „ì²´ í•´ì„¤ ë³´ê¸°</button>
            </div>
            <div class="results-grid" id="results-grid-container"></div>
        </div>
    `;

    const gridContainer = document.getElementById('results-grid-container');
    currentQuestionSet.forEach((question, index) => {
        const isCorrect = question.correctAnswer === userAnswers[question.questionId];
        const gridItem = document.createElement('div');
        
        gridItem.className = `result-grid-item ${isCorrect ? 'correct' : 'incorrect'}`;
        gridItem.textContent = `${question.questionNumber}ë²ˆ`;
        gridItem.onclick = () => showQuestionDetail(index);
        gridContainer.appendChild(gridItem);
    });
}
/* ===== 06-16. í€´ì¦ˆ ì±„ì  ë° ê²°ê³¼ ê¸°ëŠ¥ ë ===== */


/* ===== 06-17. í•´ì„¤ ë³´ê¸° ê¸°ëŠ¥ ì‹œì‘ ===== */

// (ì‹ ê·œ) 06-17-0. ìº”ë²„ìŠ¤ ì´ë¯¸ì§€ì—ì„œ ë§ˆì§€ë§‰ í•„ê¸° ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ë„ìš°ë¯¸ í•¨ìˆ˜
function findLastY(imageData) {
    const data = imageData.data;
    const width = imageData.width;
    // RGBA 4ê°œ ì±„ë„ì„ ê³ ë ¤í•˜ì—¬ ë§ˆì§€ë§‰ í”½ì…€ë¶€í„° ê±°ê¾¸ë¡œ íƒìƒ‰
    for (let y = imageData.height - 1; y >= 0; y--) {
        for (let x = 0; x < width; x++) {
            // ì•ŒíŒŒ ì±„ë„(íˆ¬ëª…ë„) ê°’ì´ 0ì´ ì•„ë‹Œ ì²« í”½ì…€ì„ ì°¾ìŒ
            if (data[(y * width + x) * 4 + 3] > 0) {
                return y; // ë§ˆì§€ë§‰ìœ¼ë¡œ ê·¸ë ¤ì§„ í”½ì…€ì˜ Y ì¢Œí‘œ ë°˜í™˜
            }
        }
    }
    return 0; // ì•„ë¬´ê²ƒë„ ê·¸ë ¤ì§€ì§€ ì•Šì•˜ìœ¼ë©´ 0 ë°˜í™˜
}

// 06-17-1. ê°œë³„ ë¬¸ì œ ìƒì„¸ í•´ì„¤ í‘œì‹œ (ì—°ìŠµì¥ í•„ê¸° í‘œì‹œ ê¸°ëŠ¥ ì¶”ê°€)
function showQuestionDetail(questionIndex) {
    currentView = 'detail';
    pushToViewHistory({ view: 'detail', data: questionIndex });

    const mainContent = document.querySelector('.main-content');
    // âœ¨ ê°œë³„ í•´ì„¤ í™”ë©´ì—ì„œëŠ” ì—°ìŠµì¥ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ quiz-layoutì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    mainContent.innerHTML = `
        <div class="explanation-mode">
            <div class="explanation-content" id="all-explanations-container">
            </div>
            <section class="calculator-section">
                </section>
        </div>
    `;
    // ê³„ì‚°ê¸° HTMLì„ ë™ì ìœ¼ë¡œ ì±„ìš°ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜, getQuizLayoutHTMLì„ ìˆ˜ì •í•˜ì—¬ ì¼ë¶€ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ê¸° ìœ„í•´ ìƒëµí•˜ê³ , í•´ì„¤ í‘œì‹œì— ì§‘ì¤‘í•©ë‹ˆë‹¤.
    
    const question = currentQuestionSet[questionIndex];
    const userAnswer = userAnswers[question.questionId];
    const explanationContainer = document.getElementById('all-explanations-container');

    // ë¬¸ì œ ê¸°ë³¸ ì •ë³´ êµ¬ì„±
    let html = `
        <div class="explanation-header">
            <h2>ë¬¸ì œ ${question.questionNumber} í•´ì„¤</h2>
            <button class="nav-btn" onclick="goBack()">ê²°ê³¼ ëª©ë¡ìœ¼ë¡œ</button>
        </div>
        <div class="question-content" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px;">
            ${question.questionText}
        </div>
    `;
    explanationContainer.innerHTML = html;

    // (ì‹ ê·œ) ì—°ìŠµì¥ í•„ê¸° ë‚´ìš© í‘œì‹œ ë¡œì§
    const workspaceDataUrl = workspaceStates[questionIndex];
    if (workspaceDataUrl) {
        const img = new Image();
        img.onload = () => {
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = img.width;
            tempCanvas.height = img.height;
            tempCtx.drawImage(img, 0, 0);
            
            const imageData = tempCtx.getImageData(0, 0, img.width, img.height);
            const lastY = findLastY(imageData);

            if (lastY > 0) {
                const cropHeight = lastY + 20; // í•˜ë‹¨ì— 20px ì—¬ë°± ì¶”ê°€
                const cropCanvas = document.createElement('canvas');
                const cropCtx = cropCanvas.getContext('2d');
                cropCanvas.width = img.width;
                cropCanvas.height = cropHeight;
                
                // ë°°ê²½ì„ í°ìƒ‰ìœ¼ë¡œ ì±„ì›Œì„œ íˆ¬ëª…(ê²€ì€ìƒ‰)ìœ¼ë¡œ ë³´ì´ì§€ ì•Šê²Œ í•¨
                cropCtx.fillStyle = 'white';
                cropCtx.fillRect(0, 0, cropCanvas.width, cropCanvas.height);
                cropCtx.drawImage(tempCanvas, 0, 0, img.width, cropHeight, 0, 0, img.width, cropHeight);

                const snapshotDiv = document.createElement('div');
                snapshotDiv.innerHTML = `
                    <div class="workspace-snapshot-header" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e9ecef;">ğŸ“ ì—°ìŠµì¥ í•„ê¸°</div>
                    <img src="${cropCanvas.toDataURL()}" class="workspace-snapshot" style="background: white;">
                `;
                explanationContainer.appendChild(snapshotDiv);
            }
        };
        img.src = workspaceDataUrl;
    }

    // ê¸°ì¡´ í•´ì„¤ í‘œì‹œ ë¡œì§
    question.options.forEach((option, index) => {
        const optionNumber = index + 1;
        const explanation = question.explanations[`option${optionNumber}`] || 'í•´ì„¤ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
        const isCorrectOption = optionNumber === question.correctAnswer;
        const isUserChoice = optionNumber === userAnswer;
        
        const explanationDiv = document.createElement('div');
        explanationDiv.className = `explanation-item ${isCorrectOption ? 'correct' : 'incorrect'} ${isUserChoice ? 'user-choice' : ''}`;
        explanationDiv.innerHTML = `<div class="option-header"><span class="option-number">${optionNumber}</span><span class="option-text" style="flex: 1;">${option}</span><span class="option-status">${isCorrectOption ? 'âœ“' : 'âœ—'} ${isUserChoice ? '(ë‚´ ë‹µì•ˆ)' : ''}</span></div><div class="explanation-text"><strong>í•´ì„¤:</strong> ${explanation}</div>`;
        explanationContainer.appendChild(explanationDiv);
    });
}

// 06-17-2. ì „ì²´ í•´ì„¤ ëª¨ë“œ í‘œì‹œ
function showAllExplanations() {
    currentView = 'allExplanations';
    pushToViewHistory({ view: 'allExplanations', data: null });
    
    const mainContent = document.querySelector('.main-content');
    
    mainContent.innerHTML = `
        <div class="explanation-mode">
            <div class="explanation-content" id="all-explanations-container">
                <div class="explanation-header">
                    <h2>ğŸ“‹ ì „ì²´ ë¬¸ì œ í•´ì„¤</h2>
                    <div class="explanation-controls">
                        <button class="nav-btn" onclick="goBack()">ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const container = document.getElementById('all-explanations-container');
    if (!currentQuestionSet || currentQuestionSet.length === 0) {
        container.innerHTML += '<p>í‘œì‹œí•  ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }

    currentQuestionSet.forEach((question, index) => {
        const userAnswer = userAnswers[question.questionId];
        const isCorrect = userAnswer === question.correctAnswer;
        
        const questionDiv = document.createElement('div');
        if (index > 0) questionDiv.className = 'question-divider';
        
        questionDiv.innerHTML = `
            <div class="question-summary">
                <strong>ë¬¸ì œ ${question.questionNumber}ë²ˆ</strong>
                <span class="question-result ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}</span>
                <div style="margin-top: 8px; font-size: 14px; color: #6c757d;">
                    ì •ë‹µ: ${question.correctAnswer}ë²ˆ | ì„ íƒ: ${userAnswer ? userAnswer + 'ë²ˆ' : 'ë¯¸ì„ íƒ'}
                </div>
            </div>
            <div class="question-content" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                ${question.questionText}
            </div>
        `;
        
        if (question.options && question.explanations) {
            question.options.forEach((option, optionIndex) => {
                const optionNumber = optionIndex + 1;
                const explanation = question.explanations[`option${optionNumber}`] || 'í•´ì„¤ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = `explanation-item ${optionNumber === question.correctAnswer ? 'correct' : 'incorrect'}`;
                explanationDiv.innerHTML = `
                    <div class="option-header">
                        <span class="option-number">${optionNumber}</span>
                        <span style="flex: 1;">${option}</span>
                        <span class="option-status">${optionNumber === question.correctAnswer ? 'âœ…' : 'âŒ'}</span>
                    </div>
                    <div class="explanation-text">${explanation}</div>`;
                questionDiv.appendChild(explanationDiv);
            });
        }
        container.appendChild(questionDiv);
    });
}
/* ===== 06-17. í•´ì„¤ ë³´ê¸° ê¸°ëŠ¥ ë ===== */


/* ===== 06-18. ë‹¤ì‹œ í’€ê¸° ê¸°ëŠ¥ ì‹œì‘ ===== */

// 06-18-1. í˜„ì¬ í€´ì¦ˆ ë‹¤ì‹œ í’€ê¸°
function startQuiz() {
    if (!confirm("í˜„ì¬ í€´ì¦ˆë¥¼ ì²˜ìŒë¶€í„° ë‹¤ì‹œ í‘¸ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    
    const firstQuestionInfo = viewHistory.find(h => h.view === 'quiz');
    if (firstQuestionInfo) {
        selectChapter(firstQuestionInfo.data.subject, firstQuestionInfo.data.chapter);
    }
}

// 06-18-2. í‹€ë¦° ë¬¸ì œë§Œ ë‹¤ì‹œ í’€ê¸°
function reviewIncorrect() {
    const incorrectQuestions = currentQuestionSet.filter(q => q.correctAnswer !== userAnswers[q.questionId]);
    if (incorrectQuestions.length === 0) {
        alert('ğŸ‰ í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!');
        return;
    }
    
    const mainContent = document.querySelector('.main-content');
    mainContent.innerHTML = `
        <div class="quiz-layout" id="quiz-layout">
            <section class="quiz-section">
                <div class="quiz-header"><span id="question-counter"></span><span id="quiz-status"></span></div>
                <div class="question-container" id="question-container"><h3 id="question-text"></h3><div class="options-container" id="options-container"></div></div>
            </section>
            <section class="calculator-section">
                <div class="calculator-container"><div class="calc-brand">CASIO JS-40B</div><div class="calculator-display" id="calc-display"><div class="memory-indicator" id="memory-indicator"></div><div class="display-value" id="display-value">0</div></div><div class="calculator-buttons"><button class="calc-btn memory" onclick="memoryExchange()">M/EX</button><button class="calc-btn function" onclick="percentage()">%</button><button class="calc-btn function" onclick="squareRoot()">âˆš</button><button class="calc-btn function" onclick="backspace()">âŒ«</button><button class="calc-btn memory" onclick="grandTotal()">GT</button><button class="calc-btn memory" onclick="memoryClear()">MC</button><button class="calc-btn memory" onclick="memoryRecall()">MR</button><button class="calc-btn memory" onclick="memorySubtract()">M-</button><button class="calc-btn memory" onclick="memoryAdd()">M+</button><button class="calc-btn operator" onclick="appendToDisplay('/')">Ã·</button><button class="calc-btn function" onclick="changeSign()">+/-</button><button class="calc-btn number" onclick="appendToDisplay('7')">7</button><button class="calc-btn number" onclick="appendToDisplay('8')">8</button><button class="calc-btn number" onclick="appendToDisplay('9')">9</button><button class="calc-btn operator" onclick="appendToDisplay('*')">Ã—</button><button class="calc-btn function" onclick="clearEntry()">C</button><button class="calc-btn number" onclick="appendToDisplay('4')">4</button><button class="calc-btn number" onclick="appendToDisplay('5')">5</button><button class="calc-btn number" onclick="appendToDisplay('6')">6</button><button class="calc-btn operator" onclick="appendToDisplay('-')">-</button><button class="calc-btn function" onclick="clearAll()">AC</button><button class="calc-btn number" onclick="appendToDisplay('1')">1</button><button class="calc-btn number" onclick="appendToDisplay('2')">2</button><button class="calc-btn number" onclick="appendToDisplay('3')">3</button><button class="calc-btn plus-tall" onclick="appendToDisplay('+')">+</button><button class="calc-btn number" onclick="appendToDisplay('0')">0</button><button class="calc-btn number" onclick="appendToDisplay('00')">00</button><button class="calc-btn number" onclick="appendToDisplay('.')">.</button><button class="calc-btn equals" onclick="calculate()">=</button></div><div class="calculation-history"><div class="history-title">ê³„ì‚°ê¸°ë¡<button class="clear-history-btn" onclick="clearCalculationHistory()">ì§€ìš°ê¸°</button></div><div class="history-values" id="historyValues"></div></div></div>
            </section>
        </div>
    `;

    resetQuizState();
    currentQuestionSet = incorrectQuestions;
    
    pushToViewHistory({
        view: 'quiz',
        data: { subject: 'í‹€ë¦° ë¬¸ì œ', chapter: 'ë‹¤ì‹œ í’€ê¸°' }
    });

    loadQuestion(currentQuestionSet[0]);
    updateQuestionCounter();
}
/* ===== 06-18. ë‹¤ì‹œ í’€ê¸° ê¸°ëŠ¥ ë ===== */


/* ===== 06-19. ì´ˆê¸°í™” í•¨ìˆ˜ ì‹œì‘ ===== */
document.addEventListener('DOMContentLoaded', function() {
    Parse.initialize("sRKpx71t2JwbatmvWe2SZi67cShfsk72HhyR1vqb", "fG2HXOiMWSlHuSmeOINADUyNU8rPxX5lku389GJV");
    Parse.serverURL = "https://parseapi.back4app.com/";
    
    testBack4AppConnection();
    goHome(); // goHome í•¨ìˆ˜ê°€ UI ìƒì„±ê³¼ ê¸°ëŠ¥ ì´ˆê¸°í™”ë¥¼ ëª¨ë‘ ë‹´ë‹¹í•©ë‹ˆë‹¤.
});

async function testBack4AppConnection() {
    try {
        await Parse.Cloud.run('health');
        console.log("âœ… Back4App ì—°ê²° ì„±ê³µ!");
        // goHome í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë¯€ë¡œ ì•„ë˜ ë¼ì¸ì€ ì—†ì–´ë„ ë©ë‹ˆë‹¤.
    } catch (error) {
        console.error("âŒ Back4App ì—°ê²° ì‹¤íŒ¨:", error);
        document.getElementById('question-text').textContent = "Back4App ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
    }
}

document.addEventListener('dblclick', function(e) {
    e.preventDefault();
}, { passive: false });
/* ===== 06-19. ì´ˆê¸°í™” í•¨ìˆ˜ ë ===== */

/* ===== 06-20. ìŠ¤ë§ˆíŠ¸ ìº”ë²„ìŠ¤ ë° UI ê¸°ëŠ¥ (ìµœì¢… ì™„ì„±ë³¸) ì‹œì‘ ===== */

// 06-20-1. ìº”ë²„ìŠ¤ ë° ë¦¬ì‚¬ì´ì € ì´ˆê¸°í™” ë©”ì¸ í•¨ìˆ˜
function setupQuizInterface() {
    initializeCanvases();
    initializeVerticalResizer();
}

// 06-20-2. (ì „ë©´ êµì²´) ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (ë¦¬ì‚¬ì´ì¦ˆ í•„ê¸° ì‚­ì œ ìµœì¢… í•´ê²°)
function initializeCanvases() {
    const quizSection = document.getElementById('quiz-section');
    const workspaceSection = document.getElementById('workspace-section');
    annotationCanvas = document.getElementById('annotation-canvas');
    workspaceCanvas = document.getElementById('workspace-canvas');

    if (!quizSection || !workspaceSection || !annotationCanvas || !workspaceCanvas) return;

    if (window.canvasResizeObserver) window.canvasResizeObserver.disconnect();
    
    window.canvasResizeObserver = new ResizeObserver(entries => {
        for (const entry of entries) {
            const container = entry.target;
            const canvas = container.querySelector('canvas');
            if (!canvas) continue;

            const ctx = canvas.getContext('2d');
            
            let oldDrawing = null;
            if (canvas.width > 0 && canvas.height > 0) {
                oldDrawing = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }

            let newWidth, newHeight;

            if (container.id === 'quiz-section') {
                // (ìµœì¢… í•µì‹¬ ìˆ˜ì •) contentRect(ì—¬ë°±ì œì™¸) ëŒ€ì‹ , ì—¬ë°±ì„ í¬í•¨í•˜ëŠ” clientWidth/clientHeightë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                // ì´ê²ƒì´ 'ì§€ìš°ê°œ í˜„ìƒ'ê³¼ 'í•„ê¸° ì•ˆ ë˜ëŠ” ì˜ì—­' ë¬¸ì œì˜ ì§„ì§œ ì›ì¸ì´ì—ˆìŠµë‹ˆë‹¤.
                newWidth = container.clientWidth;
                newHeight = container.clientHeight;
            } else { // workspace-section
                // ì—°ìŠµì¥ì€ ë³´ì´ëŠ” ë„ˆë¹„(clientWidth)ì™€ ê³ ì •ëœ ë†’ì´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                newWidth = canvas.clientWidth;
                newHeight = 1000;
            }

            if (newWidth <= 0) continue;
            if (canvas.id === 'annotation-canvas' && newHeight <= 0) continue;
            
            // ìº”ë²„ìŠ¤ì˜ ì‹¤ì œ í•´ìƒë„(width/height ì†ì„±)ê°€ ë³´ì´ëŠ” í¬ê¸°ì™€ ë‹¤ë¥¼ ë•Œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            if (canvas.width !== newWidth || canvas.height !== newHeight) {
                canvas.width = newWidth;
                canvas.height = newHeight;

                // ì €ì¥í•´ë‘” ê·¸ë¦¼ì´ ìˆìœ¼ë©´, ìƒˆ ìº”ë²„ìŠ¤ì— ì¦‰ì‹œ ë‹¤ì‹œ ê·¸ë ¤ì¤ë‹ˆë‹¤.
                if (oldDrawing) {
                    ctx.putImageData(oldDrawing, 0, 0);
                }
            }
        }
    });

    // ë‘ ì»¨í…Œì´ë„ˆ ëª¨ë‘ í¬ê¸° ë³€ê²½ ê°ì‹œ
    window.canvasResizeObserver.observe(quizSection);
    window.canvasResizeObserver.observe(workspaceSection);

    // --- ì´í•˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •ì€ ê¸°ì¡´ê³¼ ë™ì¼ ---
    [annotationCanvas, workspaceCanvas].forEach(canvas => {
        if (canvas) {
            canvas.removeEventListener('pointerdown', handlePointerDown);
            canvas.addEventListener('pointerdown', handlePointerDown);
        }
    });

    annotationCtx = annotationCanvas.getContext('2d');
    workspaceCtx = workspaceCanvas.getContext('2d');
    
    document.removeEventListener('pointermove', handlePointerMove);
    document.addEventListener('pointermove', handlePointerMove);
    document.removeEventListener('pointerup', handlePointerUp);
    document.addEventListener('pointerup', handlePointerUp);
}

// 06-20-3. í¬ì¸í„° 'ëˆ„ë¦„' ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ë‹¨ìˆœí™”)
function handlePointerDown(e) {
    // CSSì—ì„œ ìŠ¤í¬ë¡¤ë°” ì˜ì—­ì„ ì œì™¸í–ˆìœ¼ë¯€ë¡œ, ì´ ì´ë²¤íŠ¸ëŠ” ìº”ë²„ìŠ¤ ìœ„ì—ì„œë§Œ ë°œìƒí•©ë‹ˆë‹¤.
    if (e.target.tagName !== 'CANVAS') return;

    // ì˜¤ë¥¸ìª½ í´ë¦­ ë¬´ì‹œ
    if (e.button === 2) return;
    
    isPointerDown = true;
    isDragging = false;
    pointerDownTime = Date.now();
    startCoords = { x: e.clientX, y: e.clientY };
    lastCanvasCoords = { x: e.offsetX, y: e.offsetY };
    
    // í…ìŠ¤íŠ¸ ì„ íƒ ê°™ì€ ê¸°ë³¸ ë™ì‘ì„ ë§‰ì•„ í•„ê¸°/íƒ­ ê¸°ëŠ¥ì´ ì›í™œí•˜ê²Œ ì‘ë™í•˜ë„ë¡ í•©ë‹ˆë‹¤.
    e.preventDefault();
}

// 06-20-4. í¬ì¸í„° 'ì´ë™' ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ì§€ìš°ê°œ ë° ìƒ‰ìƒ ë³€ê²½ ë¡œì§ í¬í•¨)
function handlePointerMove(e) {
    if (!isPointerDown) return;
    if (!isDragging) {
        const distance = Math.sqrt(Math.pow(e.clientX - startCoords.x, 2) + Math.pow(e.clientY - startCoords.y, 2));
        if (distance > DRAG_THRESHOLD_PX) isDragging = true;
    }

    if (isDragging) {
        // e.targetì´ ìº”ë²„ìŠ¤ê°€ ì•„ë‹Œ ê²½ìš°(ìº”ë²„ìŠ¤ ë°–ìœ¼ë¡œ ë“œë˜ê·¸)ë¥¼ ëŒ€ë¹„í•´ í™œì„± ìº”ë²„ìŠ¤ë¥¼ ì¶”ì í•´ì•¼ í•˜ì§€ë§Œ,
        // í˜„ì¬ëŠ” e.targetì´ ìº”ë²„ìŠ¤ì¸ ê²½ìš°ì—ë§Œ ê·¸ë¦¬ë„ë¡ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.
        const currentCanvas = e.target;
        if (currentCanvas && currentCanvas.tagName === 'CANVAS') {
            const ctx = currentCanvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(lastCanvasCoords.x, lastCanvasCoords.y);
            ctx.lineTo(e.offsetX, e.offsetY);

            // ì§€ìš°ê°œ ëª¨ë“œì™€ ê·¸ë¦¬ê¸° ëª¨ë“œ ë¶„ê¸°
            if (isEraserMode) {
                ctx.globalCompositeOperation = 'destination-out'; // ì§€ìš°ê°œ ëª¨ë“œ
                ctx.lineWidth = 20; // ì§€ìš°ê°œ í¬ê¸°
            } else {
                ctx.globalCompositeOperation = 'source-over'; // ê·¸ë¦¬ê¸° ëª¨ë“œ
                ctx.strokeStyle = '#000000'; // í•„ê¸° ìƒ‰ìƒ ê²€ì€ìƒ‰
                ctx.lineWidth = 2.5; // íœ êµµê¸°
            }
            ctx.lineCap = 'round';
            ctx.stroke();
            lastCanvasCoords = { x: e.offsetX, y: e.offsetY };
        }
    }
}

// 06-20-5. í¬ì¸í„° 'ë—Œ' ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
function handlePointerUp(e) {
    if (!isPointerDown) return;
    isPointerDown = false;
    const duration = Date.now() - pointerDownTime;
    if (!isDragging && duration < TAP_THRESHOLD_MS) handleTap(e);
    isDragging = false;
}

// 06-20-6. 'íƒ­' ë™ì‘ ì²˜ë¦¬ í•¨ìˆ˜
function handleTap(e) {
    const tappedCanvas = e.target;
    if (!tappedCanvas || tappedCanvas.tagName !== 'CANVAS') return;
    tappedCanvas.style.pointerEvents = 'none';
    const elementBeneath = document.elementFromPoint(e.clientX, e.clientY);
    tappedCanvas.style.pointerEvents = 'auto';
    if (elementBeneath && typeof elementBeneath.click === 'function') {
        elementBeneath.click();
    }
}

// 06-20-7. ì§€ìš°ê°œ ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
function toggleEraserMode() {
    isEraserMode = !isEraserMode;
    const btn = document.getElementById('eraser-btn');
    if (btn) {
        if (isEraserMode) {
            btn.style.background = '#007bff';
            btn.style.color = 'white';
        } else {
            btn.style.background = '';
            btn.style.color = '';
        }
    }
}

// 06-20-8. ëª¨ë“  ìº”ë²„ìŠ¤ í•„ê¸° ì§€ìš°ê¸°
function clearAllCanvases() {
    if (confirm('ë¬¸ì œì™€ ì—°ìŠµì¥ì˜ ëª¨ë“  í•„ê¸°ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        if (workspaceCtx) workspaceCtx.clearRect(0, 0, workspaceCanvas.width, workspaceCanvas.height);
        if (annotationCtx) annotationCtx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);
    }
}

// 06-20-9. ë¬¸ì œë³„ ìƒíƒœ ì €ì¥/ë³µì› í•¨ìˆ˜ (ìƒëµ ì—†ì´ ëª¨ë‘ í¬í•¨)
function saveWorkspaceState(index) {
    if (workspaceCanvas) workspaceStates[index] = workspaceCanvas.toDataURL();
}
function saveAnnotationState(index) {
    if (annotationCanvas) annotationStates[index] = annotationCanvas.toDataURL();
}
function loadWorkspaceState(index) {
    if (workspaceCtx) workspaceCtx.clearRect(0, 0, workspaceCanvas.width, workspaceCanvas.height);
    if (workspaceCanvas && workspaceStates[index]) {
        const img = new Image();
        img.onload = () => { if (workspaceCtx) workspaceCtx.drawImage(img, 0, 0); };
        img.src = workspaceStates[index];
    }
}
function loadAnnotationState(index) {
    if (annotationCtx) annotationCtx.clearRect(0, 0, annotationCanvas.width, annotationCanvas.height);
    if (annotationCanvas && annotationStates[index]) {
        const img = new Image();
        img.onload = () => { if (annotationCtx) annotationCtx.drawImage(img, 0, 0); };
        img.src = annotationStates[index];
    }
}


// 06-20-10. ìˆ˜ì§ ë¦¬ì‚¬ì´ì € ì´ˆê¸°í™” (ì–‘ìª½ ì˜ì—­ ë†’ì´ ë™ì‹œ ì¡°ì ˆ ìµœì¢…ë³¸)
function initializeVerticalResizer() {
    const resizer = document.getElementById('vertical-resizer');
    const mainColumn = document.querySelector('.main-column');
    const quizSection = document.getElementById('quiz-section');
    const workspaceSection = document.getElementById('workspace-section');

    if (!resizer || !mainColumn || !quizSection || !workspaceSection) return;

    let isResizing = false;

    const startResizing = (e) => {
        isResizing = true;
        document.body.style.cursor = 'row-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
    };

    const doResize = (e) => {
        if (!isResizing) return;
        
        const mainRect = mainColumn.getBoundingClientRect();
        if (mainRect.height === 0) return;

        const resizerHeight = resizer.offsetHeight;
        const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
        if (clientY === 0) return;

        let newQuizHeight = clientY - mainRect.top;
        let newWorkspaceHeight = mainRect.height - newQuizHeight - resizerHeight;

        const minHeight = 80;
        if (newQuizHeight < minHeight) {
            newQuizHeight = minHeight;
            newWorkspaceHeight = mainRect.height - newQuizHeight - resizerHeight;
        }
        if (newWorkspaceHeight < minHeight) {
            newWorkspaceHeight = minHeight;
            newQuizHeight = mainRect.height - newWorkspaceHeight - resizerHeight;
        }

        quizSection.style.flex = 'none';
        workspaceSection.style.flex = 'none';

        quizSection.style.height = `${newQuizHeight}px`;
        workspaceSection.style.height = `${newWorkspaceHeight}px`;
    };

    const stopResizing = () => {
        if (isResizing) {
            isResizing = false;
            document.body.style.cursor = 'default';
            document.body.style.userSelect = 'auto';
        }
    };

    resizer.addEventListener('mousedown', startResizing);
    document.addEventListener('mousemove', doResize);
    document.addEventListener('mouseup', stopResizing);
    resizer.addEventListener('touchstart', startResizing, { passive: false });
    document.addEventListener('touchmove', doResize);
    document.addEventListener('touchend', stopResizing);
}

/* ===== 06-20. ìŠ¤ë§ˆíŠ¸ ìº”ë²„ìŠ¤ ë° UI ê¸°ëŠ¥ (ìµœì¢… ì™„ì„±ë³¸) ë ===== */

/* ===== 06-21. UI í…œí”Œë¦¿ í•¨ìˆ˜ ì‹œì‘ ===== */

// 06-21-1. ë©”ì¸ ì½˜í…ì¸  ì „ì²´ ë ˆì´ì•„ì›ƒ HTML ìƒì„± í•¨ìˆ˜ (ìˆ˜ì •)
function getMainContentHTML() {
    // í€´ì¦ˆ, ì´ë¡ , í•™ìŠµê´€ë¦¬ ë ˆì´ì•„ì›ƒì„ ëª¨ë‘ í¬í•¨í•˜ëŠ” ì „ì²´ HTML êµ¬ì¡°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    return `
        <div class="quiz-layout" id="quiz-layout">
            <div class="main-column">
                <section class="quiz-section" id="quiz-section">
                    <canvas class="annotation-canvas" id="annotation-canvas"></canvas>
                    <div class="quiz-header">
                        <span id="question-counter">ë¬¸ì œ ì¤€ë¹„ì¤‘</span><span id="quiz-status">ëŒ€ê¸°</span>
                    </div>
                    <div class="question-container" id="question-container">
                        <h3 id="question-text">ëª©ì°¨ì—ì„œ ì›í•˜ëŠ” ê³¼ëª©ê³¼ ë‹¨ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h3>
                        <div class="options-container" id="options-container"></div>
                    </div>
                </section>
                <div class="resizer-vertical" id="vertical-resizer"></div>
                <section class="workspace-section-new" id="workspace-section">
                    <div class="workspace-header">
                        <h3>âœï¸ ì—°ìŠµì¥</h3>
                        <div>
                            <button class="draw-btn" id="eraser-btn" onclick="toggleEraserMode()">ì§€ìš°ê°œ</button>
                            <button class="draw-btn" onclick="clearAllCanvases()">ì „ì²´ ì§€ìš°ê¸°</button>
                        </div>
                    </div>
                    <canvas class="workspace-canvas" id="workspace-canvas"></canvas>
                </section>
            </div>
            <section class="calculator-section">
                <div class="calculator-container">
                    <div class="calc-brand">CASIO JS-40B</div>
                    <div class="calculator-display" id="calc-display">
                        <div class="memory-indicator" id="memory-indicator"></div>
                        <div class="display-value" id="display-value">0</div>
                    </div>
                    <div class="calculator-buttons">
                        <button class="calc-btn memory" onclick="memoryExchange()">M/EX</button><button class="calc-btn function" onclick="percentage()">%</button><button class="calc-btn function" onclick="squareRoot()">âˆš</button><button class="calc-btn function" onclick="backspace()">âŒ«</button><button class="calc-btn memory" onclick="grandTotal()">GT</button><button class="calc-btn memory" onclick="memoryClear()">MC</button><button class="calc-btn memory" onclick="memoryRecall()">MR</button><button class="calc-btn memory" onclick="memorySubtract()">M-</button><button class="calc-btn memory" onclick="memoryAdd()">M+</button><button class="calc-btn operator" onclick="appendToDisplay('/')">Ã·</button><button class="calc-btn function" onclick="changeSign()">+/-</button><button class="calc-btn number" onclick="appendToDisplay('7')">7</button><button class="calc-btn number" onclick="appendToDisplay('8')">8</button><button class="calc-btn number" onclick="appendToDisplay('9')">9</button><button class="calc-btn operator" onclick="appendToDisplay('*')">Ã—</button><button class="calc-btn function" onclick="clearEntry()">C</button><button class="calc-btn number" onclick="appendToDisplay('4')">4</button><button class="calc-btn number" onclick="appendToDisplay('5')">5</button><button class="calc-btn number" onclick="appendToDisplay('6')">6</button><button class="calc-btn operator" onclick="appendToDisplay('-')">-</button><button class="calc-btn function" onclick="clearAll()">AC</button><button class="calc-btn number" onclick="appendToDisplay('1')">1</button><button class="calc-btn number" onclick="appendToDisplay('2')">2</button><button class="calc-btn number" onclick="appendToDisplay('3')">3</button><button class="calc-btn plus-tall" onclick="appendToDisplay('+')">+</button><button class="calc-btn number" onclick="appendToDisplay('0')">0</button><button class="calc-btn number" onclick="appendToDisplay('00')">00</button><button class="calc-btn number" onclick="appendToDisplay('.')">.</button><button class="calc-btn equals" onclick="calculate()">=</button>
                    </div>
                    <div class="calculation-history"><div class="history-title">ê³„ì‚°ê¸°ë¡<button class="clear-history-btn" onclick="clearCalculationHistory()">ì§€ìš°ê¸°</button></div><div class="history-values" id="historyValues"></div></div>
                </div>
            </section>
        </div>

        <div class="theory-layout" id="theory-layout">
            <main class="theory-main-content" id="theoryMainContent">
                <div id="theoryLoadingSpinner">ğŸ“š ì´ë¡  ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•˜ëŠ” ì¤‘...</div>
                <div class="theory-book" id="theoryBook" style="display:none;"></div>
            </main>
        </div>

        <div id="progress-layout" style="display: none; justify-content: center; align-items: center; font-size: 1.2em; color: #6c757d; height: 100%;">
            ğŸ“Š í•™ìŠµê´€ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
        </div>
    `;
}

/* ===== 06-21. UI í…œí”Œë¦¿ í•¨ìˆ˜ ë ===== */

// (ì‹ ê·œ) 06-22. ì´ë¡  ì½˜í…ì¸ ë¥¼ ì±… í˜•íƒœë¡œ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
function renderTheoryBook(contents) {
    const theoryBook = document.getElementById('theoryBook');
    theoryBook.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    // pageGroup ë²ˆí˜¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì½˜í…ì¸  ê·¸ë£¹í™”
    const pagesByGroup = contents.reduce((acc, item) => {
        acc[item.pageGroup] = acc[item.pageGroup] || [];
        acc[item.pageGroup].push(item.content);
        return acc;
    }, {});

    // pageGroup ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ëœ í‚¤ ë°°ì—´ ìƒì„±
    const sortedGroups = Object.keys(pagesByGroup).sort((a, b) => parseInt(a) - parseInt(b));
    const totalPageSpreads = sortedGroups.length;

    // ê° í˜ì´ì§€ ê·¸ë£¹(í¼ì¹œ í˜ì´ì§€)ì„ HTMLë¡œ êµ¬ì„±
    sortedGroups.forEach((groupKey, index) => {
        const pageContents = pagesByGroup[groupKey];
        
        const pageSpread = document.createElement('div');
        pageSpread.className = 'theory-page-spread';

        const leftPageNumber = index * 2 + 1;
        const rightPageNumber = index * 2 + 2;

        pageSpread.innerHTML = `
            <div class="theory-page theory-left-page">
                <div class="theory-content-wrapper">${pageContents[0] || ''}</div>
                <div class="theory-page-number">${leftPageNumber}</div>
            </div>
            <div class="theory-page theory-right-page">
                <div class="theory-content-wrapper">${pageContents[1] || ''}</div>
                <div class="theory-page-number">${rightPageNumber}</div>
            </div>
        `;
        theoryBook.appendChild(pageSpread);
    });

    // ëª¨ë“  í˜ì´ì§€ê°€ ì¶”ê°€ëœ í›„, ì±…ì˜ ì „ì²´ ë„ˆë¹„ë¥¼ ì„¤ì •
    if (totalPageSpreads > 0) {
        theoryBook.style.width = `${totalPageSpreads * 100}%`;
    }
}

/* ë”ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥
// (ì‹ ê·œ) 06-23. ì´ë¡  ì±… ë„˜ê¹€(ìŠ¤ì™€ì´í”„) ê¸°ëŠ¥ ì„¤ì • í•¨ìˆ˜
function setupTheoryBookNavigation() {
    const book = document.getElementById('theoryBook');
    const mainContent = document.getElementById('theoryMainContent');
    if (!book || !mainContent) return;

    let currentPage = 0;
    let startX = 0;
    let isDragging = false;
    let currentTranslateX = 0;

    const pageSpreads = book.querySelectorAll('.theory-page-spread');
    if (pageSpreads.length === 0) return;
    
    const totalPages = pageSpreads.length;
    
    const navigate = (page) => {
        if (page < 0) page = 0;
        if (page >= totalPages) page = totalPages - 1;
        
        currentPage = page;
        const viewWidth = mainContent.clientWidth;
        
           // (í•µì‹¬ ìˆ˜ì •) ì´ë™ ê±°ë¦¬ë¥¼ ê³„ì‚°í•  ë•Œ, í˜ì´ì§€ ë„ˆë¹„(viewWidth)ì—
    // CSSì— ì„¤ì •ëœ ì˜¤ë¥¸ìª½ ì—¬ë°±(40px)ì„ ë”í•´ì¤ë‹ˆë‹¤.
    const totalMoveDistance = -currentPage * (viewWidth + 40);
    currentTranslateX = totalMoveDistance;
    
        book.style.transition = 'transform 0.4s ease-in-out';
        book.style.transform = `translateX(${currentTranslateX}px)`;
    };
    
    // ì´ˆê¸° í˜ì´ì§€ë¡œ ì´ë™
    navigate(0);

    const onPointerDown = (e) => {
        isDragging = true;
        startX = e.pageX || e.touches[0].pageX;
        book.style.transition = 'none';
        e.currentTarget.setPointerCapture(e.pointerId); // í¬ì¸í„° ì´ë²¤íŠ¸ ë…ì 
    };

    const onPointerMove = (e) => {
        if (!isDragging) return;
        const currentX = e.pageX || e.touches[0].pageX;
        const diffX = currentX - startX;
        book.style.transform = `translateX(${currentTranslateX + diffX}px)`;
    };

    const onPointerUp = (e) => {
        if (!isDragging) return;
        isDragging = false;
        
        e.currentTarget.releasePointerCapture(e.pointerId);

        const endX = e.pageX || e.changedTouches[0].pageX;
        const diffX = endX - startX;
        
        // ìŠ¤ì™€ì´í”„ ê°ì§€ ì„ê³„ê°’ (50px ì´ìƒ ì›€ì§ì—¬ì•¼ í˜ì´ì§€ ë„˜ê¹€)
        if (Math.abs(diffX) > 50) {
            if (diffX < 0) { // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ë‹¤ìŒ í˜ì´ì§€)
                navigate(currentPage + 1);
            } else { // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ (ì´ì „ í˜ì´ì§€)
                navigate(currentPage - 1);
            }
        } else { // ì„ê³„ê°’ ë¯¸ë§Œì´ë©´ ì›ë˜ í˜ì´ì§€ë¡œ ë³µê·€
            navigate(currentPage);
        }
    };
    
    // ë¦¬ìŠ¤ë„ˆ ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±°
    const controller = new AbortController();
    const options = { signal: controller.signal };

    if (book.dataset.eventsAttached) {
        // ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìˆë‹¤ë©´ ì´ë²¤íŠ¸ë¥¼ ì¤‘ë‹¨ì‹œí‚´ (ì‹¤ì œë¡œëŠ” ë³µì¡í•˜ë¯€ë¡œ ê°„ë‹¨íˆ í”Œë˜ê·¸ë¡œë§Œ ê´€ë¦¬)
    }

    book.addEventListener('pointerdown', onPointerDown, options);
    book.addEventListener('pointermove', onPointerMove, options);
    book.addEventListener('pointerup', onPointerUp, options);
    book.addEventListener('pointercancel', onPointerUp, options);
    book.dataset.eventsAttached = 'true';

    // ì°½ í¬ê¸° ë³€ê²½ ì‹œ í˜„ì¬ í˜ì´ì§€ ìœ„ì¹˜ ì¬ì¡°ì •
    const resizeObserver = new ResizeObserver(() => {
        navigate(currentPage);
    });
    resizeObserver.observe(mainContent);
} */

    </script>
    <!-- 1. Back4App ì—°ë™ ë° ì½˜í…ì¸  í‘œì‹œë¥¼ ìœ„í•œ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script src="https://unpkg.com/parse@4.0.1/dist/parse.min.js"></script>
<script>
    // 2. Back4App ì´ˆê¸°í™”
    // 'YOUR_APP_ID'ì™€ 'YOUR_JAVASCRIPT_KEY'ëŠ” Back4App ëŒ€ì‹œë³´ë“œì˜ 'App Keys'ì—ì„œ í™•ì¸í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´í•´ì£¼ì„¸ìš”.
    Parse.initialize("sRKpx71t2JwbatmvWe2SZi67cShfsk72HhyR1vqb", "fG2HXOiMWSlHuSmeOINADUyNU8rPxX5lku389GJV");
    Parse.serverURL = "https://parseapi.back4app.com/";

    /* 3. ì´ë¡  ì½˜í…ì¸  ì¡°íšŒ ë° ë Œë”ë§ í•¨ìˆ˜ */
    async function fetchAndDisplayTheory(subject, chapter) {
        const contentContainer = document.getElementById('content-container');
        const loadingMessage = document.getElementById('loading-message');

        // 3-1. ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ ë° ê¸°ì¡´ ì½˜í…ì¸  ì´ˆê¸°í™”
        loadingMessage.style.display = 'block'; // ë¡œë”© ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
        loadingMessage.textContent = `ğŸ“š '${chapter}' ì´ë¡  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
        contentContainer.innerHTML = '';

        const TheoryContent = Parse.Object.extend("TheoryContent");
        const query = new Parse.Query(TheoryContent);

        // 3-2. ì¡°íšŒ ì¡°ê±´ ì„¤ì •
        query.equalTo("subject", subject);
        query.equalTo("chapter", chapter);
        query.equalTo("isActive", true);
        query.ascending("pageGroup", "order");

        try {
            const results = await query.find();

            if (results.length === 0) {
                loadingMessage.textContent = 'ğŸ˜… í•´ë‹¹ ì±•í„°ì˜ í•™ìŠµ ë°ì´í„°ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                return;
            }

            // 3-3. 'pageGroup' ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ê·¸ë£¹í™”
            const pagesByGroup = results.reduce((acc, item) => {
                const group = item.get('pageGroup');
                const content = item.get('content'); // HTML ì½˜í…ì¸ 
                if (!acc[group]) acc[group] = [];
                acc[group].push(content);
                return acc;
            }, {});

            // 3-4. 'ë‘ í˜ì´ì§€ ë³´ê¸°' HTML ìƒì„±
            let finalHtml = '';
            for (const group in pagesByGroup) {
                const contents = pagesByGroup[group];
                // ê¸°íšì„œì— ë”°ë¼ h1, h2, h3 íƒœê·¸ì— í˜•ê´‘íœ íš¨ê³¼ ìŠ¤íƒ€ì¼ì„ ì ìš©í•©ë‹ˆë‹¤.
                const styledLeftContent = contents[0] ? contents[0].replace(/<h1>/g, '<h1 style="background-color: #dad4ff;">').replace(/<h2>/g, '<h2 style="background-color: #b7e5ff;">').replace(/<h3>/g, '<h3 style="background-color: #D6E8DB;">') : '';
                const styledRightContent = contents[1] ? contents[1].replace(/<h1>/g, '<h1 style="background-color: #dad4ff;">').replace(/<h2>/g, '<h2 style="background-color: #b7e5ff;">').replace(/<h3>/g, '<h3 style="background-color: #D6E8DB;">') : '';

                finalHtml += `
                    <div class="page-spread">
                        <div class="page left">${styledLeftContent}</div>
                        <div class="page right">${styledRightContent}</div>
                    </div>
                `;
            }
            
            contentContainer.innerHTML = finalHtml;
            loadingMessage.style.display = 'none';

        } catch (error) {
            console.error("ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            loadingMessage.textContent = 'ğŸš« ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”(F12)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        }
    }

    /* 4. ëª¨ë“  ëª©ì°¨ ë§í¬(a íƒœê·¸)ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ */
    document.querySelectorAll('.sidebar-content a').forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault(); // ê¸°ë³¸ ë§í¬ ì´ë™ ë°©ì§€

            // 4-1. í´ë¦­ëœ ì±•í„°ì™€ ìƒìœ„ ê³¼ëª© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const chapterText = event.target.textContent;
            const parentUl = event.target.closest('ul');
            const subjectH3 = parentUl ? parentUl.previousElementSibling : null;
            // 'â–¼' ë¬¸ìë¥¼ ì œê±°í•˜ê³  ì•ë’¤ ê³µë°±ì„ ì •ë¦¬í•©ë‹ˆë‹¤.
            const subjectText = subjectH3 && subjectH3.tagName === 'H3' ? subjectH3.textContent.replace('â–¼', '').trim() : 'ì•Œ ìˆ˜ ì—†ëŠ” ê³¼ëª©';

            // 4-2. ë°ì´í„° ì¡°íšŒ í•¨ìˆ˜ í˜¸ì¶œ
            fetchAndDisplayTheory(subjectText, chapterText);
        });
    });

    /* ========================================
     (ì‹ ê·œ/ìµœì¢…ë³¸) 06-24. ì´ë¡  ì½˜í…ì¸  í˜ì´ì§€ ìë™ ë¶„í•  ì•Œê³ ë¦¬ì¦˜ (v2.1)
     - í…Œì´ë¸” ê³„ì‚° ì˜¤ë¥˜ ìˆ˜ì • ë° ë¡œì§ ê°œì„ 
     ======================================== */

/**
 * ======================================================================
 * (ì‹ ê·œ ì œì•ˆ) 'ì‹¤ì œ ë†’ì´' ê¸°ë°˜ í˜ì´ì§€ ìë™ ë¶„í•  ì•Œê³ ë¦¬ì¦˜ (v3.0)
 * ì˜ˆì¸¡ì´ ì•„ë‹Œ ì‹¤ì¸¡ ë°©ì‹ìœ¼ë¡œ ì •í™•ë„ë¥¼ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.
 * ======================================================================
 */
function splitHtmlIntoPagesByActualHeight(htmlContent, pageHeightLimit = 570) {
    // --- 1. ì‚¬ì „ ì¤€ë¹„ ---
    const sourceContainer = document.createElement('div');
    sourceContainer.innerHTML = htmlContent;
    const nodes = Array.from(sourceContainer.childNodes);

    const measurementDiv = document.createElement('div');
    measurementDiv.style.position = 'absolute';
    measurementDiv.style.left = '-9999px';
    measurementDiv.style.width = '630px';
    
    // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
    //       ì´ ë¶€ë¶„ì˜ ì˜¤íƒ€ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤
    // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…
    measurementDiv.style.padding = '5px 20px';
    
    measurementDiv.style.fontFamily = "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
    measurementDiv.style.visibility = 'hidden';
    document.body.appendChild(measurementDiv);

    // --- 2. í˜ì´ì§€ ë¶„í•  ë¡œì§ ì‹¤í–‰ ---
    let pages = [];
    let currentPageNodes = [];

    const isHeadingElement = (n) => {
        if (!n || n.nodeType !== Node.ELEMENT_NODE) return false;
        const tagName = n.tagName.toLowerCase();
        return ['h1', 'h2', 'h3', 'h4'].includes(tagName) || (tagName === 'p' && n.querySelector('strong'));
    };
    
    const measureNodeHeight = (nodeOrBundle) => {
        const tempContainer = document.createElement('div');
        if (Array.isArray(nodeOrBundle)) {
            nodeOrBundle.forEach(n => tempContainer.appendChild(n.cloneNode(true)));
        } else {
            tempContainer.appendChild(nodeOrBundle.cloneNode(true));
        }
        if (nodeOrBundle.classList && nodeOrBundle.classList.contains('no-break')) {
            tempContainer.classList.add('no-break');
        }
        measurementDiv.appendChild(tempContainer);
        const height = tempContainer.scrollHeight;
        measurementDiv.removeChild(tempContainer);
        return height;
    };
    
    let i = 0;
    while (i < nodes.length) {
        if (nodes[i].nodeType === Node.TEXT_NODE && nodes[i].textContent.trim() === '') {
            i++;
            continue;
        }

        let unitNodes;
        const currentNode = nodes[i];
        const isNoBreakBlock = currentNode.nodeType === Node.ELEMENT_NODE && currentNode.classList.contains('no-break');
        const isHeading = isHeadingElement(currentNode);
        
        if (isNoBreakBlock) {
            unitNodes = [currentNode];
            i++;
        } else if (isHeading) {
            unitNodes = [currentNode];
            let nextNodeIndex = i + 1;
            while(nextNodeIndex < nodes.length && nodes[nextNodeIndex].nodeType === Node.TEXT_NODE && nodes[nextNodeIndex].textContent.trim() === '') {
                nextNodeIndex++;
            }
            if (nextNodeIndex < nodes.length && !isHeadingElement(nodes[nextNodeIndex])) {
                unitNodes.push(nodes[nextNodeIndex]);
                i = nextNodeIndex + 1;
            } else {
                i++;
            }
        } else {
            unitNodes = [currentNode];
            i++;
        }

        // --- 3. ë†’ì´ë¥¼ ì¸¡ì •í•˜ê³  í˜ì´ì§€ë¥¼ ë‚˜ëˆŒì§€ ê²°ì • ---
        measurementDiv.innerHTML = '';
        currentPageNodes.forEach(n => measurementDiv.appendChild(n.cloneNode(true)));
        const currentPageHeight = measurementDiv.scrollHeight;
        
        const unitHeight = measureNodeHeight(unitNodes.length > 1 ? unitNodes : unitNodes[0]);
        
        if (currentPageHeight > 0 && (currentPageHeight + unitHeight > pageHeightLimit)) {
            pages.push(currentPageNodes.map(n => n.outerHTML).join(''));
            currentPageNodes = [];
        }

        currentPageNodes.push(...unitNodes);
    }

    // --- 4. ë§ˆë¬´ë¦¬ ---
    if (currentPageNodes.length > 0) {
        pages.push(currentPageNodes.map(n => n.outerHTML).join(''));
    }

    document.body.removeChild(measurementDiv);
    
    console.log(`âœ… ì½˜í…ì¸  ë¶„í•  ì™„ë£Œ: ì´ ${pages.length} í˜ì´ì§€`);
    return pages;
}

</script>

</body>
</html>
